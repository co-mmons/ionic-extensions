export function findScrollParent(element) {
    if (!element) {
        return;
    }
    if (element.scrollHeight >= element.clientHeight) {
        const overflowY = window.getComputedStyle(element).overflowY;
        if (overflowY !== "visible" && overflowY !== "hidden") {
            return element;
        }
    }
    if (element.assignedSlot) {
        const p = findScrollParent(element.assignedSlot.parentElement);
        if (p) {
            return p;
        }
    }
    return findScrollParent(element.parentElement);
}
export function scrollIntoView(element, parent) {
    if (parent) {
        const parentRect = parent.getBoundingClientRect();
        const rect = element.getBoundingClientRect();
        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom && rect.bottom < parentRect.height)) {
            let top = element.offsetTop - 100;
            if (element.offsetParent) {
                let offsetParent = element.offsetParent;
                while (offsetParent !== parent && !!offsetParent) {
                    top += offsetParent.offsetTop;
                    offsetParent = offsetParent.offsetParent;
                }
            }
            parent.scrollTo({ top: top });
        }
        return;
    }
    element.scrollIntoView();
}
export function scrollToCaret(parent) {
    if (parent) {
        const parentRect = parent.getBoundingClientRect();
        const rect = caretTopPoint();
        rect.top -= 100;
        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom)) {
            let top = rect.top - parentRect.top;
            parent.scrollTo({ top: top, behavior: "auto" });
        }
        return;
    }
}
export function caretTopPoint() {
    const selection = document.getSelection();
    const range0 = selection.getRangeAt(0);
    let rect;
    let range;
    // supposed to be textNode in most cases
    // but div[contenteditable] when empty
    const node = range0.startContainer;
    const offset = range0.startOffset;
    if (offset > 0) {
        // new range, don't influence DOM state
        range = document.createRange();
        range.setStart(node, (offset - 1));
        range.setEnd(node, offset);
        // https://developer.mozilla.org/en-US/docs/Web/API/range.getBoundingClientRect
        // IE9, Safari?(but look good in Safari 8)
        rect = range.getBoundingClientRect();
        return { left: rect["right"], top: rect.top };
    }
    else if (offset < node["length"]) {
        range = document.createRange();
        // similar but select next on letter
        range.setStart(node, offset);
        range.setEnd(node, (offset + 1));
        rect = range.getBoundingClientRect();
        return { left: rect.left, top: rect.top };
    }
    else {
        // textNode has length
        // https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect
        rect = node.getBoundingClientRect();
        const styles = getComputedStyle(node);
        const lineHeight = parseInt(styles.lineHeight);
        const fontSize = parseInt(styles.fontSize);
        // roughly half the whitespace... but not exactly
        const delta = (lineHeight - fontSize) / 2;
        return { left: rect.left, top: (rect.top + delta) };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2h0bWwtZWRpdG9yL3Njcm9sbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLFVBQVUsZ0JBQWdCLENBQUMsT0FBb0I7SUFFakQsSUFBSSxDQUFDLE9BQU8sRUFBRTtRQUNWLE9BQU87S0FDVjtJQUVELElBQUksT0FBTyxDQUFDLFlBQVksSUFBSSxPQUFPLENBQUMsWUFBWSxFQUFFO1FBQzlDLE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDN0QsSUFBSSxTQUFTLEtBQUssU0FBUyxJQUFJLFNBQVMsS0FBSyxRQUFRLEVBQUU7WUFDbkQsT0FBTyxPQUFPLENBQUM7U0FDbEI7S0FDSjtJQUVELElBQUksT0FBTyxDQUFDLFlBQVksRUFBRTtRQUN0QixNQUFNLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQy9ELElBQUksQ0FBQyxFQUFFO1lBQ0gsT0FBTyxDQUFDLENBQUM7U0FDWjtLQUNKO0lBRUQsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVELE1BQU0sVUFBVSxjQUFjLENBQUMsT0FBb0IsRUFBRSxNQUFtQjtJQUVwRSxJQUFJLE1BQU0sRUFBRTtRQUVSLE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ2xELE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBRTdDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsVUFBVSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxJQUFJLFVBQVUsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFD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QUUsSUFBSSxDQUFDLEdBQUcsRUFBQyxDQUFDO0tBRTNDO1NBQU07UUFDSCxzQkFBc0I7UUFFdEIsaUZBQWlGO1FBQ2pGLElBQUksR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNwQyxNQUFNLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0QyxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQy9DLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFM0MsaURBQWlEO1FBQ2pELE1BQU0sS0FBSyxHQUFHLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUUxQyxPQUFPLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsRUFBQyxDQUFDO0tBQ3JEO0FBRUwsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBmaW5kU2Nyb2xsUGFyZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogSFRNTEVsZW1lbnQge1xuXG4gICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudC5zY3JvbGxIZWlnaHQgPj0gZWxlbWVudC5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgY29uc3Qgb3ZlcmZsb3dZID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCkub3ZlcmZsb3dZO1xuICAgICAgICBpZiAob3ZlcmZsb3dZICE9PSBcInZpc2libGVcIiAmJiBvdmVyZmxvd1kgIT09IFwiaGlkZGVuXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGVsZW1lbnQuYXNzaWduZWRTbG90KSB7XG4gICAgICAgIGNvbnN0IHAgPSBmaW5kU2Nyb2xsUGFyZW50KGVsZW1lbnQuYXNzaWduZWRTbG90LnBhcmVudEVsZW1lbnQpO1xuICAgICAgICBpZiAocCkge1xuICAgICAgICAgICAgcmV0dXJuIHA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmluZFNjcm9sbFBhcmVudChlbGVtZW50LnBhcmVudEVsZW1lbnQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2Nyb2xsSW50b1ZpZXcoZWxlbWVudDogSFRNTEVsZW1lbnQsIHBhcmVudDogSFRNTEVsZW1lbnQpIHtcblxuICAgIGlmIChwYXJlbnQpIHtcblxuICAgICAgICBjb25zdCBwYXJlbnRSZWN0ID0gcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICBpZiAoIShyZWN0LnRvcCA+IHBhcmVudFJlY3QudG9wICYmIHJlY3QudG9wIDw9IHBhcmVudFJlY3QuYm90dG9tICYmIHJlY3QuYm90dG9tIDwgcGFyZW50UmVjdC5oZWlnaHQpKSB7XG5cbiAgICAgICAgICAgIGxldCB0b3AgPSBlbGVtZW50Lm9mZnNldFRvcCAtIDEwMDtcblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQub2Zmc2V0UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgbGV0IG9mZnNldFBhcmVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgICAgICAgICAgIHdoaWxlIChvZmZzZXRQYXJlbnQgIT09IHBhcmVudCAmJiAhIW9mZnNldFBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICB0b3AgKz0gb2Zmc2V0UGFyZW50Lm9mZnNldFRvcDtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50Lm9mZnNldFBhcmVudCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhcmVudC5zY3JvbGxUbyh7dG9wOiB0b3B9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlbGVtZW50LnNjcm9sbEludG9WaWV3KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzY3JvbGxUb0NhcmV0KHBhcmVudDogSFRNTEVsZW1lbnQpIHtcblxuICAgIGlmIChwYXJlbnQpIHtcblxuICAgICAgICBjb25zdCBwYXJlbnRSZWN0ID0gcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCByZWN0ID0gY2FyZXRUb3BQb2ludCgpO1xuICAgICAgICByZWN0LnRvcCAtPSAxMDA7XG5cbiAgICAgICAgaWYgKCEocmVjdC50b3AgPiBwYXJlbnRSZWN0LnRvcCAmJiByZWN0LnRvcCA8PSBwYXJlbnRSZWN0LmJvdHRvbSkpIHtcblxuICAgICAgICAgICAgbGV0IHRvcCA9IHJlY3QudG9wIC0gcGFyZW50UmVjdC50b3A7XG4gICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG8oe3RvcDogdG9wLCBiZWhhdmlvcjogXCJhdXRvXCJ9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhcmV0VG9wUG9pbnQoKToge2xlZnQ6IG51bWJlciwgdG9wOiBudW1iZXJ9IHtcblxuICAgIGNvbnN0IHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpO1xuICAgIGNvbnN0IHJhbmdlMCA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApO1xuXG4gICAgbGV0IHJlY3Q6IHtsZWZ0OiBudW1iZXIsIHRvcDogbnVtYmVyfTtcbiAgICBsZXQgcmFuZ2U6IFJhbmdlO1xuXG4gICAgLy8gc3VwcG9zZWQgdG8gYmUgdGV4dE5vZGUgaW4gbW9zdCBjYXNlc1xuICAgIC8vIGJ1dCBkaXZbY29udGVudGVkaXRhYmxlXSB3aGVuIGVtcHR5XG4gICAgY29uc3Qgbm9kZSA9IHJhbmdlMC5zdGFydENvbnRhaW5lciBhcyBFbGVtZW50O1xuXG4gICAgY29uc3Qgb2Zmc2V0ID0gcmFuZ2UwLnN0YXJ0T2Zmc2V0O1xuICAgIGlmIChvZmZzZXQgPiAwKSB7XG5cbiAgICAgICAgLy8gbmV3IHJhbmdlLCBkb24ndCBpbmZsdWVuY2UgRE9NIHN0YXRlXG4gICAgICAgIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgcmFuZ2Uuc2V0U3RhcnQobm9kZSwgKG9mZnNldCAtIDEpKTtcbiAgICAgICAgcmFuZ2Uuc2V0RW5kKG5vZGUsIG9mZnNldCk7XG5cbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL3JhbmdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdFxuICAgICAgICAvLyBJRTksIFNhZmFyaT8oYnV0IGxvb2sgZ29vZCBpbiBTYWZhcmkgOClcbiAgICAgICAgcmVjdCA9IHJhbmdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgIHJldHVybiB7bGVmdDogcmVjdFtcInJpZ2h0XCJdLCB0b3A6IHJlY3QudG9wfTtcblxuICAgIH0gZWxzZSBpZiAob2Zmc2V0IDwgbm9kZVtcImxlbmd0aFwiXSkge1xuXG4gICAgICAgIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgLy8gc2ltaWxhciBidXQgc2VsZWN0IG5leHQgb24gbGV0dGVyXG4gICAgICAgIHJhbmdlLnNldFN0YXJ0KG5vZGUsIG9mZnNldCk7XG4gICAgICAgIHJhbmdlLnNldEVuZChub2RlLCAob2Zmc2V0ICsgMSkpO1xuICAgICAgICByZWN0ID0gcmFuZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgcmV0dXJuIHtsZWZ0OiByZWN0LmxlZnQsIHRvcDogcmVjdC50b3B9O1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gdGV4dE5vZGUgaGFzIGxlbmd0aFxuXG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdFxuICAgICAgICByZWN0ID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3Qgc3R5bGVzID0gZ2V0Q29tcHV0ZWRTdHlsZShub2RlKTtcbiAgICAgICAgY29uc3QgbGluZUhlaWdodCA9IHBhcnNlSW50KHN0eWxlcy5saW5lSGVpZ2h0KTtcbiAgICAgICAgY29uc3QgZm9udFNpemUgPSBwYXJzZUludChzdHlsZXMuZm9udFNpemUpO1xuXG4gICAgICAgIC8vIHJvdWdobHkgaGFsZiB0aGUgd2hpdGVzcGFjZS4uLiBidXQgbm90IGV4YWN0bHlcbiAgICAgICAgY29uc3QgZGVsdGEgPSAobGluZUhlaWdodCAtIGZvbnRTaXplKSAvIDI7XG5cbiAgICAgICAgcmV0dXJuIHtsZWZ0OiByZWN0LmxlZnQsIHRvcDogKHJlY3QudG9wICsgZGVsdGEpfTtcbiAgICB9XG5cbn1cbiJdfQ==