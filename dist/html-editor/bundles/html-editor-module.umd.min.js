!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@co.mmons/angular-extensions/browser/match-media"),require("@co.mmons/angular-intl"),require("@co.mmons/ionic-extensions/form-helper"),require("@co.mmons/ionic-extensions/select"),require("@ionic/angular"),require("@co.mmons/ionic-extensions/buttons"),require("@co.mmons/js-intl"),require("prosemirror-model"),require("prosemirror-schema-basic"),require("prosemirror-schema-list"),require("@angular/platform-browser"),require("@co.mmons/js-utils/core"),require("prosemirror-commands"),require("prosemirror-gapcursor"),require("prosemirror-history"),require("prosemirror-keymap"),require("prosemirror-state"),require("prosemirror-view"),require("prosemirror-inputrules"),require("prosemirror-utils"),require("@co.mmons/rxjs-utils"),require("fast-equals"),require("prosemirror-transform")):"function"==typeof define&&define.amd?define("@co.mmons/ionic-extensions/html-editor",["exports","@angular/common","@angular/core","@angular/forms","@co.mmons/angular-extensions/browser/match-media","@co.mmons/angular-intl","@co.mmons/ionic-extensions/form-helper","@co.mmons/ionic-extensions/select","@ionic/angular","@co.mmons/ionic-extensions/buttons","@co.mmons/js-intl","prosemirror-model","prosemirror-schema-basic","prosemirror-schema-list","@angular/platform-browser","@co.mmons/js-utils/core","prosemirror-commands","prosemirror-gapcursor","prosemirror-history","prosemirror-keymap","prosemirror-state","prosemirror-view","prosemirror-inputrules","prosemirror-utils","@co.mmons/rxjs-utils","fast-equals","prosemirror-transform"],t):t(((e=e||self).co=e.co||{},e.co.mmons=e.co.mmons||{},e.co.mmons["ionic-extensions"]=e.co.mmons["ionic-extensions"]||{},e.co.mmons["ionic-extensions"]["html-editor"]={}),e.ng.common,e.ng.core,e.ng.forms,e.matchMedia,e.angularIntl,e.formHelper,e.select,e.angular,e.buttons,e.jsIntl,e.prosemirrorModel,e.prosemirrorSchemaBasic,e.prosemirrorSchemaList,e.ng.platformBrowser,e.core$1,e.prosemirrorCommands,e.prosemirrorGapcursor,e.prosemirrorHistory,e.prosemirrorKeymap,e.prosemirrorState,e.prosemirrorView,e.prosemirrorInputrules,e.prosemirrorUtils,e.rxjsUtils,e.fastEquals,e.prosemirrorTransform)}(this,(function(e,t,n,o,i,r,s,a,l,c,u,d,p,f,m,h,v,g,y,b,k,w,x,M,C,I,S){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var z=function(e,t){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function L(e,t,n,o){var i,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function O(e,t){return function(n,o){t(n,o,e)}}function P(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,a)}l((o=o.apply(e,t||[])).next())}))}function A(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function B(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function V(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return s}function H(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(V(arguments[t]));return e}var T=function(){function e(t){this.alignment=t,e._alignments.push(this),this.label=new u.MessageRef("@co.mmons/ionic-extensions/html-editor","alignmentMenu/"+t)}return e.alignments=function(){return e._alignments.slice()},e._alignments=[],e.left=new e("left"),e.right=new e("right"),e.center=new e("center"),e.justify=new e("justify"),e}(),E=function(e,t,n){return function(o,i){var r=!1,s=o.tr,a=o.selection;return function(i,s,a){o.doc.nodesBetween(i,s,(function(i,s,l){if(!i.type.isBlock)return!1;if((!n||(Array.isArray(n)?n.indexOf(i.type)>-1:n(o.schema,i,l)))&&l.type.allowsMarkType(e)){var c=i.marks.filter((function(t){return t.type===e})),u=c.length?c[0].attrs:void 0,d=t(u,i);void 0!==d&&(a.setNodeMarkup(s,i.type,i.attrs,i.marks.filter((function(t){return!e.excludes(t.type)})).concat(!1===d?[]:e.create(d))),r=!0)}}))}(a.from,a.to,s),!(!r||!s.docChanged)&&(i&&i(s.scrollIntoView()),!0)}},$={excludes:"fontSize",group:"fontSize",attrs:{fontSize:{}},parseDOM:[{tag:"span[data-font-size]",getAttrs:function(e){var t=e.getAttribute("data-font-size");return!!t&&{fontSize:t}}}],toDOM:function(e){return["span",{style:"font-size: "+e.attrs.fontSize,"data-font-size":e.attrs.fontSize},0]}},F={excludes:"alignment",group:"alignment",attrs:{align:{}},parseDOM:[{tag:"div[data-align]",getAttrs:function(e){var t=e.getAttribute("data-align");return!!t&&{align:t}}}],toDOM:function(e){return["div",{style:"text-align: "+e.attrs.align,"data-align":e.attrs.align},0]}},q={attrs:{id:{default:""},start:{default:0}},inline:!1,group:"block",draggable:!1,toDOM:function(e){return["div",{"data-youtube":e.attrs.id+(e.attrs.start?","+e.attrs.start:"")},"youtube"]},parseDOM:[{tag:"div[data-youtube]",getAttrs:function(e){var t=e.getAttribute("data-youtube").split(",");return{id:t[0],start:t.length>1?t[1]:0}}}]},j={doc:{content:"block+",marks:"alignment"},paragraph:{content:"inline*",marks:"alignment strong underline em fontSize link",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return["p",0]}},blockquote:p.nodes.blockquote,horizontalRule:p.nodes.horizontal_rule,heading:p.nodes.heading,text:p.nodes.text,hardBreak:p.nodes.hard_break,bulletList:Object.assign({},f.bulletList,{content:"listItem+",group:"block"}),orderedList:Object.assign({},f.orderedList,{content:"listItem+",group:"block"}),listItem:Object.assign({},f.listItem,{content:"paragraph block*",marks:"alignment"}),youtube:q},D={link:p.marks.link,em:p.marks.em,strong:p.marks.strong,alignment:F,fontSize:$,underline:{parseDOM:[{tag:"u"},{style:"text-decoration=underline"}],toDOM:function(){return["u",0]}}},R=new d.Schema({nodes:j,marks:D});var N=function(){function e(e){this.popoverController=e,this.Alignment=T}return e.prototype.toggleAligment=function(e){var t,n=this,o=(t=e.alignment,function(e,n){var o=e.schema,i=o.nodes,r=i.paragraph,s=i.heading,a=o.marks.alignment;return E(a,(function(){return t?"left"!==t&&{align:t}:void 0}),[r,s])(e,n)});o(this.editor.state)&&o(this.editor.state,(function(e){return n.editor.view.dispatch(e)})),this.popoverController.dismiss()},e.prototype.ngOnInit=function(){var e,t;this.active=void 0;try{for(var n=B(function(e,t){var n=[],o=e.selection,i=o.from,r=o.to;return e.doc.nodesBetween(i,r,(function(e,o,i){var r,s;if(!e.type.isBlock)return!1;try{for(var a=B(e.marks),l=a.next();!l.done;l=a.next()){var c=l.value;c.type===t&&n.push(c)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}})),n}(this.editor.state,R.marks.alignment)),o=n.next();!o.done;o=n.next()){var i=o.value;if(this.active&&this.active!==i.attrs.align){this.active=void 0;break}this.active=i.attrs.align}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.ionViewWillLeave=function(){this.editor.focus()},e.ctorParameters=function(){return[{type:l.PopoverController}]},L([n.Input()],e.prototype,"editor",void 0),e=L([n.Component({template:'\n        <ion-list lines="full">\n\n            <ion-item button="true" detail="false" (click)="toggleAligment(alignment)" *ngFor="let alignment of Alignment.alignments()">\n                <ion-label>{{alignment.label | intlMessage}}</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="active === alignment.alignment"></ion-icon>\n                <ion-icon src="assets/html-editor/align-{{alignment.alignment}}.svg" slot="start"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    ',styles:["\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n    "]})],e)}(),U="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function _(e,t){var n,o={};function i(e,n){if(t){var i=t[e];if(!1===i)return;i&&(e=i)}o[e]=n}if(i("Mod-z",y.undo),i("Shift-Mod-z",y.redo),i("Backspace",x.undoInputRule),U||i("Mod-y",y.redo),i("Alt-ArrowUp",v.joinUp),i("Alt-ArrowDown",v.joinDown),i("Mod-BracketLeft",v.lift),i("Escape",v.selectParentNode),(n=e.marks.strong)&&(i("Mod-b",v.toggleMark(n)),i("Mod-B",v.toggleMark(n))),(n=e.marks.em)&&(i("Mod-i",v.toggleMark(n)),i("Mod-I",v.toggleMark(n))),(n=e.marks.underline)&&(i("Mod-u",v.toggleMark(n)),i("Mod-U",v.toggleMark(n))),(n=e.nodes.listItem)&&i("Enter",f.splitListItem(n)),n=e.nodes.hardBreak){var r=n,s=function(e,t){return t(e.tr.replaceSelectionWith(r.create()).scrollIntoView()),!0};i("Mod-Enter",s),i("Shift-Enter",s),U&&i("Ctrl-Enter",s)}return o}function W(e,t){var n=document.createElement("iframe");return n.height="200px",n.width="100%",n.src="https://www.youtube.com/embed/"+e+(t?"?start="+t:""),n.frameBorder="0",n.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",n.allowFullscreen=!0,n}var G=function(){function e(e,t,n){var o=this;this.view=t,this.dom=document.createElement("div"),this.dom.style.position="relative",this.dom.style.overflow="hidden",this.dom.style.height="200px",this.dom.style.marginTop="16px",this.dom.appendChild(W(e.attrs.id,e.attrs.start));var i=this.dom.appendChild(document.createElement("div"));i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="200px",i.style.display="flex",i.style.justifyContent="center";var r=i.appendChild(document.createElement("ion-button"));r.classList.add("ionx--interactive"),r.setAttribute("color","primary"),this.deleteUnlisten=n.addEventListener(r,"click",(function(){return o.deleteNode()}));var s=document.createElement("ion-icon");s.setAttribute("name","trash"),s.slot="icon-only",r.appendChild(s)}return e.prototype.deleteNode=function(){this.view.dispatch(M.removeSelectedNode(this.view.state.tr))},e.prototype.selectNode=function(){this.dom.classList.add("ionx--selected")},e.prototype.deselectNode=function(){this.dom.classList.remove("ionx--selected")},e.prototype.update=function(e){return!1},e.prototype.destroy=function(){this.deleteUnlisten&&this.deleteUnlisten()},e.prototype.stopEvent=function(e){return!1},e.prototype.ignoreMutation=function(){return!0},e}();function Y(e){if(e){if(e.scrollHeight>=e.clientHeight){var t=window.getComputedStyle(e).overflowY;if("visible"!==t&&"hidden"!==t)return e}if(e.assignedSlot){var n=Y(e.assignedSlot.parentElement);if(n)return n}return Y(e.parentElement)}}var K=function(){function e(e,o,i,r){this.element=e,this.eventManager=o,this.formControl=i,this.item=r,this.eventUnlisteners=[],this.change=new n.EventEmitter,this.selectionChange=new n.EventEmitter,i&&(this.formControl.valueAccessor=this),this.id="ionx-trix-editor"+t.idGenerator++,this.itemInputWrapper=!!this.item}var t;return t=e,Object.defineProperty(e.prototype,"state",{get:function(){return this.view.state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){if(this.view){var e=d.DOMSerializer.fromSchema(this.schema).serializeFragment(this.state.doc.content),t=document.createElement("div");return t.appendChild(e),t.innerText?this.prepareOutputValue(t):null}return this.uninitializedValue},set:function(e){if(this.view){var t=k.EditorState.create({schema:this.view.state.schema,plugins:this.view.state.plugins,doc:this.editorDoc(e||"<div></div>")});this.view.updateState(t)}else this.uninitializedValue=e;this.silentChanges=!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nativeElement",{get:function(){return this.element.nativeElement},enumerable:!0,configurable:!0}),e.prototype.prepareOutputValue=function(e){return e.querySelectorAll("div[data-youtube]").forEach((function(e){var t=e.getAttribute("data-youtube").split(",");e.appendChild(W(t[0],t.length>1?t[1]:void 0))})),e.innerHTML},e.prototype.prepareInputValue=function(e){},e.prototype.setDisabledState=function(e){this.disabled=!!e},e.prototype.writeValue=function(e){this.silentChanges=!0,this.value=e},e.prototype.registerOnChange=function(e){this.controlOnChange=e},e.prototype.registerOnTouched=function(e){this.controlOnTouched=e},e.prototype.focus=function(){this.view.dom.focus()},e.prototype.editorInitialized=function(e){return P(this,void 0,void 0,(function(){return A(this,(function(e){return this.uninitializedValue,[2]}))}))},e.prototype.editorFocused=function(e){this.controlOnTouched&&this.controlOnTouched(!0),this.focused=!0,this.updateItemClasses()},e.prototype.editorBlured=function(e){this.focused=!1,this.updateItemClasses()},e.prototype.handleScroll=function(e){this.scrollParent||(this.scrollParent=Y(this.element.nativeElement));var t=e.domAtPos(e.state.selection.to);return t.node instanceof HTMLElement&&function(e,t,n){if(n||(n=Y(e)),n){var o=n.getBoundingClientRect(),i=e.getBoundingClientRect();if(!(i.top>o.top&&i.top<=o.bottom&&i.bottom<o.height)){var r=e.offsetTop;if(e.offsetParent)for(var s=e.offsetParent;s!==n&&s;)r+=s.offsetTop,s=s.offsetParent;n.scrollTo({top:r,behavior:t})}}else e.scrollIntoView()}(t.node,void 0,this.scrollParent),!1},e.prototype.editorDoc=function(e){var t=document.createElement("div");return t.innerHTML=e,this.prepareInputValue(t),d.DOMParser.fromSchema(this.schema).parse(t)},e.prototype.resetControlCss=function(){var e,t,n={"ion-untouched":this.formControl.untouched,"ion-touched":this.formControl.touched,"ion-pristine":this.formControl.pristine,"ion-dirty":this.formControl.dirty,"ion-valid":this.formControl.valid,"ion-invalid":!this.formControl.valid},o=[];o.push(this.element.nativeElement),this.item&&o.push(this.item.el);try{for(var i=B(o),r=i.next();!r.done;r=i.next()){var s=r.value;for(var a in n)n[a]?s.classList.add(a):s.classList.remove(a)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.updateItemClasses=function(){if(this.item){var e=this.item.el;this.disabled?e.classList.remove("item-interactive"):e.classList.add("item-interactive"),this.focused?e.classList.add("item-has-focus"):e.classList.remove("item-has-focus")}},e.prototype.fixItemOverflow=function(){return P(this,void 0,void 0,(function(){var e,t;return A(this,(function(n){switch(n.label){case 0:return this.item?(e=this.item.el,[4,h.waitTill((function(){return!!e.shadowRoot}))]):[3,2];case 1:n.sent(),e.style.overflow="initial",(t=document.createElement("style")).innerHTML=".item-native, .item-inner, .input-wrapper { overflow: initial !important; }",e.shadowRoot.appendChild(t),n.label=2;case 2:return[2]}}))}))},e.prototype.editorTransaction=function(e){this.focus(),this.view.updateState(this.view.state.apply(e)),this.selectionChange.next(),e.docChanged&&(this.change.next(),this.controlOnChange&&!this.silentChanges&&this.controlOnChange(this.value)),this.silentChanges=!1},e.prototype.readonlyChanged=function(){this.view&&(this.view.dom.contentEditable=this.readonly||this.disabled?"false":"true")},e.prototype.ngAfterViewInit=function(){this.fixItemOverflow(),this.updateItemClasses()},e.prototype.ngAfterContentChecked=function(){this.resetControlCss()},e.prototype.ngOnDestroy=function(){var e,t;try{for(var n=B(this.eventUnlisteners),o=n.next();!o.done;o=n.next()){(0,o.value)()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.view.destroy(),this.view=void 0},e.prototype.ngOnInit=function(){var e=this;this.schema=R,this.plugins=[b.keymap(_(R)),b.keymap(v.baseKeymap),g.gapCursor(),y.history()];var t=k.EditorState.create({schema:this.schema,plugins:this.plugins,doc:this.editorDoc(this.uninitializedValue?this.uninitializedValue:"<div></div>")});this.view=new w.EditorView(this.element.nativeElement,{state:t,dispatchTransaction:function(t){return e.editorTransaction(t)},handleScrollToSelection:function(t){return e.handleScroll(t)},nodeViews:{youtube:function(t,n){return new G(t,n,e.eventManager)}}}),this.silentChanges=!1,(this.readonly||this.disabled)&&this.readonlyChanged()},e.prototype.ngOnChanges=function(e){(e.readonly||e.disabled)&&this.readonlyChanged()},e.idGenerator=0,e.ctorParameters=function(){return[{type:n.ElementRef},{type:m.EventManager},{type:o.NgControl,decorators:[{type:n.Optional}]},{type:l.IonItem,decorators:[{type:n.Optional}]}]},L([n.HostBinding("class.ionx-item-input-wrapper")],e.prototype,"itemInputWrapper",void 0),L([n.Input()],e.prototype,"features",void 0),L([n.Input()],e.prototype,"disabled",void 0),L([n.Input()],e.prototype,"readonly",void 0),L([n.Output()],e.prototype,"change",void 0),L([n.Output()],e.prototype,"selectionChange",void 0),L([n.Input()],e.prototype,"value",null),e=t=L([n.Component({selector:"ionx-html-editor",template:"\n        <ionx-html-editor-toolbar [style.display]=\"readonly ? 'none' : ''\"></ionx-html-editor-toolbar>\n    ",styles:[":host ::ng-deep .ProseMirror{outline:0;-moz-user-select:text;-ms-user-select:text;user-select:text;-webkit-user-select:text}:host ::ng-deep .ProseMirror[contenteditable=true]{min-height:60px;white-space:pre-wrap;word-wrap:break-word}:host ::ng-deep .ProseMirror[contenteditable=true] .ionx--selected{border:4px solid var(--ion-color-primary)}:host ::ng-deep .ProseMirror[contenteditable=true] .ionx--interactive{display:none}:host ::ng-deep .ProseMirror p{margin:16px 0 0}:host ::ng-deep .ProseMirror p:first-child{margin-top:0}:host ::ng-deep .ProseMirror h1{font-size:130%}:host ::ng-deep .ProseMirror h2{font-size:125%}:host ::ng-deep .ProseMirror h3{font-size:120%}:host ::ng-deep .ProseMirror h4{font-size:115%}:host ::ng-deep .ProseMirror h5{font-size:110%}:host ::ng-deep .ProseMirror h6{font-size:105%}:host ::ng-deep .ProseMirror h1,:host ::ng-deep .ProseMirror h2,:host ::ng-deep .ProseMirror h3,:host ::ng-deep .ProseMirror h4,:host ::ng-deep .ProseMirror h5,:host ::ng-deep .ProseMirror h6{margin-top:16px;margin-bottom:8px}:host ::ng-deep .ProseMirror h1:first-child,:host ::ng-deep .ProseMirror h2:first-child,:host ::ng-deep .ProseMirror h3:first-child,:host ::ng-deep .ProseMirror h4:first-child,:host ::ng-deep .ProseMirror h5:first-child,:host ::ng-deep .ProseMirror h6:first-child{margin-top:0}:host ::ng-deep .ProseMirror ul:first-child{margin-top:0}"]}),O(2,n.Optional()),O(3,n.Optional())],e)}(),X=function(){function e(e){this.popoverController=e}return e.prototype.toggleHeading=function(e){var t=this;if(e>0&&this.activeHeading!==e){var n=v.setBlockType(R.nodes.heading,{level:e});n(this.editor.state)&&n(this.editor.state,(function(e){t.editor.view.dispatch(e)}))}else v.setBlockType(R.nodes.paragraph)(this.editor.state,(function(e){return t.editor.view.dispatch(e)}));this.popoverController.dismiss()},e.prototype.ngOnInit=function(){var e=M.findParentNodeOfType(R.nodes.heading)(this.editor.state.selection);e&&(this.activeHeading=e.node.attrs.level)},e.prototype.ionViewWillLeave=function(){this.editor.focus()},e.ctorParameters=function(){return[{type:l.PopoverController}]},L([n.Input()],e.prototype,"editor",void 0),e=L([n.Component({template:'\n        <ion-list lines="full">\n\n            <ion-item button="true" detail="false" (click)="toggleHeading(0)" *ngIf="activeHeading > 0">\n                <ion-label>{{"@co.mmons/ionic-extensions/html-editor#Plain text" | intlMessage}}</ion-label>\n            </ion-item>\n            \n            <ion-item button="true" detail="false" (click)="toggleHeading(1)">\n                <ion-label style="font-size: 130%; font-weight: 500">{{"@co.mmons/ionic-extensions/html-editor#Heading" | intlMessage}} 1</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeHeading == 1"></ion-icon>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggleHeading(2)">\n                <ion-label style="font-size: 125%; font-weight: 500">{{"@co.mmons/ionic-extensions/html-editor#Heading" | intlMessage}} 2</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeHeading == 2"></ion-icon>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggleHeading(3)">\n                <ion-label style="font-size: 120%; font-weight: 500">{{"@co.mmons/ionic-extensions/html-editor#Heading" | intlMessage}} 3</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeHeading == 3"></ion-icon>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggleHeading(4)">\n                <ion-label style="font-size: 115%; font-weight: 500">{{"@co.mmons/ionic-extensions/html-editor#Heading" | intlMessage}} 4</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeHeading == 4"></ion-icon>\n            </ion-item>\n            \n            <ion-item button="true" detail="false" (click)="toggleHeading(5)">\n                <ion-label style="font-size: 110%; font-weight: 500">{{"@co.mmons/ionic-extensions/html-editor#Heading" | intlMessage}} 5</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeHeading == 5"></ion-icon>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggleHeading(6)">\n                <ion-label style="font-size: 105%; font-weight: 500">{{"@co.mmons/ionic-extensions/html-editor#Heading" | intlMessage}} 6</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeHeading == 6"></ion-icon>\n            </ion-item>\n            \n        </ion-list>\n    ',styles:[":host ion-list { margin: 0px; padding: 0px }",":host ion-item:last-child { --border-width: 0px; }"]})],e)}(),J=function(e){function t(t){var n=e.call(this,t)||this;return n.inputComponent=void 0,n.label=new u.MessageRef("@co.mmons/ionic-extensions/html-editor","link/type/"+t),n.inputType="www"===t?"url":"other"===t?"text":"sms"===t?"sms":t,"www"===t&&(n.inputValidators=[Z],n.inputLabel=new u.MessageRef("@co.mmons/ionic-extensions/html-editor","link/Web page url")),"email"===t&&(n.inputValidators=[o.Validators.email],n.inputLabel=new u.MessageRef("@co.mmons/ionic-extensions/html-editor","link/E-mail address")),"tel"!==t&&"sms"!==t||(n.inputLabel=new u.MessageRef("@co.mmons/ionic-extensions/html-editor","link/Phone number"),n.inputHint=new u.MessageRef("@co.mmons/ionic-extensions/html-editor","link/phoneNumberHint")),n}return function(e,t){function n(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.uri=function(e){return"www"===this.type||"other"===this.type?e:"tel"===this.type?"tel:"+e:"sms"===this.type?"sms:"+e:"email"===this.type?"mailto:"+e:e},t.www=new t("www"),t.email=new t("email"),t.tel=new t("tel"),t.sms=new t("sms"),t.other=new t("other"),t}(function(){function e(e){this.type=e}return e.prototype.toString=function(){return this.type},e}()),Q=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i;function Z(e){var t=e.value;if(!Q.test(t))return{invalidUrl:new u.MessageRef("@co.mmons/ionic-extensions/html-editor","link/invalidUrlError")}}function ee(e,t,n){var o=e.doc,i=e.selection;return function(e,t,n,o,i){var r=[];return e.nodesBetween(t,n,(function(e){for(var t=0;t<e.marks.length;t++)e.marks[t].type!==o||i&&!I.deepEqual(e.marks[t].attrs,i)||r.push(e.marks[t])})),r}(o,i.from,i.to,t,n)}function te(e,t){var n=e.resolve(t),o=t-n.textOffset;return{start:o,end:o+n.parent.child(n.index()).nodeSize}}var ne=function(){function e(e){this.modalController=e}var t;return t=e,e.present=function(e,n){return P(this,void 0,void 0,(function(){return A(this,(function(o){switch(o.label){case 0:return[4,e.create({component:t,componentProps:{editor:n}})];case 1:return o.sent().present(),[2]}}))}))},e.prototype.close=function(){return P(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this.modalController.dismiss()];case 1:return e.sent(),this.editor.focus(),[2]}}))}))},e.prototype.unlink=function(){return P(this,void 0,void 0,(function(){var e,t,n=this;return A(this,(function(o){switch(o.label){case 0:return[4,this.modalController.dismiss()];case 1:return o.sent(),(e=this.editor.state.selection).empty?((t=this.editor.state.tr).doc.nodesBetween(e.from,e.to,(function(e,n){if(e.isText){var o=t.doc.resolve(n),i=n-o.textOffset,r=i+o.parent.child(o.index()).nodeSize;t.removeMark(i,r,R.marks.link)}})),this.editor.view.dispatch(t)):v.toggleMark(R.marks.link)(this.editor.state,(function(e){return n.editor.view.dispatch(e)})),[2]}}))}))},e.prototype.ok=function(){return P(this,void 0,void 0,(function(){var e,t,n,o=this;return A(this,(function(i){switch(i.label){case 0:return this.formHelper.validateAll("dirty"),this.form.valid?[4,this.modalController.dismiss()]:[3,2];case 1:i.sent(),e=this.form.controls.type.value,t=this.editor.state.selection,n=this.editor.state.tr,t.empty?n.doc.nodesBetween(t.from,t.to,(function(t,i){if(t.isText){var r=te(n.doc,i),s=r.start,a=r.end;n.addMark(s,a,R.mark(R.marks.link,{href:e.uri(o.form.controls.link.value)}))}})):(n.doc.nodesBetween(t.from,t.to,(function(e,t){if(e.isText){var o=te(n.doc,t),i=o.start,r=o.end;n.removeMark(i,r,R.marks.link)}})),n.addMark(t.from,t.to,R.mark(R.marks.link,{href:e.uri(this.form.controls.link.value)}))),this.editor.view.dispatch(n),i.label=2;case 2:return[2]}}))}))},e.prototype.typeChanged=function(){return P(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.form.controls.link.value&&(this.form.controls.link.markAsDirty(),this.form.controls.link.updateValueAndValidity()),[4,h.sleep(50)];case 1:return e.sent(),this.formHelper.focus("link",!1),[2]}}))}))},e.prototype.parseLink=function(e){var t,n,o={"http:":J.www,"https:":J.www,"tel:":J.tel,"sms:":J.sms,"mailto:":J.email},i=e.trim().toLowerCase();try{for(var r=B(Object.keys(o)),s=r.next();!s.done;s=r.next()){var a=s.value;if(i.startsWith(a)){var l={type:o[a],link:e.trim()};return o[a]!==J.www&&(l.link=e.substring(a.length).trim()),l}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return{type:J.other,link:e}},e.prototype.linkValidator=function(e){var t,n,i=o.Validators.required(e);if(i)return i;var r=this.form.controls.type.value.inputValidators;if(r)try{for(var s=B(r),a=s.next();!a.done;a=s.next()){var l=(0,a.value)(e);if(l)return l}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype.ionViewDidEnter=function(){return P(this,void 0,void 0,(function(){return A(this,(function(e){return this.formHelper.focus("link",!1),[2]}))}))},e.prototype.ionViewWillLeave=function(){return P(this,void 0,void 0,(function(){return A(this,(function(e){return this.editor.focus(),[2]}))}))},e.prototype.ngOnInit=function(){var e,t,n=this;this.types=[J.www,J.email,J.tel,J.sms,J.other],this.form=new o.FormGroup({type:new o.FormControl(J.www),link:new o.FormControl}),this.form.controls.link.setValidators((function(e){return n.linkValidator(e)})),this.typeChangesSubscription=this.form.controls.type.valueChanges.subscribe((function(){return n.typeChanged()})),this.typeChanged(),this.existing=void 0;try{for(var i=B(ee(this.editor.state,R.marks.link)),r=i.next();!r.done;r=i.next()){var s=r.value,a=this.parseLink(s.attrs.href);a&&(this.form.controls.type.setValue(a.type),this.form.controls.link.setValue(a.link),this.existing=!0)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.ngOnDestroy=function(){C.unsubscribe(this.typeChangesSubscription)},e.ctorParameters=function(){return[{type:l.ModalController}]},L([n.Input()],e.prototype,"editor",void 0),L([n.ViewChild(s.FormHelper,{static:!1})],e.prototype,"formHelper",void 0),e=t=L([n.Component({template:'\n        <ion-header>\n            \n            <ion-toolbar>\n\n                <ionx-buttons slot="start">\n                    <ion-back-button style="display: inline-block" [icon]="(\'tablet\' | matchGreaterWidth) ? \'close\' : \'arrow-back\'" (click)="$event.preventDefault(); close()"></ion-back-button>\n                </ionx-buttons>\n                \n                <ion-title style="margin: 0; padding: 0;">{{"@co.mmons/ionic-extensions/html-editor#link/Link" | intlMessage}}</ion-title>\n\n                <ionx-buttons slot="end">\n\n                    <ion-button fill="clear" color="dark" (click)="unlink()" *ngIf="existing">\n                        <ion-icon name="trash" slot="start"></ion-icon>\n                        <ion-label>{{"@co.mmons/ionic-extensions/html-editor#link/Unlink" | intlMessage}}</ion-label>\n                    </ion-button>\n\n                    <ion-button fill="clear" color="primary" (click)="ok()">\n                        <ion-icon name="checkmark" slot="start"></ion-icon>\n                        <ion-label>{{"@co.mmons/js-intl#Done" | intlMessage}}</ion-label>\n                    </ion-button>\n                    \n                </ionx-buttons>\n                \n            </ion-toolbar>\n            \n        </ion-header>\n        <ion-content>\n            \n            <form ionx-form-helper [formGroup]="form">\n                \n                <ion-grid>\n                    \n                    <ion-row>\n                        \n                        <ion-col [sizeXs]="12">\n                            \n                            <ionx-form-item>\n\n                                <ion-item>\n                                    <ion-label position="stacked">{{"@co.mmons/ionic-extensions/html-editor#link/Link type" | intlMessage}}</ion-label>\n                                    <ionx-select required [compareAsString]="true" formControlName="type">\n                                        <ionx-select-option *ngFor="let type of types" [value]="type">{{type.label | intlMessage}}</ionx-select-option>\n                                    </ionx-select>\n                                </ion-item>\n    \n                            </ionx-form-item>\n                            \n                        </ion-col>\n\n                        <ion-col [sizeXs]="12">\n                            \n                            <ionx-form-item>\n    \n                                <ion-item>\n                                    <ion-label position="stacked">{{(form.controls[\'type\'].value.inputLabel || "@co.mmons/ionic-extensions/html-editor#link/Link") | intlMessage}}</ion-label>\n                                    <ion-input formControlName="link" type="form.controls[\'type\'].value.inputType"></ion-input>\n                                </ion-item>\n                                \n                                <ionx-form-item-error control="link" markedAs="dirty"></ionx-form-item-error>\n                                \n                                <ionx-form-item-hint *ngIf="form.controls[\'type\'].value.inputHint">\n                                    <span [innerHTML]="form.controls[\'type\'].value.inputHint | intlMessage"></span>\n                                </ionx-form-item-hint>\n\n                            </ionx-form-item>\n\n                        </ion-col>\n                        \n                    </ion-row>\n                    \n                    \n                </ion-grid>\n                \n            </form>\n            \n        </ion-content>\n    ',styles:[":host ion-item:not(.ion-dirty) { --highlight-height: 0px; }"]})],e)}(),oe=function(){function e(e,t){this.popoverController=e,this.modalController=t}return e.prototype.insertLink=function(){return P(this,void 0,void 0,(function(){return A(this,(function(e){return this.popoverController.dismiss(void 0,"link"),ne.present(this.modalController,this.editor),[2]}))}))},e.prototype.insertYoutube=function(){return P(this,void 0,void 0,(function(){var e=this;return A(this,(function(t){switch(t.label){case 0:return this.inputView="youtube",[4,h.waitTill((function(){return!!e.youtubeInput}),void 0,2e3)];case 1:return t.sent(),this.youtubeInput.setFocus(),[2]}}))}))},e.prototype.parseYoutube=function(e){var t,n,o={id:void 0,start:void 0};if((e=(e=(e=(e=(e=e.replace("-nocookie.com/",".com/")).replace("/embed/","/")).replace("youtu.be/","youtube.com/")).replace("watch?v=","")).replace("?","&")).indexOf("youtube.com/")>-1){e=e.split("youtube.com/").splice(1,1)[0];try{for(var i=B(e.split("&")),r=i.next();!r.done;r=i.next()){var s=r.value;s.indexOf("=")<0?o.id=s:s.startsWith("t=")?o.start=s.substring(2):s.startsWith("start=")&&(o.start=s.substring(6))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}if(o.id)return o},e.prototype.applyYoutube=function(){var e=this.parseYoutube(this.youtubeInput.value);if(e){var t=this.editor.state.tr.replaceSelectionWith(this.editor.state.schema.nodes.youtube.create({id:e.id,start:e.start||0}));this.editor.view.dispatch(t)}this.popoverController.dismiss(void 0,"youtube")},e.prototype.cancel=function(){this.popoverController.dismiss()},e.prototype.ngOnInit=function(){},e.prototype.ionViewWillLeave=function(e){return P(this,void 0,void 0,(function(){return A(this,(function(t){return this.inputView||e.role||this.editor.focus(),[2]}))}))},e.prototype.ionViewDidLeave=function(e){return P(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return this.inputView?[4,h.sleep(50)]:[3,2];case 1:return t.sent(),this.editor.focus(),[3,3];case 2:e.role||this.editor.focus(),t.label=3;case 3:return[2]}}))}))},e.ctorParameters=function(){return[{type:l.PopoverController},{type:l.ModalController}]},L([n.Input()],e.prototype,"editor",void 0),L([n.ViewChild("youtubeInput",{static:!1})],e.prototype,"youtubeInput",void 0),e=L([n.Component({template:'\n        <ion-list lines="full">\n            \n            <ng-template [ngIf]="!inputView">\n                \n                <ion-item button="true" detail="false" (click)="insertLink()">\n                    <ion-label>{{"@co.mmons/ionic-extensions/html-editor#link/Link" | intlMessage}}</ion-label>\n                    <ion-icon name="link" slot="start"></ion-icon>\n                </ion-item>\n    \n                <ion-item button="true" detail="false" (click)="insertYoutube()">\n                    <ion-label>{{"@co.mmons/ionic-extensions/html-editor#youtube/YouTube video" | intlMessage}}</ion-label>\n                    <ion-icon name="logo-youtube" slot="start"></ion-icon>\n                </ion-item>\n                \n            </ng-template>\n            \n            <ng-template [ngIf]="inputView == \'youtube\'">\n\n                <ion-item>\n                    <ion-icon name="logo-youtube" slot="start"></ion-icon>\n                    <ion-input #youtubeInput [placeholder]="\'@co.mmons/ionic-extensions/html-editor#youtube/Paste YouTube video url\' | intlMessage" (keydown.enter)="applyYoutube()"></ion-input>\n                </ion-item>\n                \n                <ion-item>\n                    <ionx-buttons slot="end">\n                        <ion-button fill="clear" color="dark" (click)="cancel()">\n                            <ion-label>{{"@co.mmons/js-intl#Cancel" | intlMessage}}</ion-label>\n                        </ion-button>\n                        \n                        <ion-button fill="clear" color="primary" (click)="applyYoutube()">\n                            <ion-label>{{"@co.mmons/js-intl#Ok" | intlMessage}}</ion-label>\n                        </ion-button>\n                    </ionx-buttons>\n                </ion-item>\n    \n            </ng-template>\n            \n        </ion-list>\n    ',styles:[":host ion-list { margin: 0px; padding: 0px }",":host ion-item:last-child { --border-width: 0px; }",":host ion-item { --highlight-height: 0px; }"]})],e)}(),ie=function(e,t){return function(n,o,i){return Array.isArray(e)||(e=[e]),!e.some((function(e){return!e(n,i)}))&&(t(n,o,i)||!1)}},re=function(e){var t=e.selection,n=t.empty,o=t.$from;return n&&(0===o.parentOffset||e.selection instanceof g.GapCursor)};function se(e,t,n){var o=t.$from,i=t.$to,r=e.schema.nodes.listItem,s=o.blockRange(i,(function(e){return!!e.childCount&&!!e.firstChild&&e.firstChild.type===r}));if(!s||s.depth<2||o.node(s.depth-1).type!==r)return n;var a=s.end,l=i.end(s.depth);return a<l&&(n.step(new S.ReplaceAroundStep(a-1,l,a,l,new d.Slice(d.Fragment.from(r.create(void 0,s.parent.copy())),1,0),1,!0)),s=new d.NodeRange(n.doc.resolve(o.pos),n.doc.resolve(l),s.depth)),n.lift(s,S.liftTarget(s)).scrollIntoView()}var ae=function(e,t){for(var n=t.depth,o=e.nodes,i=o.bulletList,r=o.orderedList,s=o.listItem,a=t.depth;a>0;a--){var l=t.node(a);if(l.type!==i&&l.type!==r||(n=a),l.type!==i&&l.type!==r&&l.type!==s)break}return n-1};var le=function(e){var t,n=e.tr.selection,o=n.$from,i=n.$to;return e.doc.nodesBetween(o.pos,i.pos,(function(n,o){n.marks.forEach((function(i){if(!n.type.allowsMarkType(i.type)){var r=n.marks.filter((function(e){return e.type!==i.type})),s=o>0?o-1:0;t=(t||e.tr).setNodeMarkup(s,void 0,n.attrs,r)}}))})),t};function ce(e,t,n,o){return 0===function(e,t,n){var o=Array(),i=ue(e,t).depth,r=e.resolve(t.start(i));for(;r.pos<=n.start(n.depth);){var s=Math.min(r.depth,i),a=r.node(s);if(a&&o.push(a),0===s)break;var l=e.resolve(r.after(s));if(l.start(s)>=e.nodeSize-2)break;l.depth!==r.depth&&(l=e.resolve(l.pos+2)),r=l.depth?e.resolve(l.start(l.depth)):e.resolve(l.end(l.depth))}return o}(e,t,n).filter((function(e){return e.type!==o})).length}function ue(e,t){var n=["blockquote","bulletList","orderedList"];if(1===t.depth)return t;for(var o=t.node(t.depth),i=t;t.depth>=1;)(o=(t=e.resolve(t.before(t.depth))).node(t.depth))&&-1!==n.indexOf(o.type.name)&&(i=t);return i}function de(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=H([e],t);return function(e){return o.reduceRight((function(e,t){return t(e)}),e)}}function pe(e){if(!e.parent.type.spec.isolating)for(var t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}var fe=5,me=function(e,t){var n=e.selection.$from,o=e.schema.nodes.listItem,i=pe(n);if(!i||!i.nodeBefore||i.nodeBefore.type!==o)return!1;if(1===i.nodeBefore.childCount&&i.nodeBefore.firstChild&&i.nodeBefore.firstChild.nodeSize<=2){var r=e.tr;return t&&t(r.delete(i.pos-i.nodeBefore.nodeSize,n.pos).scrollIntoView()),!0}return!1},he=function(e,t){var n=e.selection.$from,o=e.schema.nodes,i=o.paragraph,r=o.listItem,s=o.codeBlock,a=o.bulletList,l=o.orderedList,c=e.selection instanceof g.GapCursor,u=pe(c?e.doc.resolve(n.pos+1):n);if(!u)return!1;if(u.nodeBefore&&[a,l].indexOf(u.nodeBefore.type)>-1&&u.nodeAfter&&(u.nodeAfter.type===i||u.nodeAfter.type===s)){for(var p=u.doc.resolve(u.pos-1);p.parent.type!==i;)p=e.doc.resolve(p.pos-1);var f=e.tr;if(c){var m=M.findPositionOfNodeBefore(f.selection);if("number"!=typeof m)return!1;var h=u.nodeBefore.copy(u.nodeBefore.content.append(d.Fragment.from(r.createChecked({},u.nodeAfter))));f.replaceWith(m,n.pos+u.nodeAfter.nodeSize,h)}else f=e.tr.step(new S.ReplaceAroundStep(p.pos,u.pos+u.nodeAfter.nodeSize,u.pos+1,u.pos+u.nodeAfter.nodeSize-1,e.tr.doc.slice(p.pos,u.pos),0,!0));var v=f.doc.resolve(f.mapping.map(u.pos+u.nodeAfter.nodeSize));return v.nodeBefore&&v.nodeAfter&&v.nodeBefore.type===v.nodeAfter.type&&[a,l].indexOf(v.nodeBefore.type)>-1&&(f=f.join(v.pos)),t&&t(f.scrollIntoView()),!0}return!1},ve=function(e){var t=e.selection.$from,n=e.schema.nodes,o=n.listItem,i=n.paragraph;return e.selection instanceof g.GapCursor?t.parent.type===o:M.hasParentNodeOfType(o)(e.selection)&&t.parent.type===i},ge=function(e){var t=e.selection.$from,n=e.schema.nodes,o=n.bulletList,i=n.orderedList,r=e.doc.resolve(t.pos-1),s=r?r.nodeBefore:null;return e.selection instanceof g.GapCursor&&(s=t.nodeBefore),!!s&&[o,i].indexOf(s.type)>-1},ye=function(e){var t=e.selection.$from.parent,n=e.schema.nodes,o=n.listItem,i=n.paragraph;return e.selection instanceof g.GapCursor?t.type===o:t.type===i&&M.hasParentNodeOfType(o)(e.selection)};v.chainCommands(ie([re,function(e){var t=e.selection.$from;return!(t.depth>1)||(e.selection instanceof g.GapCursor&&0===t.parentOffset||0===t.index(t.depth-1))},ye],v.chainCommands(me,be())),ie([re,ge],he));function be(){return function(e,t){var n=e.schema.nodes.listItem,o=e.selection,i=o.$from,r=o.$to;if(ve(e)){var s=i.blockRange(r,(function(e){return e.childCount>0&&e.firstChild&&e.firstChild.type===n}));return!!s&&de(function(e,t){return function(n){return function(o,i){return n(o,(function(n){var r=o.doc.resolve(t.start),s=o.doc.resolve(t.end),a=n.doc.resolve(n.mapping.map(t.end-1));a.nodeBefore&&a.nodeAfter&&a.nodeBefore.type===a.nodeAfter.type&&s.nodeAfter&&s.nodeAfter.type===e&&s.parent.type===r.parent.type&&n.join(a.pos),i&&i(n.scrollIntoView())}))}}}(n,s),f.liftListItem)(n)(e,t)}return!1}}function ke(){return function(e,t){var n=e.schema.nodes.listItem;return!!ve(e)&&(function(e,t){var n,o=t.tr.selection.$to.pos;do{var i=t.doc.resolve(o);if((n=xe(i,t.schema.nodes))>fe)return!1;o++}while(n>=e);return!0}(xe(e.selection.$from,e.schema.nodes),e)&&de(f.sinkListItem)(n)(e,t),!0)}}function we(){return function(e,t){var n=e.tr,o=e.selection,i=o.$from,r=o.$to;return n.doc.nodesBetween(i.pos,r.pos,(function(t,o){if(t.isTextblock||"blockquote"===t.type.name||"panel"===t.type.name){var i=new k.NodeSelection(n.doc.resolve(n.mapping.map(o))),r=i.$from.blockRange(i.$to);if(!r||i.$from.parent.type!==e.schema.nodes.listItem)return!1;var s=r&&S.liftTarget(r);if(null==s)return!1;n.lift(r,s)}})),t&&t(n),!0}}var xe=function(e,t){for(var n=t.bulletList,o=t.orderedList,i=0,r=e.depth-1;r>0;r--){var s=e.node(r);s.type!==n&&s.type!==o||(i+=1)}return i},Me=function(e,t,n,o){var i=e.selection,r=i.$from.node(i.$from.depth-2),s=i.$to.node(i.$to.depth-2);if(r&&r.type.name===o&&s&&s.type.name===o){var a=function(e,t){for(var n,o=t.bulletList,i=t.orderedList,r=t.listItem,s=e.depth-1;s>0;s--){var a=e.node(s);if(a.type!==o&&a.type!==i||(n=s),a.type!==o&&a.type!==i&&a.type!==r)break}return n}(i.$to,e.schema.nodes),l=function(e,t,n,o,i){var r=e.schema.nodes.listItem,s=!1;return i.doc.nodesBetween(t,n,(function(n,a){if(!s&&n.type===r&&a>t){s=!0;for(var l=o+3;l>o+2;){var c=i.doc.resolve(i.mapping.map(a));l=c.depth;var u=i.doc.resolve(i.mapping.map(a+n.textContent.length)),d=new k.TextSelection(c,u);i=se(e,d,i)}}})),i}(e,i.$to.pos,i.$to.end(a),a||0,e.tr);return t(l=function(e,t){var n=e.selection,o=n.from,i=n.to,r=e.schema.nodes.paragraph,s=[];t.doc.nodesBetween(o,i,(function(e,t){e.type===r&&s.push({node:e,pos:t})}));for(var a=s.length-1;a>=0;a--){var l=s[a],c=t.doc.resolve(t.mapping.map(l.pos));if(c.depth>0){var u=void 0;u=l.node.textContent&&l.node.textContent.length>0?t.doc.resolve(t.mapping.map(l.pos+l.node.textContent.length)):t.doc.resolve(t.mapping.map(l.pos+1));var d=c.blockRange(u);d&&t.lift(d,ae(e.schema,c))}}return t}(e,l)),!0}return function(e){return function(t,n,o){if(n&&n(t.tr.setSelection(function(e,t){var n=t.$from,o=t.$to,i=n.pos===o.pos,r=n.pos,s=o.pos;if(i&&r===e.nodeSize-3)return t;if(n.nodeBefore&&!i){r++;for(var a=e.nodeAt(r);!a||a&&!a.isText;)r++,a=e.nodeAt(r)}return s===r?new k.TextSelection(e.resolve(r)):new k.TextSelection(e.resolve(r),e.resolve(s))}(t.doc,t.selection))),!o)return!1;var i=(t=o.state).selection,r=i.$from,s=i.$to,a=ce(t.doc,r,s,t.schema.nodes[e]);if(function(e,t){var n=e.selection.$from,o=n.node(-2),i=n.node(-3);return o&&o.type===e.schema.nodes[t]||i&&i.type===e.schema.nodes[t]}(t,e)&&a)return we()(t,n);a||(we()(t,n),t=o.state);var l,c=le(t);return c&&(n&&n(c),t=o.state),(l=t.schema.nodes[e],v.autoJoin(f.wrapInList(l),(function(e,t){return e.type===t.type&&e.type===l})))(t,n)}}(o)(e,t,n)};var Ce=function(){function e(e){this.popoverController=e}return e.prototype.level=function(e){var t=this,n=e<0?be():ke();n(this.editor.state)&&n(this.editor.state,(function(e){return t.editor.view.dispatch(e)})),this.popoverController.dismiss()},e.prototype.toggleList=function(e){var t=this;Me(this.editor.state,(function(e){return t.editor.view.dispatch(e)}),this.editor.view,e),this.popoverController.dismiss()},e.prototype.ngOnInit=function(){this.activeUnnumberedList=!!M.findParentNode((function(e){return e.hasMarkup(R.nodes.bulletList)}))(this.editor.state.selection),this.activeNumberedList=!!M.findParentNode((function(e){return e.hasMarkup(R.nodes.orderedList)}))(this.editor.state.selection)},e.prototype.ionViewWillLeave=function(){this.editor.focus()},e.ctorParameters=function(){return[{type:l.PopoverController}]},L([n.Input()],e.prototype,"editor",void 0),e=L([n.Component({template:'\n        <ion-list lines="full">\n\n            <ion-item button="true" detail="false" (click)="toggleList(\'bulletList\')">\n                <ion-label>{{"@co.mmons/ionic-extensions/html-editor#listMenu/Bulleted list" | intlMessage}}</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeUnnumberedList"></ion-icon>\n                <ion-icon src="assets/html-editor/list-bulleted.svg" slot="start"></ion-icon>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggleList(\'orderedList\')">\n                <ion-label>{{"@co.mmons/ionic-extensions/html-editor#listMenu/Numbered list" | intlMessage}}</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeNumberedList"></ion-icon>\n                <ion-icon src="assets/html-editor/list-numbered.svg" slot="start"></ion-icon>\n            </ion-item>\n\n            <ng-template [ngIf]="activeUnnumberedList || activeNumberedList">\n\n                <ion-item-divider>\n                    <ion-label>{{"@co.mmons/ionic-extensions/html-editor#listMenu/Indent" | intlMessage}}</ion-label>\n                </ion-item-divider>\n\n                <ion-item button="true" detail="false" (click)="level(-1)">\n                    <ion-label>{{"@co.mmons/ionic-extensions/html-editor#listMenu/Decrease indent" | intlMessage}}</ion-label>\n                    <ion-icon src="assets/html-editor/indent-decrease.svg" slot="start"></ion-icon>\n                </ion-item>\n\n                <ion-item button="true" detail="false" (click)="level(1)">\n                    <ion-label>{{"@co.mmons/ionic-extensions/html-editor#listMenu/Increase indent" | intlMessage}}</ion-label>\n                    <ion-icon src="assets/html-editor/indent-increase.svg" slot="start"></ion-icon>\n                </ion-item>\n\n            </ng-template>\n\n        </ion-list>\n    ',styles:["\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    "]})],e)}(),Ie=function(){function e(t){this.size=t,e._sizes.push(this),this.label=new u.MessageRef("@co.mmons/ionic-extensions/html-editor","textMenu/fontSize/"+t.toUpperCase()[0]+t.substring(1))}return e.sizes=function(){return e._sizes.slice()},e._sizes=[],e.small=new e("small"),e.large=new e("large"),e}();function Se(e,t){return function(n,o){var i=n.selection,r=i.empty,s=i.from,a=i.to,l=i.$from;if(!function(e,t,n,o){var i=!1;return e.nodesBetween(t,n,(function(e,t,n){if(i)return!1;i=e.isInline&&n.type.allowsMarkType(o)})),i}(n.doc,s,a,e))return console.log("not applies"),!1;if(o)if(r){var c=e.isInSet(n.storedMarks||l.marks());!c||t&&!I.shallowEqual(c.attrs,t)?o(n.tr.addStoredMark(e.create(t))):o(n.tr.removeStoredMark(e))}else!function(e,t,n,o,i){var r=null;return e.nodesBetween(t,n,(function(e){for(var t=0;t<e.marks.length;t++){var n=e.marks[t].type===o&&(!i||I.shallowEqual(e.marks[t].attrs,i));r=n&&(null===r||!0===r)}return r})),!!r}(n.doc,s,a,e,t)?o(n.tr.addMark(s,a,e.create(t)).scrollIntoView()):o(n.tr.removeMark(s,a,e).scrollIntoView());return!0}}function ze(e,t){var n=e.selection,o=n.from,i=n.$from,r=n.to;return n.empty?!!t.isInSet(e.storedMarks||i.marks()):e.doc.rangeHasMark(o,r,t)}var Le=function(){function e(e){this.popoverController=e,this.FontSize=Ie}return e.prototype.toggle=function(e){var t,n=this;"bold"===e?t=v.toggleMark(R.marks.strong):"italic"===e?t=v.toggleMark(R.marks.em):"underline"===e&&(t=v.toggleMark(R.marks.underline)),t(this.editor.state)&&t(this.editor.state,(function(e){return n.editor.view.dispatch(e)})),this.popoverController.dismiss()},e.prototype.resetFontSize=function(){var e=this;v.toggleMark(R.marks.fontSize)(this.editor.state,(function(t){return e.editor.view.dispatch(t)})),this.popoverController.dismiss()},e.prototype.toggleFontSize=function(e){var t=this,n=Se(R.marks.fontSize,{fontSize:e.size});n(this.editor.state)&&n(this.editor.state,(function(e){return t.editor.view.dispatch(e)})),this.popoverController.dismiss()},e.prototype.ngOnInit=function(){var e,t,n,o;this.boldActivated=ze(this.editor.state,R.marks.strong),this.italicActivated=ze(this.editor.state,R.marks.em),this.underlineActivated=ze(this.editor.state,R.marks.underline),this.activeFontSize=void 0;try{e:for(var i=B(ee(this.editor.state,R.marks.fontSize)),r=i.next();!r.done;r=i.next()){var s=r.value;try{for(var a=B(Ie.sizes()),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.size===s.attrs.fontSize){if(this.activeFontSize&&c!==this.activeFontSize){this.activeFontSize=void 0;break e}this.activeFontSize=c}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.ionViewWillLeave=function(){this.editor.focus()},e.ctorParameters=function(){return[{type:l.PopoverController}]},L([n.Input()],e.prototype,"editor",void 0),e=L([n.Component({template:'\n        <ion-list lines="full">\n            \n            <ion-item button="true" detail="false" (click)="toggle(\'bold\')">\n                <ion-label style="font-weight: bold">{{"@co.mmons/ionic-extensions/html-editor#textMenu/Bold" | intlMessage}}</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="boldActivated"></ion-icon>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggle(\'italic\')">\n                <ion-label style="font-style: italic">{{"@co.mmons/ionic-extensions/html-editor#textMenu/Italic" | intlMessage}}</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="italicActivated"></ion-icon>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggle(\'underline\')">\n                <ion-label style="text-decoration: underline">{{"@co.mmons/ionic-extensions/html-editor#textMenu/Underline" | intlMessage}}</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="underlineActivated"></ion-icon>\n            </ion-item>\n            \n            <ion-item-divider>\n                <ion-label>{{"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Text size" | intlMessage}}</ion-label>\n            </ion-item-divider>\n\n            <ion-item button="true" detail="false" (click)="resetFontSize()" *ngIf="activeFontSize">\n                <ion-label>{{"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Default" | intlMessage}}</ion-label>\n            </ion-item>\n\n            <ion-item button="true" detail="false" (click)="toggleFontSize(fontSize)" *ngFor="let fontSize of FontSize.sizes()">\n                <ion-label [style.fontSize]="fontSize.size">{{fontSize.label | intlMessage}}</ion-label>\n                <ion-icon name="checkmark" slot="end" *ngIf="activeFontSize === fontSize"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    ',styles:["\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    "]})],e)}();var Oe=function(){function e(e,t,n,o,i){this.popoverController=e,this.platform=t,this.editor=n,this.eventManager=o,this.modalController=i,this.activeFeatures={}}return e.prototype.showMenu=function(e,t){return P(this,void 0,void 0,(function(){var n;return A(this,(function(o){switch(o.label){case 0:return n={text:Le,list:Ce,alignment:N,insert:oe,heading:X},[4,this.popoverController.create({component:n[t],componentProps:{editor:this.editor},event:e,showBackdrop:this.platform.is("ios")})];case 1:return o.sent().present(),[2]}}))}))},e.prototype.editLink=function(){return P(this,void 0,void 0,(function(){return A(this,(function(e){return ne.present(this.modalController,this.editor),[2]}))}))},e.prototype.undo=function(){var e=this;y.undo(this.editor.view.state,(function(t){return e.editor.view.updateState(e.editor.view.state.apply(t))})),this.editor.focus()},e.prototype.redo=function(){var e=this;y.redo(this.editor.view.state,(function(t){return e.editor.view.updateState(e.editor.view.state.apply(t))})),this.editor.focus()},e.prototype.editorSelectionChanged=function(){this.canUndo=y.undoDepth(this.editor.view.state)>0,this.canRedo=y.redoDepth(this.editor.view.state)>0,this.activeFeatures={},this.activeFeatures.text=function(e,t){var n,o,i,r,s=e.selection,a=s.from,l=s.$from,c=s.to;if(s.empty)try{for(var u=B(t),d=u.next();!d.done;d=u.next()){if((m=d.value).isInSet(e.storedMarks||l.marks()))return!0}}catch(e){n={error:e}}finally{try{d&&!d.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}else try{for(var p=B(t),f=p.next();!f.done;f=p.next()){var m=f.value;if(e.doc.rangeHasMark(a,c,m))return!0}}catch(e){i={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(i)throw i.error}}return!1}(this.editor.view.state,[R.marks.strong,R.marks.em,R.marks.underline,R.marks.fontSize]),this.activeFeatures.list=!!M.findParentNode((function(e){return e.hasMarkup(R.nodes.orderedList)||e.hasMarkup(R.nodes.bulletList)}))(this.editor.state.selection),this.activeFeatures.alignment=function(e,t){var n,o,i=e.selection,r=i.from,s=i.$from,a=i.to;if(!i.empty)return e.doc.rangeHasMark(r,a,t);try{for(var l=B(s.parent.marks),c=l.next();!c.done;c=l.next()){if(c.value.type===t)return!0}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}}(this.editor.view.state,R.marks.alignment),this.activeFeatures.heading=!!M.findParentNodeOfType(R.nodes.heading)(this.editor.state.selection),this.activeFeatures.link=ze(this.editor.view.state,R.marks.link)},e.prototype.ngOnInit=function(){return P(this,void 0,void 0,(function(){var e=this;return A(this,(function(t){return this.selectionSubscription=this.editor.selectionChange.subscribe((function(){return e.editorSelectionChanged()})),this.editorSelectionChanged(),[2]}))}))},e.prototype.ngOnDestroy=function(){C.unsubscribe(this.selectionSubscription)},e.ctorParameters=function(){return[{type:l.PopoverController},{type:l.Platform},{type:K},{type:m.EventManager},{type:l.ModalController}]},e=L([n.Component({selector:"ionx-html-editor-toolbar",template:'\n        <ion-button size="small" fill="clear" [class.active-feature]="activeFeatures.text" (click)="showMenu($event, \'text\')">\n            <ion-icon name="md-arrow-dropdown" slot="end"></ion-icon>\n            <span>{{"@co.mmons/ionic-extensions/html-editor#Text" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size="small" fill="clear" [class.active-feature]="activeFeatures.alignment" (click)="showMenu($event, \'alignment\')" *ngIf="!editor.features || editor.features.alignment">\n            <ion-icon name="md-arrow-dropdown" slot="end"></ion-icon>\n            <span>{{"@co.mmons/ionic-extensions/html-editor#Alignment" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size="small" fill="clear" [class.active-feature]="activeFeatures.heading" (click)="showMenu($event, \'heading\')" *ngIf="!editor.features || editor.features.heading">\n            <ion-icon name="md-arrow-dropdown" slot="end"></ion-icon>\n            <span>{{"@co.mmons/ionic-extensions/html-editor#Heading" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size="small" fill="clear" [class.active-feature]="activeFeatures.list" (click)="showMenu($event, \'list\')" *ngIf="!editor.features || editor.features.list">\n            <ion-icon name="md-arrow-dropdown" slot="end"></ion-icon>\n            <span>{{"@co.mmons/ionic-extensions/html-editor#listMenu/List" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size="small" fill="clear" (click)="showMenu($event, \'insert\')" *ngIf="!editor.features || editor.features.link || editor.features.multimedia">\n            <ion-icon name="md-arrow-dropdown" slot="end"></ion-icon>\n            <span>{{"@co.mmons/ionic-extensions/html-editor#Insert" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size="small" fill="clear" class="active-feature" (click)="editLink()" *ngIf="activeFeatures.link">\n            <span>{{"@co.mmons/ionic-extensions/html-editor#link/Link" | intlMessage}}</span>\n        </ion-button>\n        \n        <div ionx--buttons-group>\n            <ion-button size="small" fill="clear" tabindex="-1" title="{{\'@co.mmons/ionic-extensions/html-editor#Undo\' | intlMessage}}" [disabled]="!canUndo" (click)="undo()">\n                <ion-icon name="undo" slot="icon-only"></ion-icon>\n            </ion-button>\n    \n            <ion-button size="small" fill="clear" title="{{\'@co.mmons/ionic-extensions/html-editor#Redo\' | intlMessage}}" [disabled]="!canRedo" (click)="redo()">\n                <ion-icon name="redo" slot="icon-only"></ion-icon>\n            </ion-button>\n        </div>\n    ',styles:['\n        :host { outline: none; display: flex; justify-content: center; flex-wrap: wrap; position: sticky; position: -webkit-sticky; top: 0px; background-color: var(--background); }\n        :host-context(.ion-focused) { background-color: var(--background-focused); }\n        :host ion-button { margin: 0px 4px; --padding-end: 2px; --padding-start: 4px; }\n        :host ion-button.active-feature span { font-weight: 800; }\n        :host ion-icon[slot="end"] { margin: 0px; }\n        :host ion-button[disabled] { opacity: 0.5; }\n        :host [ionx--buttons-group] { display: flex; }\n        :host [ionx--buttons-group] ion-button:not(:last-child) { margin-right: 0px; }\n    ']})],e)}(),Pe=function(){function e(){}return e=L([n.NgModule({imports:[t.CommonModule,l.IonicModule,r.IntlModule,a.SelectModule,o.FormsModule,o.ReactiveFormsModule,s.FormHelperModule,c.ButtonsModule,i.MatchMediaModule],declarations:[K,N,X,oe,ne,Ce,Le,Oe],exports:[K,r.IntlModule],entryComponents:[N,X,oe,ne,Ce,Le]})],e)}();e.HtmlEditor=K,e.HtmlEditorModule=Pe,e.a=N,e.b=X,e.c=oe,e.d=ne,e.e=Ce,e.f=Le,e.g=Oe,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=html-editor-module.umd.min.js.map