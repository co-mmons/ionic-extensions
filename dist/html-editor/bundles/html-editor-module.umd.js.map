{"version":3,"file":"html-editor-module.umd.js","sources":["../../../node_modules/tslib/tslib.es6.js","../../../src/html-editor/alignment.ts","../../../src/html-editor/prosemirror/commands/toogle-block-mark.ts","../../../src/html-editor/prosemirror/alignment/commands.ts","../../../src/html-editor/prosemirror/marks/font-size.ts","../../../src/html-editor/prosemirror/marks/alignment.ts","../../../src/html-editor/prosemirror/nodes/youtube.ts","../../../src/html-editor/prosemirror/schema.ts","../../../src/html-editor/prosemirror/utils/selection/find-block-marks.ts","../../../src/html-editor/alignment-menu.ts","../../../src/html-editor/prosemirror/keymap.ts","../../../src/html-editor/prosemirror/views/youtube.ts","../../../src/html-editor/scroll.ts","../../../src/html-editor/editor.ts","../../../src/html-editor/heading-menu.ts","../../../src/html-editor/link-type.ts","../../../src/html-editor/prosemirror/utils/find-marks.ts","../../../src/html-editor/prosemirror/utils/find-marks-in-selection.ts","../../../src/html-editor/prosemirror/utils/find-node-start-end.ts","../../../src/html-editor/link-modal.ts","../../../src/html-editor/insert-menu.ts","../../../src/html-editor/prosemirror/commands/filter.ts","../../../src/html-editor/prosemirror/commands/is-empty-selection-at-start.ts","../../../src/html-editor/prosemirror/commands/is-first-child-of-parent.ts","../../../src/html-editor/prosemirror/document-utils.ts","../../../src/html-editor/prosemirror/list/transforms/lift-following-list.ts","../../../src/html-editor/prosemirror/list/utils/get-list-lift-target.ts","../../../src/html-editor/prosemirror/list/transforms/lift-selection-list.ts","../../../src/html-editor/prosemirror/mark-utils.ts","../../../src/html-editor/prosemirror/utils.ts","../../../src/html-editor/prosemirror/utils/find-cut-before.ts","../../../src/html-editor/prosemirror/list-commands.ts","../../../src/html-editor/list-menu.ts","../../../src/html-editor/font-sizes.ts","../../../src/html-editor/prosemirror/commands/toogle-inline-mark.ts","../../../src/html-editor/prosemirror/is-active.ts","../../../src/html-editor/text-format-menu.ts","../../../src/html-editor/prosemirror/utils/selection/is-block-mark-active.ts","../../../src/html-editor/toolbar.ts","../../../src/html-editor/index.ts","../../../src/html-editor/html-editor-module.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","import {MessageRef} from \"@co.mmons/js-intl\";\n\nexport class Alignment {\n\n    private static _alignments: Alignment[] = [];\n\n    static alignments() {\n        return Alignment._alignments.slice();\n    }\n\n    static readonly left = new Alignment(\"left\");\n    static readonly right = new Alignment(\"right\");\n    static readonly center = new Alignment(\"center\");\n    static readonly justify = new Alignment(\"justify\");\n\n    private constructor(public readonly alignment: string) {\n\n        Alignment._alignments.push(this);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"alignmentMenu/\" + alignment);\n    }\n\n    readonly label: MessageRef;\n}\n","import {MarkType, Node as PMNode, NodeType, Schema} from \"prosemirror-model\";\nimport {Transaction} from \"prosemirror-state\";\nimport {Command} from \"../command\";\n\n/**\n * Toggles block mark based on the return type of `getAttrs`.\n * This is similar to ProseMirror\"s `getAttrs` from `AttributeSpec`\n * return `false` to remove the mark.\n * return `undefined for no-op.\n * return an `object` to update the mark.\n */\nexport const toggleBlockMark = <T = object>(\n    markType: MarkType,\n    getAttrs: ((prevAttrs?: T, node?: PMNode) => T | undefined | false),\n    allowedBlocks?:\n        | Array<NodeType>\n        | ((schema: Schema, node: PMNode, parent: PMNode) => boolean),\n): Command => (state, dispatch) => {\n    let markApplied = false;\n    const tr = state.tr;\n\n    const toggleBlockMarkOnRange = (from: number, to: number, tr: Transaction) => {\n\n        state.doc.nodesBetween(from, to, (node, pos, parent) => {\n\n            if (!node.type.isBlock) {\n                return false;\n            }\n\n            if (\n                (!allowedBlocks || (Array.isArray(allowedBlocks) ? allowedBlocks.indexOf(node.type) > -1 : allowedBlocks(state.schema, node, parent))) &&\n                parent.type.allowsMarkType(markType)\n            ) {\n\n                const oldMarks = node.marks.filter(mark => mark.type === markType);\n\n                const prevAttrs = oldMarks.length ? (oldMarks[0].attrs as T) : undefined;\n                const newAttrs = getAttrs(prevAttrs, node);\n\n                if (newAttrs !== undefined) {\n\n                    tr.setNodeMarkup(\n                        pos,\n                        node.type,\n                        node.attrs,\n                        node.marks\n                            .filter(mark => !markType.excludes(mark.type))\n                            .concat(newAttrs === false ? [] : markType.create(newAttrs)),\n                    );\n\n                    markApplied = true;\n                }\n            }\n\n            return;\n\n        });\n    };\n\n    const {from, to} = state.selection;\n    toggleBlockMarkOnRange(from, to, tr);\n\n    if (markApplied && tr.docChanged) {\n        if (dispatch) {\n            dispatch(tr.scrollIntoView());\n        }\n        return true;\n    }\n\n    return false;\n};\n","import {EditorState, Transaction} from \"prosemirror-state\";\nimport {Command, CommandDispatch} from \"../command\";\nimport {toggleBlockMark} from \"../commands/toogle-block-mark\";\nimport {AlignmentState} from \"./alignment-state\";\n\n/**\n * Iterates over the commands one after the other,\n * passes the tr through and dispatches the cumulated transaction\n */\nexport const cascadeCommands = (cmds: Array<Command>) => (\n    state: EditorState,\n    dispatch?: CommandDispatch,\n) => {\n    const {tr: baseTr} = state;\n    let shouldDispatch = false;\n\n    const onDispatchAction = (tr: Transaction) => {\n        tr.steps.forEach(st => {\n            baseTr.step(st);\n        });\n        shouldDispatch = true;\n    };\n\n    cmds.forEach(cmd => {\n        cmd(state, onDispatchAction);\n    });\n\n    if (dispatch && shouldDispatch) {\n        dispatch(baseTr);\n        return true;\n    }\n    return false;\n};\n\nexport const isAlignable = (align?: AlignmentState): Command => (state, dispatch) => {\n\n    const {\n        nodes: {paragraph, heading},\n        marks: {alignment},\n    } = state.schema;\n\n    return toggleBlockMark(\n        alignment,\n        () => (!align ? undefined : align === \"left\" ? false : {align}),\n        [paragraph, heading],\n    )(state, dispatch);\n};\n\nexport const changeAlignment = (align?: AlignmentState): Command => (state, dispatch) => {\n\n    const {\n        nodes: {paragraph, heading},\n        marks: {alignment}\n    } = state.schema;\n\n    return toggleBlockMark(alignment,\n        () => (!align ? undefined : align === \"left\" ? false : {align}),\n        [paragraph, heading],\n    )(state, dispatch);\n};\n","import {MarkSpec} from \"prosemirror-model\";\n\nexport const fontSize: MarkSpec = {\n    excludes: \"fontSize\",\n    group: \"fontSize\",\n    attrs: {\n        fontSize: {},\n    },\n    parseDOM: [\n        {\n            tag: \"span[data-font-size]\",\n            getAttrs: dom => {\n                const size = (dom as Element).getAttribute(\"data-font-size\");\n                return size ? {fontSize: size} : false;\n            },\n        },\n    ],\n    toDOM(mark) {\n        return [\n            \"span\",\n            {style: `font-size: ${mark.attrs.fontSize}`, \"data-font-size\": mark.attrs.fontSize},\n            0\n        ];\n    },\n};\n","import {MarkSpec} from \"prosemirror-model\";\n\nexport const alignment: MarkSpec = {\n    excludes: \"alignment\",\n    group: \"alignment\",\n    attrs: {\n        align: {},\n    },\n    parseDOM: [\n        {\n            tag: \"div[data-align]\",\n            getAttrs: dom => {\n                const align = (dom as Element).getAttribute(\"data-align\");\n                return align ? {align} : false;\n            },\n        },\n    ],\n    toDOM(mark) {\n        return [\n            \"div\",\n            {\n                style: `text-align: ${mark.attrs.align}`,\n                \"data-align\": mark.attrs.align,\n            },\n            0\n        ];\n    },\n};\n","import {NodeSpec} from \"prosemirror-model\";\n\nexport const youtube: NodeSpec = {\n    attrs: {id: {default: \"\"}, start: {default: 0}},\n    inline: false,\n    group: \"block\",\n    draggable: false,\n\n    toDOM: (node) => {\n\n        return [\n            \"div\",\n            {\"data-youtube\": node.attrs.id + (node.attrs.start ? \",\" + node.attrs.start : \"\")}\n        ];\n    },\n\n    parseDOM: [\n        {\n            tag: \"div[data-youtube]\",\n            getAttrs: (dom) => {\n\n                // @ts-ignore\n                const info = dom.getAttribute(\"data-youtube\").split(\",\");\n\n                return {\n                    id: info[0],\n                    start: info.length > 1 ? info[1] : 0\n                };\n            },\n        }\n    ]\n};\n","import {MarkSpec, NodeSpec, Schema} from \"prosemirror-model\";\nimport {marks as basicMarks, nodes as basicNodes} from \"prosemirror-schema-basic\";\nimport {bulletList, listItem, orderedList} from \"prosemirror-schema-list\";\nimport {fontSize} from \"./marks/font-size\";\nimport {alignment} from \"./marks/alignment\";\nimport {youtube} from \"./nodes/youtube\";\n\nexport const nodes = {\n    doc: {\n        content: \"block+\",\n        marks: \"alignment\",\n    },\n\n    paragraph: {\n        content: \"inline*\",\n        marks: \"alignment strong underline em fontSize link\",\n        group: \"block\",\n        parseDOM: [{tag: \"p\"}],\n        toDOM() { return [\"p\", 0]; }\n    } as NodeSpec,\n\n    blockquote: basicNodes.blockquote,\n    horizontalRule: basicNodes.horizontal_rule,\n    heading: basicNodes.heading,\n    text: basicNodes.text,\n    hardBreak: basicNodes.hard_break,\n\n    bulletList: Object.assign({}, bulletList, {\n        content: \"listItem+\",\n        group: \"block\"\n    }) as NodeSpec,\n\n    orderedList: Object.assign({}, orderedList, {\n        content: \"listItem+\",\n        group: \"block\"\n    }) as NodeSpec,\n\n    listItem: Object.assign({}, listItem, {\n        content: \"paragraph block*\",\n        marks: \"alignment\"\n    }) as NodeSpec,\n\n    youtube\n};\n\nexport const marks = {\n    link: basicMarks.link,\n    em: basicMarks.em,\n    strong: basicMarks.strong,\n    alignment,\n    fontSize: fontSize,\n\n    underline: {\n        parseDOM: [{tag: \"u\"}, {style: \"text-decoration=underline\"}],\n        toDOM() {\n            return [\"u\", 0];\n        }\n    } as MarkSpec\n};\n\nexport const schema = new Schema<keyof typeof nodes, keyof typeof marks>({nodes: nodes, marks: marks});\n\n","import {Mark, MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function findBlockMarks(state: EditorState, markType: MarkType) {\n\n    const marks: Mark[] = [];\n\n    const {from, to} = state.selection;\n\n    state.doc.nodesBetween(from, to, (node, pos, parent) => {\n\n        if (!node.type.isBlock) {\n            return false;\n        }\n\n        for (const mark of node.marks) {\n            if (mark.type === markType) {\n                marks.push(mark);\n            }\n        }\n\n    });\n\n\n    return marks;\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {Alignment} from \"./alignment\";\nimport {HtmlEditor} from \"./editor\";\nimport {changeAlignment} from \"./prosemirror/alignment/commands\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findBlockMarks} from \"./prosemirror/utils/selection/find-block-marks\";\n\n@Component({\n    styles: [`\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleAligment(alignment)\" *ngFor=\"let alignment of Alignment.alignments()\">\n                <ion-label>{{alignment.label | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"active === alignment.alignment\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/align-{{alignment.alignment}}.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    `\n})\nexport class AlignmentMenu implements OnInit {\n\n    Alignment = Alignment;\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    active: string;\n\n    toggleAligment(alignment: Alignment) {\n\n        const command = changeAlignment(<any>alignment.alignment);\n\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n\n        this.active = undefined;\n\n        for (const mark of findBlockMarks(this.editor.state, schema.marks.alignment)) {\n\n            // zaznaczonych wiele blocków z różnym wyrównaniem\n            if (this.active && this.active !== mark.attrs.align) {\n                this.active = undefined;\n                break;\n            }\n\n            this.active = mark.attrs.align;\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {joinDown, joinUp, lift, selectParentNode, toggleMark} from \"prosemirror-commands\";\nimport {redo, undo} from \"prosemirror-history\";\nimport {undoInputRule} from \"prosemirror-inputrules\";\nimport {Schema} from \"prosemirror-model\";\nimport {splitListItem} from \"prosemirror-schema-list\";\n\nconst mac = typeof navigator !== \"undefined\" ? /Mac/.test(navigator.platform) : false;\n\nexport function buildKeymap(schema: Schema, mapKeys?: any) {\n\n    const keys = {};\n    let type: any;\n\n    function bind(key, cmd) {\n\n        if (mapKeys) {\n            const mapped = mapKeys[key];\n\n            if (mapped === false) {\n                return;\n            }\n\n            if (mapped) {\n                key = mapped;\n            }\n        }\n\n        keys[key] = cmd;\n    }\n\n\n    bind(\"Mod-z\", undo);\n    bind(\"Shift-Mod-z\", redo);\n    bind(\"Backspace\", undoInputRule);\n    if (!mac) {\n        bind(\"Mod-y\", redo);\n    }\n\n    bind(\"Alt-ArrowUp\", joinUp);\n    bind(\"Alt-ArrowDown\", joinDown);\n    bind(\"Mod-BracketLeft\", lift);\n    bind(\"Escape\", selectParentNode);\n\n    if (type = schema.marks.strong) {\n        bind(\"Mod-b\", toggleMark(type));\n        bind(\"Mod-B\", toggleMark(type));\n    }\n\n    if (type = schema.marks.em) {\n        bind(\"Mod-i\", toggleMark(type));\n        bind(\"Mod-I\", toggleMark(type));\n    }\n\n    if (type = schema.marks.underline) {\n        bind(\"Mod-u\", toggleMark(type));\n        bind(\"Mod-U\", toggleMark(type));\n    }\n\n    if (type = schema.nodes.listItem) {\n        bind(\"Enter\", splitListItem(type));\n    }\n\n    if (type = schema.nodes.hardBreak) {\n\n        const br = type;\n\n        const cmd = (state, dispatch) => {\n            dispatch(state.tr.replaceSelectionWith(br.create()).scrollIntoView());\n            return true;\n        };\n\n        bind(\"Mod-Enter\", cmd);\n        bind(\"Shift-Enter\", cmd);\n\n        if (mac) {\n            bind(\"Ctrl-Enter\", cmd);\n        }\n    }\n\n    return keys;\n}\n","import {EventManager} from \"@angular/platform-browser\";\nimport {Node} from \"prosemirror-model\";\nimport {removeSelectedNode} from \"prosemirror-utils\";\nimport {EditorView, NodeView} from \"prosemirror-view\";\n\nexport function createYoutubeIframe(id: string, start?: string) {\n\n    const iframe = document.createElement(\"iframe\");\n    iframe.height = \"200px\";\n    iframe.width = \"100%\";\n    iframe.src = `https://www.youtube.com/embed/${id}${start ? \"?start=\" + start : \"\"}`;\n    iframe.frameBorder = \"0\";\n    iframe.allow = \"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\";\n    iframe.allowFullscreen = true;\n\n    return iframe;\n}\n\n// https://www.youtube.com/watch?v=m3V7_Ov52sY\nexport class YoutubeNodeView implements NodeView {\n\n    constructor(node: Node, protected view: EditorView, eventManager: EventManager) {\n\n        this.dom = document.createElement(\"div\");\n        this.dom.style.position = \"relative\";\n        this.dom.style.overflow = \"hidden\";\n        this.dom.style.height = \"200px\";\n        this.dom.style.marginTop = \"16px\";\n        this.dom.setAttribute(\"no-blur\", \"\");\n\n        this.dom.appendChild(createYoutubeIframe(node.attrs.id, node.attrs.start));\n\n        const overlay = this.dom.appendChild(document.createElement(\"div\"));\n        overlay.style.position = \"absolute\";\n        overlay.style.left = \"0px\";\n        overlay.style.top = \"0px\";\n        overlay.style.width = \"100%\";\n        overlay.style.height = \"200px\";\n        overlay.style.display = \"flex\";\n        overlay.style.justifyContent = \"center\";\n\n        const button = overlay.appendChild(document.createElement(\"ion-button\"));\n        button.classList.add(\"ionx--interactive\");\n        button.setAttribute(\"color\", \"primary\");\n        this.deleteUnlisten = eventManager.addEventListener(button, \"click\", () => this.deleteNode());\n\n        const icon = document.createElement(\"ion-icon\");\n        icon.setAttribute(\"name\", \"trash\");\n        icon.slot = \"icon-only\";\n        button.appendChild(icon);\n    }\n\n    private deleteUnlisten: Function;\n\n    dom: HTMLElement;\n\n    private deleteNode() {\n        this.view.dispatch(removeSelectedNode(this.view.state.tr));\n    }\n\n    selectNode() {\n        this.dom.classList.add(\"ionx--selected\");\n    }\n\n    deselectNode() {\n        this.dom.classList.remove(\"ionx--selected\");\n    }\n\n    update(node: Node) {\n        return false;\n    }\n\n    destroy() {\n\n        if (this.deleteUnlisten) {\n            this.deleteUnlisten();\n        }\n    }\n\n    stopEvent(event: Event) {\n        return false;\n    }\n\n    ignoreMutation() {\n        return true;\n    }\n}\n","export function findScrollParent(element: HTMLElement): HTMLElement {\n\n    if (!element) {\n        return;\n    }\n\n    if (element.scrollHeight >= element.clientHeight) {\n        const overflowY = window.getComputedStyle(element).overflowY;\n        if (overflowY !== \"visible\" && overflowY !== \"hidden\") {\n            return element;\n        }\n    }\n\n    if (element.assignedSlot) {\n        const p = findScrollParent(element.assignedSlot.parentElement);\n        if (p) {\n            return p;\n        }\n    }\n\n    return findScrollParent(element.parentElement);\n}\n\nexport function scrollIntoView(element: HTMLElement, parent: HTMLElement) {\n\n    if (parent) {\n\n        const parentRect = parent.getBoundingClientRect();\n        const rect = element.getBoundingClientRect();\n\n        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom && rect.bottom < parentRect.height)) {\n\n            let top = element.offsetTop - 100;\n\n            if (element.offsetParent) {\n                let offsetParent = element.offsetParent as HTMLElement;\n                while (offsetParent !== parent && !!offsetParent) {\n                    top += offsetParent.offsetTop;\n                    offsetParent = offsetParent.offsetParent as HTMLElement;\n                }\n            }\n\n            parent.scrollTo({top: top});\n        }\n\n        return;\n    }\n\n    element.scrollIntoView();\n}\n\nexport function scrollToCaret(parent: HTMLElement) {\n\n    if (parent) {\n\n        const parentRect = parent.getBoundingClientRect();\n        const rect = caretTopPoint();\n        rect.top -= 100;\n\n        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom)) {\n\n            let top = rect.top - parentRect.top;\n            parent.scrollTo({top: top, behavior: \"auto\"});\n        }\n\n        return;\n    }\n\n}\n\nexport function caretTopPoint(): {left: number, top: number} {\n\n    const selection = document.getSelection();\n    const range0 = selection.getRangeAt(0);\n\n    let rect: {left: number, top: number};\n    let range: Range;\n\n    // supposed to be textNode in most cases\n    // but div[contenteditable] when empty\n    const node = range0.startContainer as Element;\n\n    const offset = range0.startOffset;\n    if (offset > 0) {\n\n        // new range, don't influence DOM state\n        range = document.createRange();\n        range.setStart(node, (offset - 1));\n        range.setEnd(node, offset);\n\n        // https://developer.mozilla.org/en-US/docs/Web/API/range.getBoundingClientRect\n        // IE9, Safari?(but look good in Safari 8)\n        rect = range.getBoundingClientRect();\n\n        return {left: rect[\"right\"], top: rect.top};\n\n    } else if (offset < node[\"length\"]) {\n\n        range = document.createRange();\n        // similar but select next on letter\n        range.setStart(node, offset);\n        range.setEnd(node, (offset + 1));\n        rect = range.getBoundingClientRect();\n\n        return {left: rect.left, top: rect.top};\n\n    } else {\n        // textNode has length\n\n        // https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect\n        rect = node.getBoundingClientRect();\n        const styles = getComputedStyle(node);\n        const lineHeight = parseInt(styles.lineHeight);\n        const fontSize = parseInt(styles.fontSize);\n\n        // roughly half the whitespace... but not exactly\n        const delta = (lineHeight - fontSize) / 2;\n\n        return {left: rect.left, top: (rect.top + delta)};\n    }\n\n}\n","import {AfterContentChecked, AfterViewInit, Component, ElementRef, EventEmitter, HostBinding, Input, OnChanges, OnDestroy, OnInit, Optional, Output, SimpleChanges} from \"@angular/core\";\nimport {ControlValueAccessor, NgControl} from \"@angular/forms\";\nimport {EventManager} from \"@angular/platform-browser\";\nimport {waitTill} from \"@co.mmons/js-utils/core\";\nimport {IonItem} from \"@ionic/angular\";\nimport {baseKeymap} from \"prosemirror-commands\";\nimport {gapCursor} from \"prosemirror-gapcursor\";\nimport {history} from \"prosemirror-history\";\nimport {keymap} from \"prosemirror-keymap\";\nimport {DOMParser, DOMSerializer, Schema} from \"prosemirror-model\";\nimport {EditorState, Plugin, Transaction} from \"prosemirror-state\";\nimport {EditorView} from \"prosemirror-view\";\nimport {HtmlEditorFeatures} from \"./editor-features\";\nimport {buildKeymap} from \"./prosemirror/keymap\";\nimport {schema} from \"./prosemirror/schema\";\nimport {createYoutubeIframe, YoutubeNodeView} from \"./prosemirror/views/youtube\";\nimport {findScrollParent, scrollIntoView, scrollToCaret} from \"./scroll\";\n\n@Component({\n    selector: \"ionx-html-editor\",\n    template: `\n        <ionx-html-editor-toolbar [style.display]=\"readonly ? 'none' : ''\"></ionx-html-editor-toolbar>\n    `,\n    styleUrls: [\"editor.scss\"]\n})\nexport class HtmlEditor implements OnInit, AfterViewInit, ControlValueAccessor, AfterContentChecked, OnDestroy, OnChanges {\n\n    private static idGenerator: number = 0;\n\n    constructor(\n        private element: ElementRef<HTMLElement>,\n        public eventManager: EventManager,\n        @Optional() private formControl: NgControl,\n        @Optional() private item: IonItem\n    ) {\n\n        if (formControl) {\n            this.formControl.valueAccessor = this;\n        }\n\n        this.id = \"ionx-trix-editor\" + (HtmlEditor.idGenerator++);\n        this.itemInputWrapper = !!this.item;\n\n        this.element.nativeElement.setAttribute(\"no-blur\", \"\");\n    }\n\n    private eventUnlisteners: Function[] = [];\n\n    readonly id: string;\n\n    @HostBinding(\"class.ionx-item-input-wrapper\")\n    /*private*/ itemInputWrapper: boolean;\n\n    @Input()\n    features: HtmlEditorFeatures;\n\n    @Input()\n    disabled: boolean;\n\n    @Input()\n    readonly: boolean;\n\n    /**\n     * Value, that should be set when editor is fully initialized.\n     */\n    private uninitializedValue: any;\n\n    private controlOnChange: Function;\n\n    private controlOnTouched: Function;\n\n    private focused: boolean;\n\n    private silentChanges: boolean;\n\n    view: EditorView;\n\n    get state() {\n        return this.view.state;\n    }\n\n    private schema: Schema;\n\n    private plugins: Plugin[];\n\n    private scrollParent: HTMLElement;\n\n    @Output()\n    readonly change: EventEmitter<void> = new EventEmitter();\n\n    @Output()\n    readonly selectionChange: EventEmitter<void> = new EventEmitter();\n\n    @Input()\n    public set value(html: string) {\n\n        if (this.view) {\n\n            const state = EditorState.create({\n                schema: this.view.state.schema,\n                plugins: this.view.state.plugins,\n                doc: this.editorDoc(html || \"<div></div>\")\n            });\n\n            this.view.updateState(state);\n\n        } else {\n            this.uninitializedValue = html;\n        }\n\n        this.silentChanges = false;\n    }\n\n    public get value(): string {\n        if (this.view) {\n            const value = DOMSerializer.fromSchema(this.schema).serializeFragment(this.state.doc.content);\n            const tmp = document.createElement(\"div\");\n            tmp.appendChild(value);\n\n            if (!tmp.innerText) {\n                return null;\n            } else {\n                return this.prepareOutputValue(tmp);\n            }\n\n        } else {\n            return this.uninitializedValue;\n        }\n    }\n\n    get nativeElement(): HTMLElement {\n        return this.element.nativeElement;\n    }\n\n    private prepareOutputValue(value: HTMLElement) {\n\n        value.querySelectorAll(\"div[data-youtube]\").forEach((node: HTMLElement) => {\n            const params = node.getAttribute(\"data-youtube\").split(\",\");\n            node.appendChild(createYoutubeIframe(params[0], params.length > 1 ? params[1] : undefined));\n        });\n\n        return value.innerHTML;\n    }\n\n    private prepareInputValue(value: HTMLElement) {\n\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        this.disabled = !!isDisabled;\n    }\n\n    writeValue(value: any) {\n        this.silentChanges = true;\n        this.value = value;\n    }\n\n    registerOnChange(fn: Function): void {\n        this.controlOnChange = fn;\n    }\n\n    registerOnTouched(fn: Function): void {\n        this.controlOnTouched = fn;\n    }\n\n    focus() {\n\n        if (!this.scrollParent) {\n            this.scrollParent = findScrollParent(this.element.nativeElement);\n        }\n\n        (this.view.dom as HTMLElement).focus({preventScroll: true});\n\n        const pos = this.view.domAtPos(this.view.state.selection.to);\n        if (pos.node) {\n            if (pos.node.nodeType === Node.TEXT_NODE) {\n                scrollToCaret(this.scrollParent);\n            } else {\n                scrollIntoView(this.view.dom.querySelector(\".ionx--selected\") || pos.node as HTMLElement, this.scrollParent);\n            }\n        }\n    }\n\n    // @ts-ignore\n    private async editorInitialized(event: Event) {\n\n        if (this.uninitializedValue) {\n            // this.trixEditor.loadHTML(this.uninitializedValue);\n        }\n\n        // this.trixEditorController.toolbarController.applyKeyboardCommand = this.applyKeyboardCommand.bind(this);\n    }\n\n    // @ts-ignore\n    private editorFocused(event: Event) {\n\n        if (this.controlOnTouched) {\n            this.controlOnTouched(true);\n        }\n\n        this.focused = true;\n        this.updateItemClasses();\n    }\n\n    // @ts-ignore\n    private editorBlured(event: Event) {\n        this.focused = false;\n        this.updateItemClasses();\n    }\n\n    private handleScroll(view: EditorView) {\n\n        if (!this.scrollParent) {\n            this.scrollParent = findScrollParent(this.element.nativeElement);\n        }\n\n        const pos = view.domAtPos(view.state.selection.to);\n        if (pos.node) {\n            if (pos.node.nodeType === Node.TEXT_NODE) {\n                scrollToCaret(this.scrollParent);\n            } else {\n                scrollIntoView(view.dom.querySelector(\".ionx--selected\") || pos.node as HTMLElement, this.scrollParent);\n            }\n        }\n\n        return false;\n    }\n\n    private editorDoc(html: string) {\n\n        const node = document.createElement(\"div\");\n        node.innerHTML = html;\n        this.prepareInputValue(node);\n\n        return DOMParser.fromSchema(this.schema).parse(node);\n    }\n\n    private resetControlCss() {\n\n        const classes = {\n            \"ion-untouched\": this.formControl.untouched,\n            \"ion-touched\": this.formControl.touched,\n            \"ion-pristine\": this.formControl.pristine,\n            \"ion-dirty\": this.formControl.dirty,\n            \"ion-valid\": this.formControl.valid,\n            \"ion-invalid\": !this.formControl.valid\n        };\n\n        const elements: HTMLElement[] = [];\n        elements.push(this.element.nativeElement);\n\n        if (this.item) {\n            elements.push(this.item[\"el\"]);\n        }\n\n        for (const e of elements) {\n            for (const c in classes) {\n                if (classes[c]) {\n                    e.classList.add(c);\n                } else {\n                    e.classList.remove(c);\n                }\n            }\n        }\n    }\n\n    private updateItemClasses() {\n\n        if (!this.item) {\n            return;\n        }\n\n        const item: HTMLElement = this.item[\"el\"];\n\n        if (this.disabled) {\n            item.classList.remove(\"item-interactive\");\n        } else {\n            item.classList.add(\"item-interactive\");\n        }\n\n        if (this.focused) {\n            item.classList.add(\"item-has-focus\");\n        } else {\n            item.classList.remove(\"item-has-focus\");\n        }\n    }\n\n    private async fixItemOverflow() {\n\n        if (this.item) {\n            const item: HTMLElement = this.item[\"el\"];\n            await waitTill(() => !!item.shadowRoot && !!item.shadowRoot.querySelector(\".item-inner\"));\n\n            item.style.overflow = \"initial\";\n\n            const style = document.createElement(\"style\");\n            style.innerHTML = `.item-native, .item-inner, .input-wrapper { overflow: initial !important; }`;\n            item.shadowRoot.appendChild(style);\n        }\n\n    }\n\n    private editorTransaction(transaction: Transaction) {\n\n        (this.view.dom as HTMLElement).focus({preventScroll: true});\n\n        this.view.updateState(this.view.state.apply(transaction));\n\n        this.focus();\n\n        this.selectionChange.next();\n\n        if (transaction.docChanged) {\n            this.change.next();\n\n            if (this.controlOnChange && !this.silentChanges) {\n                this.controlOnChange(this.value);\n            }\n        }\n\n        this.silentChanges = false;\n    }\n\n    private readonlyChanged() {\n\n        if (this.view) {\n            this.view.dom[\"contentEditable\"] = !this.readonly && !this.disabled ? \"true\" : \"false\";\n        }\n\n    }\n\n    ngAfterViewInit(): void {\n        this.fixItemOverflow();\n        this.updateItemClasses();\n    }\n\n    ngAfterContentChecked() {\n        this.resetControlCss();\n    }\n\n    ngOnDestroy() {\n\n        for (const unlisten of this.eventUnlisteners) {\n            unlisten();\n        }\n\n        this.view.destroy();\n        this.view = undefined;\n    }\n\n    ngOnInit() {\n\n        this.schema = schema;\n\n        this.plugins = [\n            keymap(buildKeymap(schema)),\n            keymap(baseKeymap),\n            gapCursor(),\n            history()\n        ];\n\n        const state = EditorState.create({\n            schema: this.schema,\n            plugins: this.plugins,\n            doc: this.editorDoc(this.uninitializedValue ? this.uninitializedValue : \"<div></div>\")\n        });\n\n        this.view = new EditorView(this.element.nativeElement, {\n            state: state,\n            dispatchTransaction: (transaction) => this.editorTransaction(transaction),\n            handleScrollToSelection: (view) => this.handleScroll(view),\n\n            nodeViews: {\n                youtube: (node, view) => new YoutubeNodeView(node, view, this.eventManager)\n            }\n        });\n\n        this.silentChanges = false;\n\n        if (this.readonly || this.disabled) {\n            this.readonlyChanged();\n        }\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n\n        if (changes[\"readonly\"] || changes[\"disabled\"]) {\n            this.readonlyChanged();\n        }\n\n    }\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {HtmlEditor} from \"./editor\";\nimport {schema} from \"./prosemirror/schema\";\nimport {setBlockType} from \"prosemirror-commands\";\nimport {findParentNodeOfType} from \"prosemirror-utils\";\n\n@Component({\n    styles: [\n        `:host ion-list { margin: 0px; padding: 0px }`,\n        `:host ion-item:last-child { --border-width: 0px; }`,\n    ],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(0)\" *ngIf=\"activeHeading > 0\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#Plain text\" | intlMessage}}</ion-label>\n            </ion-item>\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(1)\">\n                <ion-label style=\"font-size: 130%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 1</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 1\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(2)\">\n                <ion-label style=\"font-size: 125%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 2</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 2\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(3)\">\n                <ion-label style=\"font-size: 120%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 3</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 3\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(4)\">\n                <ion-label style=\"font-size: 115%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 4</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 4\"></ion-icon>\n            </ion-item>\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(5)\">\n                <ion-label style=\"font-size: 110%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 5</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 5\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(6)\">\n                <ion-label style=\"font-size: 105%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 6</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 6\"></ion-icon>\n            </ion-item>\n            \n        </ion-list>\n    `\n})\nexport class HeadingMenu implements OnInit {\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    activeHeading: number;\n\n    @Input()\n    editor: HtmlEditor;\n\n\n    toggleHeading(heading: number) {\n\n        if (heading > 0 && this.activeHeading !== heading) {\n\n            const command = setBlockType(schema.nodes.heading, {level: heading});\n            if (command(this.editor.state)) {\n                command(this.editor.state, (tr) => {\n                    this.editor.view.dispatch(tr);\n                });\n            }\n\n        } else {\n            setBlockType(schema.nodes.paragraph)(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n\n        const active = findParentNodeOfType(schema.nodes.heading)(this.editor.state.selection);\n        if (active) {\n            this.activeHeading = active.node.attrs.level;\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {AbstractControl, ValidationErrors, ValidatorFn, Validators} from \"@angular/forms\";\nimport {MessageRef} from \"@co.mmons/js-intl\";\n\nexport abstract class LinkType {\n\n    protected constructor(public readonly type: string) {\n    }\n\n    abstract get label(): MessageRef;\n\n    abstract get inputType(): string;\n\n    abstract get inputComponent(): any;\n\n    abstract get inputValidators(): ValidatorFn[];\n\n    abstract get inputHint(): MessageRef;\n\n    abstract get inputLabel(): MessageRef;\n\n    abstract uri(fromLink: string): string;\n\n    toString() {\n        return this.type;\n    }\n}\n\nexport class DefaultLinkType extends LinkType {\n\n    static readonly www = new DefaultLinkType(\"www\");\n    static readonly email = new DefaultLinkType(\"email\");\n    static readonly tel = new DefaultLinkType(\"tel\");\n    static readonly sms = new DefaultLinkType(\"sms\");\n    static readonly other = new DefaultLinkType(\"other\");\n\n    constructor(type: string) {\n        super(type);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/type/\" + type);\n\n        if (type === \"www\") {\n            this.inputType = \"url\";\n        } else if (type === \"other\") {\n            this.inputType = \"text\";\n        } else if (type === \"sms\") {\n            this.inputType = \"sms\";\n        } else {\n            this.inputType = type;\n        }\n\n        if (type === \"www\") {\n            this.inputValidators = [urlValidator];\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/Web page url\");\n        }\n\n        if (type === \"email\") {\n            this.inputValidators = [Validators.email];\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/E-mail address\");\n        }\n\n        if (type === \"tel\" || type === \"sms\") {\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/Phone number\");\n            this.inputHint = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/phoneNumberHint\");\n        }\n    }\n\n\n    readonly label: MessageRef;\n\n    readonly inputType: string;\n\n    readonly inputValidators: ValidatorFn[];\n\n    readonly inputComponent = undefined;\n\n    readonly inputLabel: MessageRef;\n\n    readonly inputHint: MessageRef;\n\n    uri(fromLink: string) {\n\n        if (this.type === \"www\" || this.type === \"other\") {\n            return fromLink;\n        } else if (this.type === \"tel\") {\n            return `tel:${fromLink}`;\n        } else if (this.type === \"sms\") {\n            return `sms:${fromLink}`;\n        } else if (this.type === \"email\") {\n            return `mailto:${fromLink}`;\n        }\n\n        return fromLink;\n    }\n\n}\n\nconst urlValidatorRegex = /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\nfunction urlValidator(control: AbstractControl): ValidationErrors {\n\n    const value = control.value;\n\n    if (urlValidatorRegex.test(value)) {\n        return undefined;\n    }\n\n    return {\n        invalidUrl: new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/invalidUrlError\")\n    };\n}\n","import {deepEqual} from \"fast-equals\";\nimport {Mark, MarkType, Node} from \"prosemirror-model\";\n\nexport function findMarks(doc: Node, from: number, to: number, markType: MarkType, attrs?: {[key: string]: any}) {\n\n    const marks: Mark[] = [];\n\n    doc.nodesBetween(from, to, node => {\n\n        for (let i = 0; i < node.marks.length; i++) {\n            if (node.marks[i].type === markType && (!attrs || deepEqual(node.marks[i].attrs, attrs))) {\n                marks.push(node.marks[i]);\n            }\n        }\n\n    });\n\n    return marks;\n}\n","import {findMarks} from \"./find-marks\";\nimport {MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function findMarksInSelection(state: EditorState, markType: MarkType, attrs?: {[key: string]: any}) {\n    const doc = state.doc;\n    const {from, to} = state.selection;\n    return findMarks(doc, from, to, markType, attrs);\n}\n","import {Node} from \"prosemirror-model\";\n\nexport function findNodeStartEnd(doc: Node, pos: number) {\n\n    const $pos = doc.resolve(pos);\n    const start = pos - $pos.textOffset;\n    const end = start + $pos.parent.child($pos.index()).nodeSize;\n\n    return {start, end};\n}\n","import {Component, Input, OnDestroy, OnInit, ViewChild} from \"@angular/core\";\nimport {AbstractControl, FormControl, FormGroup, ValidationErrors, Validators} from \"@angular/forms\";\nimport {FormHelper} from \"@co.mmons/ionic-extensions/form-helper\";\nimport {sleep, waitTill} from \"@co.mmons/js-utils/core\";\nimport {unsubscribe} from \"@co.mmons/rxjs-utils\";\nimport {ModalController} from \"@ionic/angular\";\nimport {toggleMark} from \"prosemirror-commands\";\nimport {Subscription} from \"rxjs\";\nimport {HtmlEditor} from \"./editor\";\nimport {DefaultLinkType, LinkType} from \"./link-type\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findMarksInSelection} from \"./prosemirror/utils/find-marks-in-selection\";\nimport {findNodeStartEnd} from \"./prosemirror/utils/find-node-start-end\";\n\n@Component({\n    templateUrl: \"link-modal.html\",\n    styles: [\n        `:host ion-item:not(.ion-dirty) { --highlight-height: 0px; }`\n    ]\n})\nexport class LinkModal implements OnDestroy, OnInit {\n\n    static async present(modalController: ModalController, editor: HtmlEditor) {\n\n        const modal = await modalController.create({component: LinkModal, componentProps: {editor: editor}});\n        modal.present();\n    }\n\n    constructor(private modalController: ModalController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    existing: boolean;\n\n    private existingType: LinkType;\n\n    private existingLink: string;\n\n    types: LinkType[];\n\n    form: FormGroup;\n\n    @ViewChild(FormHelper, {static: false})\n    formHelper: FormHelper;\n\n    async close() {\n        await this.modalController.dismiss();\n        this.editor.focus();\n    }\n\n    async unlink() {\n\n        await this.modalController.dismiss();\n\n        const selection = this.editor.state.selection;\n\n        if (selection.empty) {\n\n            const tr = this.editor.state.tr;\n\n            tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                if (node.isText) {\n                    const $pos = tr.doc.resolve(pos);\n                    const start = pos - $pos.textOffset;\n                    const end = start + $pos.parent.child($pos.index()).nodeSize;\n\n                    tr.removeMark(start, end, schema.marks.link);\n                }\n            });\n\n            this.editor.view.dispatch(tr);\n\n        } else {\n            toggleMark(schema.marks.link)(this.editor.state, tr => this.editor.view.dispatch(tr));\n        }\n    }\n\n    async ok() {\n        this.formHelper.validateAll(\"dirty\");\n\n        if (this.form.valid) {\n            await this.modalController.dismiss();\n\n            const linkType = this.form.controls.type.value as LinkType;\n            const selection = this.editor.state.selection;\n\n            const tr = this.editor.state.tr;\n\n            if (selection.empty) {\n\n                tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                    if (node.isText) {\n                        const {start, end} = findNodeStartEnd(tr.doc, pos);\n                        tr.addMark(start, end, schema.mark(schema.marks.link, {href: linkType.uri(this.form.controls.link.value)}));\n                    }\n                });\n\n            } else {\n\n                // usuwamy poprzedni link\n                tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                    if (node.isText) {\n                        const {start, end} = findNodeStartEnd(tr.doc, pos);\n                        tr.removeMark(start, end, schema.marks.link);\n                    }\n                });\n\n                tr.addMark(selection.from, selection.to, schema.mark(schema.marks.link, {href: linkType.uri(this.form.controls.link.value)}));\n            }\n\n            this.editor.view.dispatch(tr);\n        }\n    }\n\n    private async typeChanged() {\n\n        if (this.form.controls.link.value) {\n            this.form.controls.link.markAsDirty();\n            this.form.controls.link.updateValueAndValidity();\n        }\n\n        await sleep(50); // we must wait for closing type selector\n\n        if (this.formHelper) {\n            this.formHelper.focus(\"link\", false);\n        }\n    }\n\n    private parseLink(uri: string): {type: LinkType, link: string} {\n\n        const prefixes = {\n            \"http:\": DefaultLinkType.www,\n            \"https:\": DefaultLinkType.www,\n            \"tel:\": DefaultLinkType.tel,\n            \"sms:\": DefaultLinkType.sms,\n            \"mailto:\": DefaultLinkType.email\n        };\n\n        const lowerCasedUri = uri.trim().toLowerCase();\n\n        for (const prefix of Object.keys(prefixes)) {\n            if (lowerCasedUri.startsWith(prefix)) {\n\n                const link = {type: prefixes[prefix], link: uri.trim()};\n\n                if (prefixes[prefix] !== DefaultLinkType.www) {\n                    link.link = uri.substring(prefix.length).trim();\n                }\n\n                return link;\n            }\n        }\n\n        return {type: DefaultLinkType.other, link: uri};\n    }\n\n    private linkValidator(control: AbstractControl): ValidationErrors {\n\n        const required = Validators.required(control);\n        if (required) {\n            return required;\n        }\n\n        const type = this.form.controls.type.value as LinkType;\n        const validators = type.inputValidators;\n\n        if (validators) {\n            for (const validator of validators) {\n                const r = validator(control);\n                if (r) {\n                    return r;\n                }\n            }\n        }\n    }\n\n    async ionViewDidEnter() {\n\n        this.types = [DefaultLinkType.www, DefaultLinkType.email, DefaultLinkType.tel, DefaultLinkType.sms, DefaultLinkType.other];\n\n        this.form = new FormGroup({\n            type: new FormControl(this.existingType || DefaultLinkType.www),\n            link: new FormControl(this.existingLink)\n        });\n\n        this.form.controls.link.setValidators(control => this.linkValidator(control));\n\n        this.typeChangesSubscription = this.form.controls[\"type\"].valueChanges.subscribe(() => this.typeChanged());\n        this.typeChanged();\n\n        await waitTill(() => !!this.formHelper);\n\n        this.formHelper.focus(\"link\", false);\n    }\n\n    async ionViewWillLeave() {\n        this.editor.focus();\n    }\n\n    ngOnInit() {\n\n        MARKS: for (const mark of findMarksInSelection(this.editor.state, schema.marks.link)) {\n            const parsed = this.parseLink(mark.attrs.href);\n            if (parsed) {\n                this.existingType = parsed.type;\n                this.existingLink = parsed.link;\n                this.existing = true;\n                break MARKS;\n            }\n        }\n    }\n\n    private typeChangesSubscription: Subscription;\n\n    ngOnDestroy() {\n        unsubscribe(this.typeChangesSubscription);\n    }\n\n}\n","import {Component, Input, OnInit, ViewChild} from \"@angular/core\";\nimport {sleep, waitTill} from \"@co.mmons/js-utils/core\";\nimport {IonInput, ModalController, PopoverController} from \"@ionic/angular\";\nimport {OverlayEventDetail} from \"@ionic/core\";\nimport {HtmlEditor} from \"./editor\";\nimport {LinkModal} from \"./link-modal\";\n\n@Component({\n    styles: [\n        `:host ion-list { margin: 0px; padding: 0px }`,\n        `:host ion-item:last-child { --border-width: 0px; }`,\n        `:host ion-item { --highlight-height: 0px; }`\n    ],\n    template: `\n        <ion-list lines=\"full\">\n            \n            <ng-template [ngIf]=\"!inputView\">\n                \n                <ion-item button=\"true\" detail=\"false\" (click)=\"insertLink()\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#link/Link\" | intlMessage}}</ion-label>\n                    <ion-icon name=\"link\" slot=\"start\"></ion-icon>\n                </ion-item>\n    \n                <ion-item button=\"true\" detail=\"false\" (click)=\"insertYoutube()\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#youtube/YouTube video\" | intlMessage}}</ion-label>\n                    <ion-icon name=\"logo-youtube\" slot=\"start\"></ion-icon>\n                </ion-item>\n                \n            </ng-template>\n            \n            <ng-template [ngIf]=\"inputView == 'youtube'\">\n\n                <ion-item>\n                    <ion-icon name=\"logo-youtube\" slot=\"start\"></ion-icon>\n                    <ion-input #youtubeInput [placeholder]=\"'@co.mmons/ionic-extensions/html-editor#youtube/Paste YouTube video url' | intlMessage\" (keydown.enter)=\"applyYoutube()\"></ion-input>\n                </ion-item>\n                \n                <ion-item>\n                    <ionx-buttons slot=\"end\">\n                        <ion-button fill=\"clear\" color=\"dark\" (click)=\"cancel()\">\n                            <ion-label>{{\"@co.mmons/js-intl#Cancel\" | intlMessage}}</ion-label>\n                        </ion-button>\n                        \n                        <ion-button fill=\"clear\" color=\"primary\" (click)=\"applyYoutube()\">\n                            <ion-label>{{\"@co.mmons/js-intl#Ok\" | intlMessage}}</ion-label>\n                        </ion-button>\n                    </ionx-buttons>\n                </ion-item>\n    \n            </ng-template>\n            \n        </ion-list>\n    `\n})\nexport class InsertMenu implements OnInit {\n\n    // @ts-ignore\n    constructor(private popoverController: PopoverController, private modalController: ModalController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    inputView: \"youtube\";\n\n    // @ts-ignore\n    private editorLastSelection: [number, number];\n\n\n    async insertLink() {\n\n        this.popoverController.dismiss(undefined, \"link\");\n\n        LinkModal.present(this.modalController, this.editor);\n    }\n\n    @ViewChild(\"youtubeInput\", {static: false})\n    private youtubeInput: IonInput;\n\n    async insertYoutube() {\n\n        this.inputView = \"youtube\";\n\n        await waitTill(() => !!this.youtubeInput, undefined, 2000);\n        this.youtubeInput.setFocus();\n    }\n\n    // @ts-ignore\n    private parseYoutube(value: string): {id: string, start?: string} {\n        // https://www.youtube.com/watch?v=NqMgaHUNSQc\n        // https://youtu.be/NqMgaHUNSQc\n        // https://www.youtube.com/embed/NqMgaHUNSQc\n        // https://www.youtube-nocookie.com/embed/NqMgaHUNSQc\n        // https://youtu.be/NqMgaHUNSQc?t=17\n\n        value = value.replace(\"-nocookie.com/\", \".com/\");\n        value = value.replace(\"/embed/\", \"/\");\n        value = value.replace(\"youtu.be/\", \"youtube.com/\");\n        value = value.replace(\"watch?v=\", \"\");\n        value = value.replace(\"?\", \"&\");\n\n        const info = {id: undefined, start: undefined};\n\n        if (value.indexOf(\"youtube.com/\") > -1) {\n            value = value.split(\"youtube.com/\").splice(1, 1)[0];\n\n            for (const param of value.split(\"&\")) {\n                if (param.indexOf(\"=\") < 0) {\n                    info.id = param;\n                } else if (param.startsWith(\"t=\")) {\n                    info.start = param.substring(2);\n                } else if (param.startsWith(\"start=\")) {\n                    info.start = param.substring(6);\n                }\n            }\n\n        } else  {\n        }\n\n        if (info.id) {\n            return info;\n        }\n    }\n\n\n    applyYoutube() {\n\n\n        const info = this.parseYoutube(this.youtubeInput.value as string);\n        if (info) {\n            const tr = this.editor.state.tr.replaceSelectionWith(this.editor.state.schema.nodes.youtube.create({id: info.id, start: info.start || 0}));\n            this.editor.view.dispatch(tr);\n        }\n\n        this.popoverController.dismiss(undefined, \"youtube\");\n    }\n\n    cancel() {\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n    }\n\n    async ionViewWillLeave(event: OverlayEventDetail<any>) {\n\n        if (!this.inputView && !event.role) {\n            this.editor.focus();\n        }\n    }\n\n    async ionViewDidLeave(event: OverlayEventDetail<any>) {\n\n        if (this.inputView) {\n            await sleep(50);\n            this.editor.focus();\n\n        } else if (!event.role) {\n            this.editor.focus();\n        }\n    }\n}\n","import {Command} from \"../command\";\nimport {Predicate} from \"../predicate\";\n\nexport const filter = (predicates: Predicate[] | Predicate, cmd: Command): Command => {\n\n    return function(state, dispatch, view): boolean {\n        if (!Array.isArray(predicates)) {\n            predicates = [predicates];\n        }\n\n        if (predicates.some(pred => !pred(state, view))) {\n            return false;\n        }\n\n        return cmd(state, dispatch, view) || false;\n    };\n};\n","import {GapCursor} from \"prosemirror-gapcursor\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport const isEmptySelectionAtStart = (state: EditorState): boolean => {\n    const {empty, $from} = state.selection;\n    return (\n        empty &&\n        ($from.parentOffset === 0 || state.selection instanceof GapCursor)\n    );\n};\n\n","import {GapCursor} from \"prosemirror-gapcursor\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport const isFirstChildOfParent = (state: EditorState): boolean => {\n    const {$from} = state.selection;\n    return $from.depth > 1\n        ? (state.selection instanceof GapCursor &&\n        $from.parentOffset === 0) ||\n        $from.index($from.depth - 1) === 0\n        : true;\n};\n","import {Node} from \"prosemirror-model\";\nimport {EditorState, Selection, Transaction} from \"prosemirror-state\";\nimport {ContentNodeWithPos} from \"prosemirror-utils\";\n\n/**\n * Checks if node is an empty paragraph.\n */\nexport function isEmptyParagraph(node?: Node | null): boolean {\n    return (\n        !node ||\n        (node.type.name === \"paragraph\" && !node.textContent && !node.childCount)\n    );\n}\n\n/**\n * Returns false if node contains only empty inline nodes and hardBreaks.\n */\nexport function hasVisibleContent(node: Node): boolean {\n    const isInlineNodeHasVisibleContent = (inlineNode: Node) => {\n        return inlineNode.isText\n            ? !!inlineNode.textContent.trim()\n            : inlineNode.type.name !== \"hardBreak\";\n    };\n\n    if (node.isInline) {\n        return isInlineNodeHasVisibleContent(node);\n    } else if (node.isBlock && (node.isLeaf || node.isAtom)) {\n        return true;\n    } else if (!node.childCount) {\n        return false;\n    }\n\n    for (let index = 0; index < node.childCount; index++) {\n        const child = node.child(index);\n\n        if (hasVisibleContent(child)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * Checks if a node has any content. Ignores node that only contain empty block nodes.\n */\nexport function isNodeEmpty(node?: Node): boolean {\n    if (node && node.textContent) {\n        return false;\n    }\n\n    if (\n        !node ||\n        !node.childCount ||\n        (node.childCount === 1 && isEmptyParagraph(node.firstChild))\n    ) {\n        return true;\n    }\n\n    const block: Node[] = [];\n    const nonBlock: Node[] = [];\n\n    node.forEach(child => {\n        child.isInline ? nonBlock.push(child) : block.push(child);\n    });\n\n    return (\n        !nonBlock.length &&\n        !block.filter(\n            childNode =>\n                (!!childNode.childCount &&\n                    !(\n                        childNode.childCount === 1 && isEmptyParagraph(childNode.firstChild)\n                    )) ||\n                childNode.isAtom,\n        ).length\n    );\n}\n\n/**\n * Checks if a node looks like an empty document\n */\nexport function isEmptyDocument(node: Node): boolean {\n    const nodeChild = node.content.firstChild;\n\n    if (node.childCount !== 1 || !nodeChild) {\n        return false;\n    }\n    return (\n        nodeChild.type.name === \"paragraph\" &&\n        !nodeChild.childCount &&\n        nodeChild.nodeSize === 2 &&\n        (!nodeChild.marks || nodeChild.marks.length === 0)\n    );\n}\n\nexport const getStepRange = (\n    transaction: Transaction,\n): { from: number; to: number } | null => {\n    let from = -1;\n    let to = -1;\n\n    transaction.steps.forEach(step => {\n        step.getMap().forEach((_oldStart, _oldEnd, newStart, newEnd) => {\n            from = newStart < from || from === -1 ? newStart : from;\n            to = newEnd < to || to === -1 ? newEnd : to;\n        });\n    });\n\n    if (from !== -1) {\n        return { from, to };\n    }\n\n    return null;\n};\n\n/**\n * Find the farthest node given a condition\n * @param predicate Function to check the node\n */\nexport const findFarthestParentNode = (predicate: (node: Node) => boolean) => (\n    selection: Selection,\n): ContentNodeWithPos | null => {\n    const { $from } = selection;\n\n    let candidate: ContentNodeWithPos | null = null;\n\n    for (let i = $from.depth; i > 0; i--) {\n        const node = $from.node(i);\n        if (predicate(node)) {\n            candidate = {\n                pos: i > 0 ? $from.before(i) : 0,\n                start: $from.start(i),\n                depth: i,\n                node,\n            };\n        }\n    }\n    return candidate;\n};\n\nexport const isSelectionEndOfParagraph = (state: EditorState): boolean =>\n    state.selection.$to.parent.type === state.schema.nodes.paragraph &&\n    state.selection.$to.pos === state.doc.resolve(state.selection.$to.pos).end();\n\nexport function nodesBetweenChanged(\n    tr: Transaction,\n    f: (\n        node: Node,\n        pos: number,\n        parent: Node,\n        index: number,\n    ) => boolean | null | undefined | void,\n    startPos?: number,\n) {\n    const stepRange = getStepRange(tr);\n    if (!stepRange) {\n        return;\n    }\n\n    tr.doc.nodesBetween(stepRange.from, stepRange.to, f, startPos);\n}\n\nexport function getNodesCount(node: Node): Record<string, number> {\n    const count: Record<string, number> = {};\n\n    node.nodesBetween(0, node.nodeSize - 2, node => {\n        count[node.type.name] = (count[node.type.name] || 0) + 1;\n    });\n\n    return count;\n}\n","import {Fragment, NodeRange, Slice} from \"prosemirror-model\";\nimport {EditorState, Selection, TextSelection, Transaction,} from \"prosemirror-state\";\nimport {liftTarget, ReplaceAroundStep} from \"prosemirror-transform\";\n\nfunction liftListItem(\n    state: EditorState,\n    selection: Selection,\n    tr: Transaction,\n): Transaction {\n    const { $from, $to } = selection;\n    const nodeType = state.schema.nodes.listItem;\n    let range = $from.blockRange(\n        $to,\n        node =>\n            !!node.childCount &&\n            !!node.firstChild &&\n            node.firstChild.type === nodeType,\n    );\n    if (\n        !range ||\n        range.depth < 2 ||\n        $from.node(range.depth - 1).type !== nodeType\n    ) {\n        return tr;\n    }\n    const end = range.end;\n    const endOfList = $to.end(range.depth);\n    if (end < endOfList) {\n        tr.step(\n            new ReplaceAroundStep(\n                end - 1,\n                endOfList,\n                end,\n                endOfList,\n                new Slice(\n                    Fragment.from(nodeType.create(undefined, range.parent.copy())),\n                    1,\n                    0,\n                ),\n                1,\n                true,\n            ),\n        );\n\n        range = new NodeRange(\n            tr.doc.resolve($from.pos),\n            tr.doc.resolve(endOfList),\n            range.depth,\n        );\n    }\n    return tr.lift(range, liftTarget(range) as number).scrollIntoView();\n}\n\nexport function liftFollowingList(\n    state: EditorState,\n    from: number,\n    to: number,\n    rootListDepth: number,\n    tr: Transaction,\n): Transaction {\n    const { listItem } = state.schema.nodes;\n    let lifted = false;\n    tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (!lifted && node.type === listItem && pos > from) {\n            lifted = true;\n            let listDepth = rootListDepth + 3;\n            while (listDepth > rootListDepth + 2) {\n                const start = tr.doc.resolve(tr.mapping.map(pos));\n                listDepth = start.depth;\n                const end = tr.doc.resolve(\n                    tr.mapping.map(pos + node.textContent.length),\n                );\n                const sel = new TextSelection(start, end);\n                tr = liftListItem(state, sel, tr);\n            }\n        }\n    });\n    return tr;\n}\n","import {ResolvedPos, Schema} from \"prosemirror-model\";\n\n// This will return (depth - 1) for root list parent of a list.\nexport const getListLiftTarget = (\n    schema: Schema,\n    resPos: ResolvedPos,\n): number => {\n    let target = resPos.depth;\n    const { bulletList, orderedList, listItem } = schema.nodes;\n    for (let i = resPos.depth; i > 0; i--) {\n        const node = resPos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            target = i;\n        }\n        if (\n            node.type !== bulletList &&\n            node.type !== orderedList &&\n            node.type !== listItem\n        ) {\n            break;\n        }\n    }\n    return target - 1;\n};\n","import {EditorState, Transaction} from \"prosemirror-state\";\nimport {getListLiftTarget} from \"../utils/get-list-lift-target\";\n\n// The function will list paragraphs in selection out to level 1 below root list.\nexport function liftSelectionList(\n    state: EditorState,\n    tr: Transaction,\n): Transaction {\n    const {from, to} = state.selection;\n    const {paragraph} = state.schema.nodes;\n    const listCol: any[] = [];\n    tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (node.type === paragraph) {\n            listCol.push({node, pos});\n        }\n    });\n    for (let i = listCol.length - 1; i >= 0; i--) {\n        const paragraph = listCol[i];\n        const start = tr.doc.resolve(tr.mapping.map(paragraph.pos));\n        if (start.depth > 0) {\n            let end;\n            if (paragraph.node.textContent && paragraph.node.textContent.length > 0) {\n                end = tr.doc.resolve(\n                    tr.mapping.map(paragraph.pos + paragraph.node.textContent.length),\n                );\n            } else {\n                end = tr.doc.resolve(tr.mapping.map(paragraph.pos + 1));\n            }\n            const range = start.blockRange(end);\n            if (range) {\n                tr.lift(range, getListLiftTarget(state.schema, start));\n            }\n        }\n    }\n    return tr;\n}\n","import { Node, Mark, MarkType } from \"prosemirror-model\";\nimport { SelectionRange, EditorState, Transaction } from \"prosemirror-state\";\n\nexport const isMarkAllowedInRange = (\n    doc: Node,\n    ranges: Array<SelectionRange>,\n    type: MarkType,\n): boolean => {\n    for (let i = 0; i < ranges.length; i++) {\n        const { $from, $to } = ranges[i];\n        let can = $from.depth === 0 ? doc.type.allowsMarkType(type) : false;\n        doc.nodesBetween($from.pos, $to.pos, node => {\n            if (can) {\n                return false;\n            }\n            can = node.inlineContent && node.type.allowsMarkType(type);\n            return;\n        });\n        if (can) {\n            return can;\n        }\n    }\n    return false;\n};\n\nexport const isMarkExcluded = (\n    type: MarkType,\n    marks?: Array<Mark> | null,\n): boolean => {\n    if (marks) {\n        return marks.some(mark => mark.type !== type && mark.type.excludes(type));\n    }\n    return false;\n};\n\nconst not = <T>(fn: ((args: T) => boolean)) => (arg: T) => !fn(arg);\n\nexport const removeBlockMarks = (\n    state: EditorState,\n    marks: Array<MarkType | undefined>,\n): Transaction | undefined => {\n    const { selection, schema } = state;\n    let { tr } = state;\n\n    // Marks might not exist in Schema\n    const marksToRemove = marks.filter(Boolean);\n    if (marksToRemove.length === 0) {\n        return undefined;\n    }\n\n    /** Saves an extra dispatch */\n    let blockMarksExists = false;\n\n    const hasMark = (mark: Mark) => marksToRemove.indexOf(mark.type) > -1;\n    /**\n     * When you need to toggle the selection\n     * when another type which does not allow alignment is applied\n     */\n    state.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n        if (node.type === schema.nodes.paragraph && node.marks.some(hasMark)) {\n            blockMarksExists = true;\n            const resolvedPos = state.doc.resolve(pos);\n            const withoutBlockMarks = node.marks.filter(not(hasMark));\n            tr = tr.setNodeMarkup(\n                resolvedPos.pos,\n                undefined,\n                node.attrs,\n                withoutBlockMarks,\n            );\n        }\n    });\n    return blockMarksExists ? tr : undefined;\n};\n\n/**\n * Removes marks from nodes in the current selection that are not supported\n */\nexport const sanitizeSelectionMarks = (\n    state: EditorState,\n): Transaction | undefined => {\n    let tr: Transaction | undefined;\n    const { $from, $to } = state.tr.selection;\n    state.doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n        node.marks.forEach(mark => {\n            if (!node.type.allowsMarkType(mark.type)) {\n                const filteredMarks = node.marks.filter(m => m.type !== mark.type);\n                const position = pos > 0 ? pos - 1 : 0;\n                tr = (tr || state.tr).setNodeMarkup(\n                    position,\n                    undefined,\n                    node.attrs,\n                    filteredMarks,\n                );\n            }\n        });\n    });\n    return tr;\n};\n","import {toggleMark} from \"prosemirror-commands\";\nimport {GapCursor} from \"prosemirror-gapcursor\";\nimport {\n    Fragment,\n    Mark as PMMark,\n    MarkType,\n    Node,\n    NodeRange,\n    NodeType,\n    ResolvedPos,\n    Schema,\n    Slice,\n} from \"prosemirror-model\";\nimport {EditorState, NodeSelection, Selection, TextSelection, Transaction,} from \"prosemirror-state\";\nimport {findWrapping, liftTarget} from \"prosemirror-transform\";\nimport {hasParentNodeOfType} from \"prosemirror-utils\";\nimport {EditorView} from \"prosemirror-view\";\nimport {isNodeEmpty} from \"./document-utils\";\n\nexport {\n    isEmptyParagraph,\n    hasVisibleContent,\n    isNodeEmpty,\n    isEmptyDocument,\n    getStepRange,\n    findFarthestParentNode,\n    isSelectionEndOfParagraph,\n    nodesBetweenChanged,\n} from \"./document-utils\";\n\n\nexport const ZeroWidthSpace = \"\\u200b\";\n\nfunction validateNode(_node: Node): boolean {\n    return false;\n}\n\nfunction isMarkTypeCompatibleWithMark(\n    markType: MarkType,\n    mark: PMMark,\n): boolean {\n    return !mark.type.excludes(markType) && !markType.excludes(mark.type);\n}\n\nfunction isMarkTypeAllowedInNode(\n    markType: MarkType,\n    state: EditorState,\n): boolean {\n    return toggleMark(markType)(state);\n}\n\nfunction closest(\n    node: HTMLElement | null | undefined,\n    s: string,\n): HTMLElement | null {\n    let el = node as HTMLElement;\n    if (!el) {\n        return null;\n    }\n    if (!document.documentElement || !document.documentElement.contains(el)) {\n        return null;\n    }\n    const matches = el.matches ? \"matches\" : \"msMatchesSelector\";\n\n    do {\n        // @ts-ignore\n        if (el[matches] && el[matches](s)) {\n            return el;\n        }\n        el = (el.parentElement || el.parentNode) as HTMLElement;\n    } while (el !== null && el.nodeType === 1);\n    return null;\n}\n\nexport const isImage = (fileType?: string): boolean => {\n    return (\n        !!fileType &&\n        (fileType.indexOf(\"image/\") > -1 || fileType.indexOf(\"video/\") > -1)\n    );\n};\n\nexport function canMoveUp(state: EditorState): boolean {\n    const { selection, doc } = state;\n\n    /**\n     * If there\"s a media element on the selection,\n     * add text blocks with arrow navigation.\n     * Also, the selection could be media | mediaGroup.\n     */\n    if (selection instanceof NodeSelection) {\n        if (selection.node.type.name === \"media\") {\n            /** Weird way of checking if the previous element is a paragraph */\n            const mediaAncestorNode = doc.nodeAt(selection.anchor - 3);\n            return !!(\n                mediaAncestorNode && mediaAncestorNode.type.name === \"paragraph\"\n            );\n        } else if (selection.node.type.name === \"mediaGroup\") {\n            const mediaGroupAncestorNode = selection.$anchor.nodeBefore;\n            return !!(\n                mediaGroupAncestorNode &&\n                mediaGroupAncestorNode.type.name === \"paragraph\"\n            );\n        }\n    }\n\n    if (selection instanceof TextSelection) {\n        if (!selection.empty) {\n            return true;\n        }\n    }\n\n    return !atTheBeginningOfDoc(state);\n}\n\nexport function canMoveDown(state: EditorState): boolean {\n    const { selection, doc } = state;\n\n    /**\n     * If there\"s a media element on the selection,\n     * add text blocks with arrow navigation.\n     * Also, the selection could be media | mediaGroup.\n     */\n    if (selection instanceof NodeSelection) {\n        if (selection.node.type.name === \"media\") {\n            const nodeAfter = doc.nodeAt(selection.$head.after());\n            return !!(nodeAfter && nodeAfter.type.name === \"paragraph\");\n        } else if (selection.node.type.name === \"mediaGroup\") {\n            return !(\n                selection.$head.parentOffset === selection.$anchor.parent.content.size\n            );\n        }\n    }\n    if (selection instanceof TextSelection) {\n        if (!selection.empty) {\n            return true;\n        }\n    }\n\n    return !atTheEndOfDoc(state);\n}\n\nexport function isSelectionInsideLastNodeInDocument(\n    selection: Selection,\n): boolean {\n    const docNode = selection.$anchor.node(0);\n    const rootNode = selection.$anchor.node(1);\n\n    return docNode.lastChild === rootNode;\n}\n\nexport function atTheEndOfDoc(state: EditorState): boolean {\n    const { selection, doc } = state;\n    return doc.nodeSize - selection.$to.pos - 2 === selection.$to.depth;\n}\n\nexport function atTheBeginningOfDoc(state: EditorState): boolean {\n    const { selection } = state;\n    return selection.$from.pos === selection.$from.depth;\n}\n\nexport function atTheEndOfBlock(state: EditorState): boolean {\n    const { selection } = state;\n    const { $to } = selection;\n    if (selection instanceof GapCursor) {\n        return false;\n    }\n    if (selection instanceof NodeSelection && selection.node.isBlock) {\n        return true;\n    }\n    return endPositionOfParent($to) === $to.pos + 1;\n}\n\nexport function atTheBeginningOfBlock(state: EditorState): boolean {\n    const { selection } = state;\n    const { $from } = selection;\n    if (selection instanceof GapCursor) {\n        return false;\n    }\n    if (selection instanceof NodeSelection && selection.node.isBlock) {\n        return true;\n    }\n    return startPositionOfParent($from) === $from.pos;\n}\n\nexport function startPositionOfParent(resolvedPos: ResolvedPos): number {\n    return resolvedPos.start(resolvedPos.depth);\n}\n\nexport function endPositionOfParent(resolvedPos: ResolvedPos): number {\n    return resolvedPos.end(resolvedPos.depth) + 1;\n}\n\nexport function getCursor(selection: Selection): ResolvedPos | undefined {\n    return (selection as TextSelection).$cursor || undefined;\n}\n\n/**\n * Check if a mark is allowed at the current selection / cursor based on a given state.\n * This method looks at both the currently active marks on the transaction, as well as\n * the node and marks at the current selection to determine if the given mark type is\n * allowed.\n */\nexport function isMarkTypeAllowedInCurrentSelection(\n    markType: MarkType,\n    state: EditorState,\n) {\n\n    if (!isMarkTypeAllowedInNode(markType, state)) {\n        return false;\n    }\n\n    const { empty, $cursor, ranges } = state.selection as TextSelection;\n    if (empty && !$cursor) {\n        return false;\n    }\n\n    const isCompatibleMarkType = (mark: PMMark) =>\n        isMarkTypeCompatibleWithMark(markType, mark);\n\n    // Handle any new marks in the current transaction\n    if (\n        state.tr.storedMarks &&\n        !state.tr.storedMarks.every(isCompatibleMarkType)\n    ) {\n        return false;\n    }\n\n    if ($cursor) {\n        return $cursor.marks().every(isCompatibleMarkType);\n    }\n\n    // Check every node in a selection - ensuring that it is compatible with the current mark type\n    return ranges.every(({ $from, $to }) => {\n        let allowedInActiveMarks =\n            $from.depth === 0 ? state.doc.marks.every(isCompatibleMarkType) : true;\n\n        state.doc.nodesBetween($from.pos, $to.pos, node => {\n            allowedInActiveMarks =\n                allowedInActiveMarks && node.marks.every(isCompatibleMarkType);\n        });\n\n        return allowedInActiveMarks;\n    });\n}\n\n/**\n * Step through block-nodes between $from and $to and returns false if a node is\n * found that isn\"t of the specified type\n */\nexport function isRangeOfType(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n    nodeType: NodeType,\n): boolean {\n    return (\n        getAncestorNodesBetween(doc, $from, $to).filter(\n            node => node.type !== nodeType,\n        ).length === 0\n    );\n}\n\nexport function createSliceWithContent(content: string, state: EditorState) {\n    return new Slice(Fragment.from(state.schema.text(content)), 0, 0);\n}\n\n/**\n * Determines if content inside a selection can be joined with the next block.\n * We need this check since the built-in method for \"joinDown\" will join a orderedList with bulletList.\n */\nexport function canJoinDown(\n    selection: Selection,\n    doc: any,\n    nodeType: NodeType,\n): boolean {\n    return checkNodeDown(selection, doc, node => node.type === nodeType);\n}\n\nexport function checkNodeDown(\n    selection: Selection,\n    doc: Node,\n    filter: (node: Node) => boolean,\n): boolean {\n    const res = doc.resolve(\n        selection.$to.after(findAncestorPosition(doc, selection.$to).depth),\n    );\n    return res.nodeAfter ? filter(res.nodeAfter) : false;\n}\n\nexport const setNodeSelection = (view: EditorView, pos: number) => {\n    const { state, dispatch } = view;\n\n    if (!isFinite(pos)) {\n        return;\n    }\n\n    const tr = state.tr.setSelection(NodeSelection.create(state.doc, pos));\n    dispatch(tr);\n};\n\nexport function setTextSelection(\n    view: EditorView,\n    anchor: number,\n    head?: number,\n) {\n    const { state } = view;\n    const tr = state.tr.setSelection(\n        TextSelection.create(state.doc, anchor, head),\n    );\n    view.dispatch(tr);\n}\n\n/**\n * Determines if content inside a selection can be joined with the previous block.\n * We need this check since the built-in method for \"joinUp\" will join a orderedList with bulletList.\n */\nexport function canJoinUp(\n    selection: Selection,\n    doc: any,\n    nodeType: NodeType,\n): boolean {\n    const res = doc.resolve(\n        selection.$from.before(findAncestorPosition(doc, selection.$from).depth),\n    );\n    return res.nodeBefore && res.nodeBefore.type === nodeType;\n}\n\n/**\n * Returns all top-level ancestor-nodes between $from and $to\n */\nexport function getAncestorNodesBetween(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): Node[] {\n    const nodes = Array<Node>();\n    const maxDepth = findAncestorPosition(doc, $from).depth;\n    let current = doc.resolve($from.start(maxDepth));\n\n    while (current.pos <= $to.start($to.depth)) {\n        const depth = Math.min(current.depth, maxDepth);\n        const node = current.node(depth);\n\n        if (node) {\n            nodes.push(node);\n        }\n\n        if (depth === 0) {\n            break;\n        }\n\n        let next: ResolvedPos = doc.resolve(current.after(depth));\n        if (next.start(depth) >= doc.nodeSize - 2) {\n            break;\n        }\n\n        if (next.depth !== current.depth) {\n            next = doc.resolve(next.pos + 2);\n        }\n\n        if (next.depth) {\n            current = doc.resolve(next.start(next.depth));\n        } else {\n            current = doc.resolve(next.end(next.depth));\n        }\n    }\n\n    return nodes;\n}\n\n/**\n * Finds all \"selection-groups\" within a range. A selection group is based on ancestors.\n *\n * Example:\n * Given the following document and selection ({<} = start of selection and {>} = end)\n *  doc\n *    blockquote\n *      ul\n *        li\n *        li{<}\n *        li\n *     p\n *     p{>}\n *\n * The output will be two selection-groups. One within the ul and one with the two paragraphs.\n */\nexport function getGroupsInRange(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n    isNodeValid: (node: Node) => boolean = validateNode,\n): Array<{ $from: ResolvedPos; $to: ResolvedPos }> {\n    const groups = Array<{ $from: ResolvedPos; $to: ResolvedPos }>();\n    const commonAncestor = hasCommonAncestor(doc, $from, $to);\n    const fromAncestor = findAncestorPosition(doc, $from);\n\n    if (\n        commonAncestor ||\n        (fromAncestor.depth === 1 && isNodeValid($from.node(1)))\n    ) {\n        groups.push({ $from, $to });\n    } else {\n        let current = $from;\n\n        while (current.pos < $to.pos) {\n            let ancestorPos = findAncestorPosition(doc, current);\n            while (ancestorPos.depth > 1) {\n                ancestorPos = findAncestorPosition(doc, ancestorPos);\n            }\n\n            const endPos = doc.resolve(\n                Math.min(\n                    // should not be smaller then start position in case of an empty paragraph for example.\n                    Math.max(\n                        ancestorPos.start(ancestorPos.depth),\n                        ancestorPos.end(ancestorPos.depth) - 3,\n                    ),\n                    $to.pos,\n                ),\n            );\n\n            groups.push({\n                $from: current,\n                $to: endPos,\n            });\n\n            current = doc.resolve(Math.min(endPos.after(1) + 1, doc.nodeSize - 2));\n        }\n    }\n\n    return groups;\n}\n\n/**\n * Traverse the document until an \"ancestor\" is found. Any nestable block can be an ancestor.\n */\nexport function findAncestorPosition(doc: Node, pos: any): any {\n    const nestableBlocks = [\"blockquote\", \"bulletList\", \"orderedList\"];\n\n    if (pos.depth === 1) {\n        return pos;\n    }\n\n    let node: Node | undefined = pos.node(pos.depth);\n    let newPos = pos;\n    while (pos.depth >= 1) {\n        pos = doc.resolve(pos.before(pos.depth));\n        node = pos.node(pos.depth);\n\n        if (node && nestableBlocks.indexOf(node.type.name) !== -1) {\n            newPos = pos;\n        }\n    }\n\n    return newPos;\n}\n\n/**\n * Determine if two positions have a common ancestor.\n */\nexport function hasCommonAncestor(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): boolean {\n    let current;\n    let target;\n\n    if ($from.depth > $to.depth) {\n        current = findAncestorPosition(doc, $from);\n        target = findAncestorPosition(doc, $to);\n    } else {\n        current = findAncestorPosition(doc, $to);\n        target = findAncestorPosition(doc, $from);\n    }\n\n    while (current.depth > target.depth && current.depth > 1) {\n        current = findAncestorPosition(doc, current);\n    }\n\n    return current.node(current.depth) === target.node(target.depth);\n}\n\n/**\n * Takes a selection $from and $to and lift all text nodes from their parents to document-level\n */\nexport function liftSelection(\n    tr: Transaction,\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n) {\n    let startPos = $from.start($from.depth);\n    let endPos = $to.end($to.depth);\n    const target = Math.max(0, findAncestorPosition(doc, $from).depth - 1);\n\n    tr.doc.nodesBetween(startPos, endPos, (node, pos) => {\n        if (\n            node.isText || // Text node\n            (node.isTextblock && !node.textContent) // Empty paragraph\n        ) {\n            const res = tr.doc.resolve(tr.mapping.map(pos));\n            const sel = new NodeSelection(res);\n            const range = sel.$from.blockRange(sel.$to);\n\n            if (liftTarget(range as NodeRange) !== undefined) {\n                tr.lift(range, target);\n            }\n        }\n    });\n\n    startPos = tr.mapping.map(startPos);\n    endPos = tr.mapping.map(endPos);\n    endPos = tr.doc.resolve(endPos).end(tr.doc.resolve(endPos).depth); // We want to select the entire node\n\n    tr.setSelection(\n        new TextSelection(tr.doc.resolve(startPos), tr.doc.resolve(endPos)),\n    );\n\n    return {\n        tr: tr,\n        $from: tr.doc.resolve(startPos),\n        $to: tr.doc.resolve(endPos),\n    };\n}\n\n/**\n * Lift nodes in block to one level above.\n */\nexport function liftSiblingNodes(view: EditorView) {\n    const { tr } = view.state;\n    const { $from, $to } = view.state.selection;\n    const blockStart = tr.doc.resolve($from.start($from.depth - 1));\n    const blockEnd = tr.doc.resolve($to.end($to.depth - 1));\n    const range = blockStart.blockRange(blockEnd);\n    view.dispatch(tr.lift(range as NodeRange, blockStart.depth - 1));\n}\n\n/**\n * Lift sibling nodes to document-level and select them.\n */\nexport function liftAndSelectSiblingNodes(view: EditorView): Transaction {\n    const { tr } = view.state;\n    const { $from, $to } = view.state.selection;\n    const blockStart = tr.doc.resolve($from.start($from.depth - 1));\n    const blockEnd = tr.doc.resolve($to.end($to.depth - 1));\n    // TODO: [ts30] handle void and null properly\n    const range = blockStart.blockRange(blockEnd) as NodeRange;\n    tr.setSelection(new TextSelection(blockStart, blockEnd));\n    tr.lift(range as NodeRange, blockStart.depth - 1);\n    return tr;\n}\n\nexport function wrapIn(\n    nodeType: NodeType,\n    tr: Transaction,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): Transaction {\n    const range = $from.blockRange($to) as any;\n    const wrapping = range && (findWrapping(range, nodeType) as any);\n    if (wrapping) {\n        tr = tr.wrap(range, wrapping).scrollIntoView();\n    }\n    return tr;\n}\n\n/**\n * Repeating string for multiple times\n */\nexport function stringRepeat(text: string, length: number): string {\n    let result = \"\";\n    for (let x = 0; x < length; x++) {\n        result += text;\n    }\n    return result;\n}\n\n/**\n * A replacement for `Array.from` until it becomes widely implemented.\n */\nexport function arrayFrom(obj: any): any[] {\n    return Array.prototype.slice.call(obj);\n}\n\n/**\n * Replacement for Element.closest, until it becomes widely implemented\n * Returns the ancestor element of a particular type if exists or null\n */\nexport function closestElement(\n    node: HTMLElement | null | undefined,\n    s: string,\n): HTMLElement | null {\n    return closest(node, s);\n}\n\n/*\n * From Modernizr\n * Returns the kind of transitionevent available for the element\n */\nexport function whichTransitionEvent<TransitionEventName extends string>() {\n    const el = document.createElement(\"fakeelement\");\n    const transitions: Record<string, string> = {\n        transition: \"transitionend\",\n        MozTransition: \"transitionend\",\n        OTransition: \"oTransitionEnd\",\n        WebkitTransition: \"webkitTransitionEnd\",\n    };\n\n    for (const t in transitions) {\n        if (el.style[t as keyof CSSStyleDeclaration] !== undefined) {\n            // Use a generic as the return type because TypeScript doesnt know\n            // about cross browser features, so we cast here to align to the\n            // standard Event spec and propagate the type properly to the callbacks\n            // of `addEventListener` and `removeEventListener`.\n            return transitions[t] as TransitionEventName;\n        }\n    }\n\n    return;\n}\n\n/**\n * Function will create a list of wrapper blocks present in a selection.\n */\nfunction getSelectedWrapperNodes(state: EditorState): NodeType[] {\n    const nodes: Array<NodeType> = [];\n    if (state.selection) {\n        const { $from, $to } = state.selection;\n        const {\n            blockquote,\n            panel,\n            orderedList,\n            bulletList,\n            listItem,\n            codeBlock,\n        } = state.schema.nodes;\n        state.doc.nodesBetween($from.pos, $to.pos, node => {\n            if (\n                (node.isBlock &&\n                    [blockquote, panel, orderedList, bulletList, listItem].indexOf(\n                        node.type,\n                    ) >= 0) ||\n                node.type === codeBlock\n            ) {\n                nodes.push(node.type);\n            }\n        });\n    }\n    return nodes;\n}\n\n/**\n * Function will check if changing block types: Paragraph, Heading is enabled.\n */\nexport function areBlockTypesDisabled(state: EditorState): boolean {\n    const nodesTypes: NodeType[] = getSelectedWrapperNodes(state);\n    const { panel } = state.schema.nodes;\n    return nodesTypes.filter(type => type !== panel).length > 0;\n}\n\nexport const isTemporary = (id: string): boolean => {\n    return id.indexOf(\"temporary:\") === 0;\n};\n\n\nexport const isEmptyNode = (schema: Schema) => {\n    const {\n        doc,\n        paragraph,\n        codeBlock,\n        blockquote,\n        panel,\n        heading,\n        listItem,\n        bulletList,\n        orderedList,\n        taskList,\n        taskItem,\n        decisionList,\n        decisionItem,\n        media,\n        mediaGroup,\n        mediaSingle,\n    } = schema.nodes;\n    const innerIsEmptyNode = (node: Node): boolean => {\n        switch (node.type) {\n            case media:\n            case mediaGroup:\n            case mediaSingle:\n                return false;\n            case paragraph:\n            case codeBlock:\n            case heading:\n            case taskItem:\n            case decisionItem:\n                return node.content.size === 0;\n            case blockquote:\n            case panel:\n            case listItem:\n                return (\n                    node.content.size === 2 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case bulletList:\n            case orderedList:\n                return (\n                    node.content.size === 4 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case taskList:\n            case decisionList:\n                return (\n                    node.content.size === 2 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case doc:\n                let isEmpty = true;\n                node.content.forEach(child => {\n                    isEmpty = isEmpty && innerIsEmptyNode(child);\n                });\n                return isEmpty;\n            default:\n                return isNodeEmpty(node);\n        }\n    };\n    return innerIsEmptyNode;\n};\n\nexport const insideTable = (state: EditorState): Boolean => {\n    const { table, tableCell } = state.schema.nodes;\n\n    return hasParentNodeOfType([table, tableCell])(state.selection);\n};\n\nexport const insideTableCell = (state: EditorState) => {\n    const { tableCell, tableHeader } = state.schema.nodes;\n    return hasParentNodeOfType([tableCell, tableHeader])(state.selection);\n};\n\nexport const isElementInTableCell = (\n    element: HTMLElement | null,\n): HTMLElement | null => {\n    return closest(element, \"td\") || closest(element, \"th\");\n};\n\nexport const isLastItemMediaGroup = (node: Node): boolean => {\n    const { content } = node;\n    return !!content.lastChild && content.lastChild.type.name === \"mediaGroup\";\n};\n\nexport const isInListItem = (state: EditorState): boolean => {\n    return hasParentNodeOfType(state.schema.nodes.listItem)(state.selection);\n};\n\nexport const hasOpenEnd = (slice: Slice): boolean => {\n    return slice.openStart > 0 || slice.openEnd > 0;\n};\n\nexport function filterChildrenBetween(\n    doc: Node,\n    from: number,\n    to: number,\n    predicate: (node: Node, pos: number, parent: Node) => boolean | undefined,\n) {\n    const results = [] as { node: Node; pos: number }[];\n    doc.nodesBetween(from, to, (node, pos, parent) => {\n        if (predicate(node, pos, parent)) {\n            results.push({ node, pos });\n        }\n    });\n    return results;\n}\n\nexport function dedupe<T>(\n    list: T[] = [],\n    iteratee?: (p: T) => T[keyof T] | T,\n): T[] {\n    const transformed = iteratee ? list.map(iteratee) : list;\n\n    return transformed\n        .map((item, index, list) => (list.indexOf(item) === index ? item : null))\n        .reduce<T[]>(\n            (acc, item, index) => (!!item ? acc.concat(list[index]) : acc),\n            [],\n        );\n}\n\nexport const isTextSelection = (\n    selection: Selection,\n): selection is TextSelection => selection instanceof TextSelection;\n\n/** Helper type for single arg function */\ntype Func<A, B> = (a: A) => B;\ntype FuncN<A extends any[], B> = (...args: A) => B;\n\n/**\n * Compose 1 to n functions.\n * @param func first function\n * @param funcs additional functions\n */\nexport function compose<\n    F1 extends Func<any, any>,\n    FN extends Array<Func<any, any>>,\n    R extends FN extends []\n        ? F1\n        : FN extends [Func<infer A, any>]\n            ? (a: A) => ReturnType<F1>\n            : FN extends [any, Func<infer A, any>]\n                ? (a: A) => ReturnType<F1>\n                : FN extends [any, any, Func<infer A, any>]\n                    ? (a: A) => ReturnType<F1>\n                    : FN extends [any, any, any, Func<infer A, any>]\n                        ? (a: A) => ReturnType<F1>\n                        : FN extends [any, any, any, any, Func<infer A, any>]\n                            ? (a: A) => ReturnType<F1>\n                            : Func<any, ReturnType<F1>> // Doubtful we\"d ever want to pipe this many functions, but in the off chance someone does, we can still infer the return type\n    >(func: F1, ...funcs: FN): R {\n    const allFuncs = [func, ...funcs];\n    return function composed(raw: any) {\n        return allFuncs.reduceRight((memo, func) => func(memo), raw);\n    } as R;\n}\n\nexport function pipe(): <R>(a: R) => R;\n\nexport function pipe<F extends Function>(f: F): F;\n\n// one function\nexport function pipe<F1 extends FuncN<any, any>>(\n    f1: F1,\n): (...args: Parameters<F1>) => ReturnType<F1>;\n\n// two function\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>\n    >(f1: F1, f2: F2): (...args: Parameters<F1>) => ReturnType<F2>;\n\n// three function\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>,\n    F3 extends Func<ReturnType<F2>, any>\n    >(f1: F1, f2: F2, f3: F3): (...args: Parameters<F1>) => ReturnType<F3>;\n// If needed add more than 3 function\n// Generic\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>,\n    F3 extends Func<ReturnType<F2>, any>,\n    FN extends Array<Func<any, any>>\n    >(f1: F1, f2: F2, f3: F3, ...fn: FN): (...args: Parameters<F1>) => any;\n\n// rest\nexport function pipe(...fns: Function[]) {\n    if (fns.length === 0) {\n        return (a: any) => a;\n    }\n\n    if (fns.length === 1) {\n        return fns[0];\n    }\n\n    return fns.reduce((prevFn, nextFn) => (...args: any[]) =>\n        nextFn(prevFn(...args)),\n    );\n}\n\nexport const normaliseNestedLayout = (state: EditorState, node: Node) => {\n    if (state.selection.$from.depth > 1) {\n        if (node.attrs.layout && node.attrs.layout !== \"default\") {\n            return node.type.createChecked(\n                {\n                    ...node.attrs,\n                    layout: \"default\",\n                },\n                node.content,\n                node.marks,\n            );\n        }\n\n        // If its a breakout layout, we can remove the mark\n        // Since default isn\"t a valid breakout mode.\n        const breakoutMark: MarkType = state.schema.marks.breakout;\n        if (breakoutMark && breakoutMark.isInSet(node.marks)) {\n            const newMarks = breakoutMark.removeFromSet(node.marks);\n            return node.type.createChecked(node.attrs, node.content, newMarks);\n        }\n    }\n\n    return node;\n};\n","// https://github.com/ProseMirror/prosemirror-commands/blob/master/src/commands.js#L90\n// Keep going left up the tree, without going across isolating boundaries, until we\n// can go along the tree at that same level\n//\n// You can think of this as, if you could construct each document like we do in the tests,\n// return the position of the first ) backwards from the current selection.\nimport {ResolvedPos} from \"prosemirror-model\";\n\nexport function findCutBefore($pos: ResolvedPos): ResolvedPos | null {\n\n    // parent is non-isolating, so we can look across this boundary\n    if (!$pos.parent.type.spec.isolating) {\n        // search up the tree from the pos\"s *parent*\n        for (let i = $pos.depth - 1; i >= 0; i--) {\n            // starting from the inner most node\"s parent, find out\n            // if we\"re not its first child\n            if ($pos.index(i) > 0) {\n                return $pos.doc.resolve($pos.before(i + 1));\n            }\n\n            if ($pos.node(i).type.spec.isolating) {\n                break;\n            }\n        }\n    }\n\n    return null;\n}\n","import * as baseCommand from \"prosemirror-commands\";\nimport {GapCursor} from \"prosemirror-gapcursor\";\nimport {Fragment, Node, NodeRange, NodeType, ResolvedPos, Slice} from \"prosemirror-model\";\nimport * as baseListCommand from \"prosemirror-schema-list\";\nimport {EditorState, NodeSelection, TextSelection, Transaction} from \"prosemirror-state\";\nimport {liftTarget, ReplaceAroundStep} from \"prosemirror-transform\";\nimport {findPositionOfNodeBefore, hasParentNodeOfType} from \"prosemirror-utils\";\nimport {EditorView} from \"prosemirror-view\";\nimport {Command} from \"./command\";\nimport {filter} from \"./commands/filter\";\nimport {isEmptySelectionAtStart} from \"./commands/is-empty-selection-at-start\";\nimport {isFirstChildOfParent} from \"./commands/is-first-child-of-parent\";\nimport {hasVisibleContent, isNodeEmpty} from \"./document-utils\";\nimport {liftFollowingList} from \"./list/transforms/lift-following-list\";\nimport {liftSelectionList} from \"./list/transforms/lift-selection-list\";\nimport {sanitizeSelectionMarks} from \"./mark-utils\";\nimport {compose, isRangeOfType} from \"./utils\";\nimport {findCutBefore} from \"./utils/find-cut-before\";\n\nconst maxIndentation = 5;\n\nconst deletePreviousEmptyListItem: Command = (state, dispatch) => {\n    const { $from } = state.selection;\n    const { listItem } = state.schema.nodes;\n\n    const $cut = findCutBefore($from);\n    if (!$cut || !$cut.nodeBefore || !($cut.nodeBefore.type === listItem)) {\n        return false;\n    }\n\n    const previousListItemEmpty = $cut.nodeBefore.childCount === 1 && $cut.nodeBefore.firstChild && $cut.nodeBefore.firstChild.nodeSize <= 2;\n\n    if (previousListItemEmpty) {\n        const { tr } = state;\n\n        if (dispatch) {\n            dispatch(\n                tr\n                    .delete($cut.pos - $cut.nodeBefore.nodeSize, $from.pos)\n                    .scrollIntoView(),\n            );\n        }\n        return true;\n    }\n\n    return false;\n};\n\nconst joinToPreviousListItem: Command = (state, dispatch) => {\n    const { $from } = state.selection;\n    const {\n        paragraph,\n        listItem,\n        codeBlock,\n        bulletList,\n        orderedList,\n    } = state.schema.nodes;\n    const isGapCursorShown = state.selection instanceof GapCursor;\n    const $cutPos = isGapCursorShown ? state.doc.resolve($from.pos + 1) : $from;\n    const $cut = findCutBefore($cutPos);\n    if (!$cut) {\n        return false;\n    }\n\n    // see if the containing node is a list\n    if (\n        $cut.nodeBefore &&\n        [bulletList, orderedList].indexOf($cut.nodeBefore.type) > -1\n    ) {\n        // and the node after this is a paragraph or a codeBlock\n        if (\n            $cut.nodeAfter &&\n            ($cut.nodeAfter.type === paragraph || $cut.nodeAfter.type === codeBlock)\n        ) {\n            // find the nearest paragraph that precedes this node\n            let $lastNode = $cut.doc.resolve($cut.pos - 1);\n\n            while ($lastNode.parent.type !== paragraph) {\n                $lastNode = state.doc.resolve($lastNode.pos - 1);\n            }\n\n            let { tr } = state;\n            if (isGapCursorShown) {\n                const nodeBeforePos = findPositionOfNodeBefore(tr.selection);\n                if (typeof nodeBeforePos !== \"number\") {\n                    return false;\n                }\n                // append the codeblock to the list node\n                const list = $cut.nodeBefore.copy(\n                    $cut.nodeBefore.content.append(\n                        Fragment.from(listItem.createChecked({}, $cut.nodeAfter)),\n                    ),\n                );\n                tr.replaceWith(\n                    nodeBeforePos,\n                    $from.pos + $cut.nodeAfter.nodeSize,\n                    list,\n                );\n            } else {\n                // take the text content of the paragraph and insert after the paragraph up until before the the cut\n                tr = state.tr.step(\n                    new ReplaceAroundStep(\n                        $lastNode.pos,\n                        $cut.pos + $cut.nodeAfter.nodeSize,\n                        $cut.pos + 1,\n                        $cut.pos + $cut.nodeAfter.nodeSize - 1,\n                        state.tr.doc.slice($lastNode.pos, $cut.pos),\n                        0,\n                        true,\n                    ),\n                );\n            }\n\n            // find out if there\"s now another list following and join them\n            // as in, [list, p, list] => [list with p, list], and we want [joined list]\n            const $postCut = tr.doc.resolve(\n                tr.mapping.map($cut.pos + $cut.nodeAfter.nodeSize),\n            );\n            if (\n                $postCut.nodeBefore &&\n                $postCut.nodeAfter &&\n                $postCut.nodeBefore.type === $postCut.nodeAfter.type &&\n                [bulletList, orderedList].indexOf($postCut.nodeBefore.type) > -1\n            ) {\n                tr = tr.join($postCut.pos);\n            }\n\n            if (dispatch) {\n                dispatch(tr.scrollIntoView());\n            }\n            return true;\n        }\n    }\n\n    return false;\n};\n\nconst isInsideListItem = (state: EditorState): boolean => {\n    const { $from } = state.selection;\n    const { listItem, paragraph } = state.schema.nodes;\n\n    if (state.selection instanceof GapCursor) {\n        return $from.parent.type === listItem;\n    }\n\n    return (\n        hasParentNodeOfType(listItem)(state.selection) &&\n        $from.parent.type === paragraph\n    );\n};\n\nconst canToJoinToPreviousListItem = (state: EditorState): boolean => {\n    const { $from } = state.selection;\n    const { bulletList, orderedList } = state.schema.nodes;\n\n    const $before = state.doc.resolve($from.pos - 1);\n    let nodeBefore = $before ? $before.nodeBefore : null;\n\n    if (state.selection instanceof GapCursor) {\n        nodeBefore = $from.nodeBefore;\n    }\n\n    return (\n        !!nodeBefore && [bulletList, orderedList].indexOf(nodeBefore.type) > -1\n    );\n};\n\nconst canOutdent = (state: EditorState): boolean => {\n    const { parent } = state.selection.$from;\n    const { listItem, paragraph } = state.schema.nodes;\n\n    if (state.selection instanceof GapCursor) {\n        return parent.type === listItem;\n    }\n\n    return (\n        parent.type === paragraph && hasParentNodeOfType(listItem)(state.selection)\n    );\n};\n\nexport const enterKeyCommand: Command = (state, dispatch): boolean => {\n    const { selection } = state;\n    if (selection.empty) {\n        const { $from } = selection;\n        const { listItem, codeBlock } = state.schema.nodes;\n        const node = $from.node($from.depth);\n        const wrapper = $from.node($from.depth - 1);\n\n        if (wrapper && wrapper.type === listItem) {\n            /** Check if the wrapper has any visible content */\n            const wrapperHasContent = hasVisibleContent(wrapper);\n            if (isNodeEmpty(node) && !wrapperHasContent) {\n                return outdentList()(state, dispatch);\n            } else if (!hasParentNodeOfType(codeBlock)(selection)) {\n                return splitListItem(listItem)(state, dispatch);\n            }\n        }\n    }\n    return false;\n};\n\nexport const backspaceKeyCommand = baseCommand.chainCommands(\n    // if we\"re at the start of a list item, we need to either backspace\n    // directly to an empty list item above, or outdent this node\n    filter(\n        [\n            isEmptySelectionAtStart,\n\n            // list items might have multiple paragraphs; only do this at the first one\n            isFirstChildOfParent,\n            canOutdent,\n        ],\n        baseCommand.chainCommands(deletePreviousEmptyListItem, outdentList()),\n    ),\n\n    // if we\"re just inside a paragraph node (or gapcursor is shown) and backspace, then try to join\n    // the text to the previous list item, if one exists\n    filter(\n        [isEmptySelectionAtStart, canToJoinToPreviousListItem],\n        joinToPreviousListItem,\n    ),\n);\n\n/**\n * Implemetation taken and modified for our needs from PM\n * @param itemType Node\n * Splits the list items, specific implementation take from PM\n */\nfunction splitListItem(itemType: NodeType): Command {\n    return function(state, dispatch) {\n        const ref = state.selection as NodeSelection;\n        const $from = ref.$from;\n        const $to = ref.$to;\n        const node = ref.node;\n        if ((node && node.isBlock) || $from.depth < 2 || !$from.sameParent($to)) {\n            return false;\n        }\n        const grandParent = $from.node(-1);\n        if (grandParent.type !== itemType) {\n            return false;\n        }\n        /** --> The following line changed from the original PM implementation to allow list additions with multiple paragraphs */\n        if (\n            (grandParent.content as any).content.length <= 1 &&\n            $from.parent.content.size === 0 &&\n            !(grandParent.content.size === 0)\n        ) {\n            // In an empty block. If this is a nested list, the wrapping\n            // list item should be split. Otherwise, bail out and let next\n            // command handle lifting.\n            if (\n                $from.depth === 2 ||\n                $from.node(-3).type !== itemType ||\n                $from.index(-2) !== $from.node(-2).childCount - 1\n            ) {\n                return false;\n            }\n            if (dispatch) {\n                let wrap = Fragment.empty;\n                const keepItem = $from.index(-1) > 0;\n                // Build a fragment containing empty versions of the structure\n                // from the outer list item to the parent node of the cursor\n                for (\n                    let d = $from.depth - (keepItem ? 1 : 2);\n                    d >= $from.depth - 3;\n                    d--\n                ) {\n                    wrap = Fragment.from($from.node(d).copy(wrap));\n                }\n                // Add a second list item with an empty default start node\n                wrap = wrap.append(Fragment.from(itemType.createAndFill()));\n                const tr$1 = state.tr.replace(\n                    $from.before(keepItem ? undefined : -1),\n                    $from.after(-3),\n                    new Slice(wrap, keepItem ? 3 : 2, 2),\n                );\n                tr$1.setSelection(\n                    (state.selection.constructor as any).near(\n                        tr$1.doc.resolve($from.pos + (keepItem ? 3 : 2)),\n                    ),\n                );\n                dispatch(tr$1.scrollIntoView());\n            }\n            return true;\n        }\n        const nextType =\n            $to.pos === $from.end()\n                ? grandParent.contentMatchAt(0).defaultType\n                : undefined;\n        const tr = state.tr.delete($from.pos, $to.pos);\n        const types = nextType && [undefined, { type: nextType }];\n\n        if (dispatch) {\n            dispatch(tr.split($from.pos, 2, types as any).scrollIntoView());\n        }\n        return true;\n    };\n}\n\n/**\n * Merge closest bullet list blocks into one\n */\nfunction mergeLists(listItem: NodeType, range: NodeRange) {\n    return (command: Command): Command => {\n        return (state, dispatch) =>\n            command(state, tr => {\n                /* we now need to handle the case that we lifted a sublist out,\n                 * and any listItems at the current level get shifted out to\n                 * their own new list; e.g.:\n                 *\n                 * unorderedList\n                 *  listItem(A)\n                 *  listItem\n                 *    unorderedList\n                 *      listItem(B)\n                 *  listItem(C)\n                 *\n                 * becomes, after unindenting the first, top level listItem, A:\n                 *\n                 * content of A\n                 * unorderedList\n                 *  listItem(B)\n                 * unorderedList\n                 *  listItem(C)\n                 *\n                 * so, we try to merge these two lists if they\"re of the same type, to give:\n                 *\n                 * content of A\n                 * unorderedList\n                 *  listItem(B)\n                 *  listItem(C)\n                 */\n\n                const $start: ResolvedPos = state.doc.resolve(range.start);\n                const $end: ResolvedPos = state.doc.resolve(range.end);\n                const $join = tr.doc.resolve(tr.mapping.map(range.end - 1));\n\n                if (\n                    $join.nodeBefore &&\n                    $join.nodeAfter &&\n                    $join.nodeBefore.type === $join.nodeAfter.type\n                ) {\n                    if (\n                        $end.nodeAfter &&\n                        $end.nodeAfter.type === listItem &&\n                        $end.parent.type === $start.parent.type\n                    ) {\n                        tr.join($join.pos);\n                    }\n                }\n\n                if (dispatch) {\n                    dispatch(tr.scrollIntoView());\n                }\n            });\n    };\n}\n\nexport function outdentList(): Command {\n    return function(state, dispatch) {\n        const { listItem } = state.schema.nodes;\n        const { $from, $to } = state.selection;\n        if (isInsideListItem(state)) {\n            // if we\"re backspacing at the start of a list item, unindent it\n            // take the the range of nodes we might be lifting\n\n            // the predicate is for when you\"re backspacing a top level list item:\n            // we don\"t want to go up past the doc node, otherwise the range\n            // to clear will include everything\n            const range = $from.blockRange(\n                $to,\n                node => node.childCount > 0 && node.firstChild && node.firstChild.type === listItem,\n            );\n\n            if (!range) {\n                return false;\n            }\n            return compose(\n                mergeLists(listItem, range), // 2. Check if I need to merge nearest list\n                baseListCommand.liftListItem, // 1. First lift list item\n            )(listItem)(state, dispatch);\n        }\n\n        return false;\n    };\n}\n\n/**\n * Check if we can sink the list.\n *\n * @returns true if we can sink the list, false if we reach the max indentation level\n */\nfunction canSink(initialIndentationLevel: number, state: EditorState): boolean {\n    /*\n        - Keep going forward in document until indentation of the node is < than the initial\n        - If indentation is EVER > max indentation, return true and don\"t sink the list\n        */\n    let currentIndentationLevel: number;\n    let currentPos = state.tr.selection.$to.pos;\n    do {\n        const resolvedPos = state.doc.resolve(currentPos);\n        currentIndentationLevel = numberNestedLists(\n            resolvedPos,\n            state.schema.nodes,\n        );\n        if (currentIndentationLevel > maxIndentation) {\n            // Cancel sink list.\n            // If current indentation less than the initial, it won\"t be\n            // larger than the max, and the loop will terminate at end of this iteration\n            return false;\n        }\n        currentPos++;\n    } while (currentIndentationLevel >= initialIndentationLevel);\n\n    return true;\n}\n\nexport function indentList(): Command {\n    return function(state, dispatch) {\n        const { listItem } = state.schema.nodes;\n        if (isInsideListItem(state)) {\n            // Record initial list indentation\n            const initialIndentationLevel = numberNestedLists(\n                state.selection.$from,\n                state.schema.nodes,\n            );\n\n            if (canSink(initialIndentationLevel, state)) {\n                compose(\n                    baseListCommand.sinkListItem,\n                )(listItem)(state, dispatch);\n            }\n            return true;\n        }\n        return false;\n    };\n}\n\nexport function liftListItems(): Command {\n    return function(state, dispatch) {\n        const { tr } = state;\n        const { $from, $to } = state.selection;\n\n        tr.doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n            // Following condition will ensure that block types paragraph, heading, codeBlock, blockquote, panel are lifted.\n            // isTextblock is true for paragraph, heading, codeBlock.\n            if (\n                node.isTextblock ||\n                node.type.name === \"blockquote\" ||\n                node.type.name === \"panel\"\n            ) {\n                const sel = new NodeSelection(tr.doc.resolve(tr.mapping.map(pos)));\n                const range = sel.$from.blockRange(sel.$to);\n\n                if (!range || sel.$from.parent.type !== state.schema.nodes.listItem) {\n                    return false;\n                }\n\n                const target = range && liftTarget(range);\n\n                if (target === undefined || target === null) {\n                    return false;\n                }\n\n                tr.lift(range, target);\n            }\n            return;\n        });\n\n        if (dispatch) {\n            dispatch(tr);\n        }\n\n        return true;\n    };\n}\n\n/**\n * Sometimes a selection in the editor can be slightly offset, for example:\n * it\"s possible for a selection to start or end at an empty node at the very end of\n * a line. This isn\"t obvious by looking at the editor and it\"s likely not what the\n * user intended - so we need to adjust the selection a bit in scenarios like that.\n */\nexport function adjustSelectionInList(\n    doc: Node,\n    selection: TextSelection,\n): TextSelection {\n    const { $from, $to } = selection;\n\n    const isSameLine = $from.pos === $to.pos;\n\n    let startPos = $from.pos;\n    const endPos = $to.pos;\n\n    if (isSameLine && startPos === doc.nodeSize - 3) {\n        // Line is empty, don\"t do anything\n        return selection;\n    }\n\n    // Selection started at the very beginning of a line and therefor points to the previous line.\n    if ($from.nodeBefore && !isSameLine) {\n        startPos++;\n        let node = doc.nodeAt(startPos);\n        while (!node || (node && !node.isText)) {\n            startPos++;\n            node = doc.nodeAt(startPos);\n        }\n    }\n\n    if (endPos === startPos) {\n        return new TextSelection(doc.resolve(startPos));\n    }\n\n    return new TextSelection(doc.resolve(startPos), doc.resolve(endPos));\n}\n\n// Get the depth of the nearest ancestor list\nexport const rootListDepth = (\n    pos: ResolvedPos,\n    nodes: Record<string, NodeType>,\n) => {\n    const { bulletList, orderedList, listItem } = nodes;\n    let depth;\n    for (let i = pos.depth - 1; i > 0; i--) {\n        const node = pos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            depth = i;\n        }\n        if (\n            node.type !== bulletList &&\n            node.type !== orderedList &&\n            node.type !== listItem\n        ) {\n            break;\n        }\n    }\n    return depth;\n};\n\n// Returns the number of nested lists that are ancestors of the given selection\nexport const numberNestedLists = (\n    resolvedPos: ResolvedPos,\n    nodes: Record<string, NodeType>,\n) => {\n    const { bulletList, orderedList } = nodes;\n    let count = 0;\n    for (let i = resolvedPos.depth - 1; i > 0; i--) {\n        const node = resolvedPos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            count += 1;\n        }\n    }\n    return count;\n};\n\nexport const toggleList = (\n    state: EditorState,\n    dispatch: (tr: Transaction) => void,\n    view: EditorView,\n    listType: \"bulletList\" | \"orderedList\",\n): boolean => {\n    const { selection } = state;\n    const fromNode = selection.$from.node(selection.$from.depth - 2);\n    const endNode = selection.$to.node(selection.$to.depth - 2);\n    if (\n        !fromNode ||\n        fromNode.type.name !== listType ||\n        (!endNode || endNode.type.name !== listType)\n    ) {\n        return toggleListCommand(listType)(state, dispatch, view);\n    } else {\n        const depth = rootListDepth(selection.$to, state.schema.nodes);\n        let tr = liftFollowingList(\n            state,\n            selection.$to.pos,\n            selection.$to.end(depth),\n            depth || 0,\n            state.tr,\n        );\n        tr = liftSelectionList(state, tr);\n        dispatch(tr);\n        return true;\n    }\n};\n\n/**\n * Check of is selection is inside a list of the specified type\n */\nexport function isInsideList(\n    state: EditorState,\n    listType: \"bulletList\" | \"orderedList\",\n) {\n    const { $from } = state.selection;\n    const parent = $from.node(-2);\n    const grandgrandParent = $from.node(-3);\n\n    return (\n        (parent && parent.type === state.schema.nodes[listType]) ||\n        (grandgrandParent && grandgrandParent.type === state.schema.nodes[listType])\n    );\n}\n\nexport function toggleListCommand(\n    listType: \"bulletList\" | \"orderedList\",\n): Command {\n    return function(state, dispatch, view) {\n        if (dispatch) {\n            dispatch(\n                state.tr.setSelection(\n                    adjustSelectionInList(state.doc, state.selection as TextSelection),\n                ),\n            );\n        }\n\n        if (!view) {\n            return false;\n        }\n\n        state = view.state;\n\n        const { $from, $to } = state.selection;\n        const isRangeOfSingleType = isRangeOfType(\n            state.doc,\n            $from,\n            $to,\n            state.schema.nodes[listType],\n        );\n\n        if (isInsideList(state, listType) && isRangeOfSingleType) {\n            // Untoggles list\n            return liftListItems()(state, dispatch);\n        } else {\n            // Converts list type e.g. bullet_list -> ordered_list if needed\n            if (!isRangeOfSingleType) {\n                liftListItems()(state, dispatch);\n                state = view.state;\n            }\n\n            // Remove any invalid marks that are not supported\n            const tr = sanitizeSelectionMarks(state);\n            if (tr) {\n                if (dispatch) {\n                    dispatch(tr);\n                }\n                state = view.state;\n            }\n            // Wraps selection in list\n            return wrapInList(state.schema.nodes[listType])(state, dispatch);\n        }\n    };\n}\n\nexport function toggleBulletList(view: EditorView) {\n    return toggleList(view.state, view.dispatch, view, \"bulletList\");\n}\n\nexport function toggleOrderedList(view: EditorView) {\n    return toggleList(view.state, view.dispatch, view, \"orderedList\");\n}\n\nexport function wrapInList(nodeType: NodeType): Command {\n    return baseCommand.autoJoin(\n        baseListCommand.wrapInList(nodeType),\n        (before, after) => before.type === after.type && before.type === nodeType,\n    );\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {HtmlEditor} from \"./editor\";\nimport {Command} from \"./prosemirror/command\";\nimport {indentList, outdentList, toggleList} from \"./prosemirror/list-commands\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findParentNode} from \"prosemirror-utils\";\n\n@Component({\n    styles: [`\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleList('bulletList')\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Bulleted list\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeUnnumberedList\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/list-bulleted.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleList('orderedList')\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Numbered list\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeNumberedList\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/list-numbered.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n            <ng-template [ngIf]=\"activeUnnumberedList || activeNumberedList\">\n\n                <ion-item-divider>\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Indent\" | intlMessage}}</ion-label>\n                </ion-item-divider>\n\n                <ion-item button=\"true\" detail=\"false\" (click)=\"level(-1)\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Decrease indent\" | intlMessage}}</ion-label>\n                    <ion-icon src=\"assets/html-editor/indent-decrease.svg\" slot=\"start\"></ion-icon>\n                </ion-item>\n\n                <ion-item button=\"true\" detail=\"false\" (click)=\"level(1)\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Increase indent\" | intlMessage}}</ion-label>\n                    <ion-icon src=\"assets/html-editor/indent-increase.svg\" slot=\"start\"></ion-icon>\n                </ion-item>\n\n            </ng-template>\n\n        </ion-list>\n    `\n})\nexport class ListMenu implements OnInit {\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    activeUnnumberedList: boolean;\n    activeNumberedList: boolean;\n\n    level(level: number) {\n\n        const command: Command = level < 0 ? outdentList() : indentList();\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    toggleList(type: \"bulletList\" | \"orderedList\") {\n        toggleList(this.editor.state, (tr) => this.editor.view.dispatch(tr), this.editor.view, type);\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n        this.activeUnnumberedList = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.bulletList))(this.editor.state.selection);\n        this.activeNumberedList = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.orderedList))(this.editor.state.selection);\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {MessageRef} from \"@co.mmons/js-intl\";\n\nexport class FontSize {\n\n    private static _sizes: FontSize[] = [];\n\n    static sizes() {\n        return FontSize._sizes.slice();\n    }\n\n    static readonly small = new FontSize(\"small\");\n    static readonly large = new FontSize(\"large\");\n\n    private constructor(public readonly size: string) {\n\n        FontSize._sizes.push(this);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"textMenu/fontSize/\" + size.toUpperCase()[0] + size.substring(1));\n    }\n\n    readonly label: MessageRef;\n}\n","import {shallowEqual} from \"fast-equals\";\nimport {MarkType, Node} from \"prosemirror-model\";\nimport {Command} from \"../command\";\n\nfunction markApplies(doc: Node, from: number, to: number, type: MarkType) {\n\n    let applies = false;\n\n    doc.nodesBetween(from, to, (node, pos, parent) => {\n\n        if (applies) {\n            return false;\n        }\n\n        applies = node.isInline && parent.type.allowsMarkType(type);\n    });\n\n    return applies;\n}\n\n// return true iff all nodes in range have the mark with the same attrs\nfunction rangeHasMark(doc, from, to, type, attrs) {\n\n    let hasMark = null;\n\n    doc.nodesBetween(from, to, node => {\n\n        for (let i = 0; i < node.marks.length; i++) {\n            const markMatch = node.marks[i].type === type && (!attrs || shallowEqual(node.marks[i].attrs, attrs));\n            hasMark = (markMatch && (hasMark === null || hasMark === true));\n        }\n\n        return hasMark;\n    });\n\n    return !!hasMark;\n}\n\nexport function toggleInlineMark(markType: MarkType, attrs?: {[key: string]: any}): Command {\n\n    return function(state, dispatch) {\n\n        const { empty, from, to, $from } = state.selection;\n\n        if (!markApplies(state.doc, from, to, markType)) {\n            console.log(\"not applies\");\n            return false;\n        }\n\n        if (dispatch) {\n\n            if (empty) {\n\n                const markInSet = markType.isInSet(state.storedMarks || $from.marks());\n\n                if (markInSet && (!attrs || shallowEqual(markInSet.attrs, attrs))) {\n                    dispatch(state.tr.removeStoredMark(markType));\n                } else {\n                    dispatch(state.tr.addStoredMark(markType.create(attrs)));\n                }\n\n            } else {\n\n                if (rangeHasMark(state.doc, from, to, markType, attrs)) {\n                    dispatch(state.tr.removeMark(from, to, markType).scrollIntoView());\n                } else {\n                    dispatch(state.tr.addMark(from, to, markType.create(attrs)).scrollIntoView());\n                }\n            }\n        }\n\n        return true;\n    };\n}\n\n","import {Mark, MarkType, NodeType} from \"prosemirror-model\";\nimport {EditorState, NodeSelection} from \"prosemirror-state\";\n\nexport function isActive(state: EditorState, nodeType: NodeType, attrs?: {[key: string]: any}, marks?: Array<Mark>) {\n\n    const selection = state.selection;\n\n    if (selection instanceof NodeSelection && selection.node) {\n        return selection.node.hasMarkup(nodeType, attrs, marks);\n    }\n\n    return selection.to <= selection.$from.end() && selection.$from.parent.hasMarkup(nodeType, attrs, marks);\n}\n\nexport function isMarkActive(state: EditorState, type: MarkType) {\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n        return !!(type.isInSet(state.storedMarks || $from.marks()));\n    } else {\n        return state.doc.rangeHasMark(from, to, type);\n    }\n}\n\nexport function anyMarkActive(state: EditorState, types: MarkType[]) {\n\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n\n        for (const type of types) {\n            if (type.isInSet(state.storedMarks || $from.marks())) {\n                return true;\n            }\n        }\n\n    } else {\n\n        for (const type of types) {\n            if (state.doc.rangeHasMark(from, to, type)) {\n                return true;\n            }\n        }\n\n    }\n\n    return false;\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {toggleMark} from \"prosemirror-commands\";\nimport {HtmlEditor} from \"./editor\";\nimport {FontSize} from \"./font-sizes\";\nimport {Command} from \"./prosemirror/command\";\nimport {toggleInlineMark} from \"./prosemirror/commands/toogle-inline-mark\";\nimport {isMarkActive} from \"./prosemirror/is-active\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findMarksInSelection} from \"./prosemirror/utils/find-marks-in-selection\";\n\n@Component({\n    styles: [`\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('bold')\">\n                <ion-label style=\"font-weight: bold\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Bold\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"boldActivated\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('italic')\">\n                <ion-label style=\"font-style: italic\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Italic\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"italicActivated\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('underline')\">\n                <ion-label style=\"text-decoration: underline\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Underline\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"underlineActivated\"></ion-icon>\n            </ion-item>\n            \n            <ion-item-divider>\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Text size\" | intlMessage}}</ion-label>\n            </ion-item-divider>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"resetFontSize()\" *ngIf=\"activeFontSize\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Default\" | intlMessage}}</ion-label>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleFontSize(fontSize)\" *ngFor=\"let fontSize of FontSize.sizes()\">\n                <ion-label [style.fontSize]=\"fontSize.size\">{{fontSize.label | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeFontSize === fontSize\"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    `\n})\nexport class TextFormatMenu implements OnInit {\n\n    readonly FontSize = FontSize;\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    editor: HtmlEditor;\n\n    boldActivated: boolean;\n\n    italicActivated: boolean;\n\n    underlineActivated: boolean;\n\n    activeFontSize: FontSize;\n\n\n    toggle(name: string) {\n\n        let command: Command;\n\n        if (name === \"bold\") {\n            command = toggleMark(schema.marks.strong);\n        } else if (name === \"italic\") {\n            command = toggleMark(schema.marks.em);\n        } else if (name === \"underline\") {\n            command = toggleMark(schema.marks.underline);\n        }\n\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    resetFontSize() {\n        toggleMark(schema.marks.fontSize)(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        this.popoverController.dismiss();\n    }\n\n    toggleFontSize(size: FontSize) {\n\n        const command = toggleInlineMark(schema.marks.fontSize, {fontSize: size.size});\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n        this.boldActivated = isMarkActive(this.editor.state, schema.marks.strong);\n        this.italicActivated = isMarkActive(this.editor.state, schema.marks.em);\n        this.underlineActivated = isMarkActive(this.editor.state, schema.marks.underline);\n\n        this.activeFontSize = undefined;\n        MARKS: for (const mark of findMarksInSelection(this.editor.state, schema.marks.fontSize)) {\n\n            for (const size of FontSize.sizes()) {\n                if (size.size === mark.attrs.fontSize) {\n\n                    // ups, mamy różne rozmiary w zaznaczeniu\n                    if (this.activeFontSize && size !== this.activeFontSize) {\n                        this.activeFontSize = undefined;\n                        break MARKS;\n                    }\n\n                    this.activeFontSize = size;\n                }\n            }\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function isBlockMarkActive(state: EditorState, type: MarkType) {\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n\n        for (const mark of $from.parent.marks) {\n            if (mark.type === type) {\n                return true;\n            }\n        }\n    } else {\n        return state.doc.rangeHasMark(from, to, type);\n    }\n}\n","import {Component, OnDestroy, OnInit} from \"@angular/core\";\nimport {EventManager} from \"@angular/platform-browser\";\nimport {unsubscribe} from \"@co.mmons/rxjs-utils\";\nimport {ModalController, Platform, PopoverController} from \"@ionic/angular\";\nimport {redo, redoDepth, undo, undoDepth} from \"prosemirror-history\";\nimport {findParentNode, findParentNodeOfType} from \"prosemirror-utils\";\nimport {Subscription} from \"rxjs\";\nimport {AlignmentMenu} from \"./alignment-menu\";\nimport {HtmlEditor} from \"./editor\";\nimport {HeadingMenu} from \"./heading-menu\";\nimport {InsertMenu} from \"./insert-menu\";\nimport {LinkModal} from \"./link-modal\";\nimport {ListMenu} from \"./list-menu\";\nimport {anyMarkActive, isMarkActive} from \"./prosemirror/is-active\";\nimport {schema} from \"./prosemirror/schema\";\nimport {isBlockMarkActive} from \"./prosemirror/utils/selection/is-block-mark-active\";\nimport {TextFormatMenu} from \"./text-format-menu\";\n\n@Component({\n    selector: \"ionx-html-editor-toolbar\",\n    template: `\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.text\" (click)=\"showMenu($event, 'text')\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Text\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.alignment\" (click)=\"showMenu($event, 'alignment')\" *ngIf=\"!editor.features || editor.features.alignment\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Alignment\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.heading\" (click)=\"showMenu($event, 'heading')\" *ngIf=\"!editor.features || editor.features.heading\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.list\" (click)=\"showMenu($event, 'list')\" *ngIf=\"!editor.features || editor.features.list\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/List\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" (click)=\"showMenu($event, 'insert')\" *ngIf=\"!editor.features || editor.features.link || editor.features.multimedia\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Insert\" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size=\"small\" fill=\"clear\" class=\"active-feature\" (click)=\"editLink()\" *ngIf=\"activeFeatures.link\">\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#link/Link\" | intlMessage}}</span>\n        </ion-button>\n        \n        <div ionx--buttons-group>\n            <ion-button size=\"small\" fill=\"clear\" tabindex=\"-1\" title=\"{{'@co.mmons/ionic-extensions/html-editor#Undo' | intlMessage}}\" [disabled]=\"!canUndo\" (click)=\"undo()\">\n                <ion-icon name=\"assets/html-editor/undo.svg\" slot=\"icon-only\"></ion-icon>\n            </ion-button>\n    \n            <ion-button size=\"small\" fill=\"clear\" title=\"{{'@co.mmons/ionic-extensions/html-editor#Redo' | intlMessage}}\" [disabled]=\"!canRedo\" (click)=\"redo()\">\n                <ion-icon name=\"assets/html-editor/redo.svg\" slot=\"icon-only\"></ion-icon>\n            </ion-button>\n        </div>\n    `,\n    styles: [`\n        :host { outline: none; display: flex; justify-content: center; flex-wrap: wrap; position: sticky; position: -webkit-sticky; top: 0px; background-color: var(--background); z-index: 1; }\n        :host-context(.ion-focused) { background-color: var(--background-focused); }\n        :host ion-button { margin: 0px 4px; --padding-end: 2px; --padding-start: 4px; }\n        :host ion-button.active-feature span { font-weight: 800; }\n        :host ion-icon[slot=\"end\"] { margin: 0px; }\n        :host ion-button[disabled] { opacity: 0.5; }\n        :host [ionx--buttons-group] { display: flex; }\n        :host [ionx--buttons-group] ion-button:not(:last-child) { margin-right: 0px; }\n    `]\n})\nexport class Toolbar implements OnInit, OnDestroy {\n\n    constructor(\n        private popoverController: PopoverController,\n        private platform: Platform,\n        public readonly editor: HtmlEditor,\n        protected eventManager: EventManager,\n        private modalController: ModalController\n    ) {\n\n    }\n\n    async showMenu(event: Event, menu: string) {\n\n        const components = {\n            text: TextFormatMenu,\n            list: ListMenu,\n            alignment: AlignmentMenu,\n            insert: InsertMenu,\n            heading: HeadingMenu\n        };\n\n        const popover = await this.popoverController.create({\n            component: components[menu],\n            componentProps: {\n                editor: this.editor\n            },\n            event: event,\n            showBackdrop: this.platform.is(\"ios\")\n        });\n\n        popover.present();\n    }\n\n    activeFeatures: {\n        link?: boolean,\n        text?: boolean,\n        alignment?: boolean,\n        heading?: boolean;\n        list?: boolean\n    } = {};\n\n    async editLink() {\n        LinkModal.present(this.modalController, this.editor);\n    }\n\n    canUndo: boolean;\n\n    canRedo: boolean;\n\n    undo() {\n        undo(this.editor.view.state, (transaction) => this.editor.view.updateState(this.editor.view.state.apply(transaction)));\n        this.editor.focus();\n    }\n\n    redo() {\n        redo(this.editor.view.state, (transaction) => this.editor.view.updateState(this.editor.view.state.apply(transaction)));\n        this.editor.focus();\n\n    }\n\n    private editorSelectionChanged() {\n\n        this.canUndo = undoDepth(this.editor.view.state) > 0;\n        this.canRedo = redoDepth(this.editor.view.state) > 0;\n\n        this.activeFeatures = {};\n\n        this.activeFeatures.text = anyMarkActive(this.editor.view.state, [schema.marks.strong, schema.marks.em, schema.marks.underline, schema.marks.fontSize]);\n        this.activeFeatures.list = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.orderedList) || predicate.hasMarkup(schema.nodes.bulletList))(this.editor.state.selection);\n        this.activeFeatures.alignment = isBlockMarkActive(this.editor.view.state, schema.marks.alignment);\n        this.activeFeatures.heading = !!findParentNodeOfType(schema.nodes.heading)(this.editor.state.selection);\n        this.activeFeatures.link = isMarkActive(this.editor.view.state, schema.marks.link);\n    }\n\n    private selectionSubscription: Subscription;\n\n    async ngOnInit() {\n\n        this.selectionSubscription = this.editor.selectionChange.subscribe(() => this.editorSelectionChanged());\n\n        this.editorSelectionChanged();\n    }\n\n    ngOnDestroy() {\n        unsubscribe(this.selectionSubscription);\n    }\n\n}\n","import {CommonModule} from \"@angular/common\";\nimport {NgModule} from \"@angular/core\";\nimport {FormsModule, ReactiveFormsModule} from \"@angular/forms\";\nimport {MatchMediaModule} from \"@co.mmons/angular-extensions/browser/match-media\";\nimport {IntlModule} from \"@co.mmons/angular-intl\";\nimport {FormHelperModule} from \"@co.mmons/ionic-extensions/form-helper\";\nimport {SelectModule} from \"@co.mmons/ionic-extensions/select\";\nimport {SpinnerModule} from \"@co.mmons/ionic-extensions/spinner\";\nimport {IonicModule} from \"@ionic/angular\";\nimport {ButtonsModule} from \"@co.mmons/ionic-extensions/buttons\";\nimport {AlignmentMenu} from \"./alignment-menu\";\nimport {HtmlEditor} from \"./editor\";\nimport {HeadingMenu} from \"./heading-menu\";\nimport {InsertMenu} from \"./insert-menu\";\nimport {LinkModal} from \"./link-modal\";\nimport {ListMenu} from \"./list-menu\";\nimport {TextFormatMenu} from \"./text-format-menu\";\nimport {Toolbar} from \"./toolbar\";\n\nexport {HtmlEditor} from \"./editor\";\nexport {HtmlEditorFeatures} from \"./editor-features\";\n\n@NgModule({\n    imports: [CommonModule, IonicModule, IntlModule, SelectModule, FormsModule, ReactiveFormsModule, FormHelperModule, ButtonsModule, MatchMediaModule, SpinnerModule],\n    declarations: [HtmlEditor, AlignmentMenu, HeadingMenu, InsertMenu, LinkModal, ListMenu, TextFormatMenu, Toolbar],\n    exports: [HtmlEditor, IntlModule],\n    entryComponents: [AlignmentMenu, HeadingMenu, InsertMenu, LinkModal, ListMenu, TextFormatMenu]\n})\nexport class HtmlEditorModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {AlignmentMenu as ɵa} from './alignment-menu';\nexport {HeadingMenu as ɵb} from './heading-menu';\nexport {InsertMenu as ɵc} from './insert-menu';\nexport {LinkModal as ɵd} from './link-modal';\nexport {ListMenu as ɵe} from './list-menu';\nexport {TextFormatMenu as ɵf} from './text-format-menu';\nexport {Toolbar as ɵg} from './toolbar';"],"names":["MessageRef","ɵ0","ɵ2","ɵ1","basicNodes","bulletList","orderedList","listItem","basicMarks","Schema","Component","PopoverController","Input","undo","redo","undoInputRule","joinUp","joinDown","lift","selectParentNode","toggleMark","splitListItem","removeSelectedNode","EventEmitter","DOMSerializer","EditorState","DOMParser","waitTill","keymap","baseKeymap","gapCursor","history","EditorView","ElementRef","EventManager","NgControl","Optional","IonItem","HostBinding","Output","setBlockType","findParentNodeOfType","Validators","deepEqual","sleep","FormGroup","FormControl","unsubscribe","ModalController","ViewChild","FormHelper","GapCursor","ReplaceAroundStep","Slice","Fragment","NodeRange","liftTarget","TextSelection","NodeSelection","findWrapping","hasParentNodeOfType","findPositionOfNodeBefore","baseCommand","baseListCommand","findParentNode","shallowEqual","undoDepth","redoDepth","Platform","NgModule","CommonModule","IonicModule","IntlModule","SelectModule","FormsModule","ReactiveFormsModule","FormHelperModule","ButtonsModule","MatchMediaModule","SpinnerModule"],"mappings":"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"}