{"version":3,"file":"image-loader-module.js","sources":["../../../src/image-loader/image-loader.ts","../../../src/image-loader/index.ts","../../../src/image-loader/image-loader-module.ts"],"sourcesContent":["import {Directive, ElementRef, Input} from \"@angular/core\";\nimport {ensureLazyLoad} from \"@co.mmons/ionic-extensions/lazy-load\";\n\nexport interface ImageLoaderStateCssClasses {\n\tloaded?: string;\n\tloading?: string;\n\terror?: string;\n}\n\n@Directive({\n\tselector: \"[ionx-image-loader]\",\n\thost: {\n\t\t\"[attr.ionx-image-loader]\": \"true\"\n\t}\n})\nexport class ImageLoader {\n\n\tconstructor(private element: ElementRef<HTMLElement>) {\n\t}\n\n\tprivate _src: string;\n\n\tprivate _alternate: string;\n\n\tloaded: boolean;\n\n\tloading: boolean;\n\n\terror: boolean;\n\n\t//@ts-ignore\n\tprivate tmpImg: HTMLImageElement;\n\n\tprivate initialized: boolean;\n\n\t@Input(\"src\")\n\tpublic set src(value: string) {\n\t\tlet old = this._src;\n\t\tthis._src = value;\n\n\t\tif (old != this._src) {\n\t\t\tthis.reload();\n\t\t}\n\t}\n\n\tpublic get src() {\n\t\treturn this._src;\n\t}\n\n\t@Input(\"ionx-image-loader\")\n\tprotected set src2(value: string) {\n\t\tthis.src = value;\n\t}\n\n\t@Input(\"alternate\")\n\tpublic set alternate(value: string) {\n\t\tlet old = this._alternate;\n\t\tthis._alternate = value;\n\n\t\tif (old != this._alternate) {\n\t\t\tthis.reload();\n\t\t}\n\t}\n\n\t@Input(\"ionx-image-loader-alternate\")\n\tprotected set alternate2(value: string) {\n\t\tthis.alternate = value;\n\t}\n\n\tprivate _cssClasses: ImageLoaderStateCssClasses;\n\n\t@Input(\"css-classes\")\n\tpublic set cssClasses(value: ImageLoaderStateCssClasses) {\n\t\tthis._cssClasses = value;\n\t}\n\n\t@Input(\"ionx-image-loader-css-classes\")\n\tprotected set cssClasses2(value: ImageLoaderStateCssClasses) {\n\t\tthis._cssClasses = value;\n\t}\n\n\tprivate _cssClassesTarget: string;\n\n\t@Input(\"css-classes-target\")\n\tpublic set cssClassesTarget(value: string) {\n\t\tthis._cssClassesTarget = value;\n\t}\n\n\t@Input(\"ionx-image-loader-css-classes-target\")\n\tprotected set cssClassesParent(value: string) {\n\t\tthis._cssClassesTarget = value;\n\t}\n\n\treload() {\n\t\tif (!this.loading && this.initialized) {\n\t\t\tthis.loaded = false;\n\t\t\tthis.error = false;\n\n\t\t\tif (this._cssClasses) {\n\n\t\t\t\tlet target = this._cssClassesTarget ? this.element.nativeElement.closest(this._cssClassesTarget) : this.element.nativeElement;\n\n\t\t\t\tif (this._cssClasses.loaded) {\n\t\t\t\t\ttarget.classList.remove(this._cssClasses.loaded);\n\t\t\t\t}\n\n\t\t\t\tif (this._cssClasses.error) {\n\t\t\t\t\ttarget.classList.remove(this._cssClasses.error);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.load();\n\t\t}\n\t}\n\n\tprivate load() {\n\n\t\tif (this.loaded || this.error || !this._src || this.loading) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loading = true;\n\t\tif (this._cssClasses && this._cssClasses.loading) {\n\t\t\tthis.element.nativeElement.classList.add(this._cssClasses.loading);\n\t\t}\n\n\t\tlet element: HTMLElement = this.element.nativeElement;\n\t\t\n\t\tlet img: HTMLImageElement;\n\n\t\t// if host element is not <img>, we need to create tmp \n\t\tif (element.tagName.toLowerCase() != \"img\") {\n\t\t\timg = this.tmpImg = new Image();\n\t\t} else {\n\t\t\timg = <any>element;\n\t\t}\n\n\t\timg.onload = () => {\n\t\t\t\n\t\t\tif (img !== element) {\n\t\t\t\telement.style.backgroundImage = `url(${img.src})`;\n\t\t\t}\n\n\t\t\timg.onerror = undefined;\n\t\t\timg.onload = undefined;\n\n\t\t\tthis.tmpImg = undefined;\n\t\t\tthis.loaded = true;\n\t\t\tthis.loading = false;\n\t\t\tthis.error = false;\n\n\t\t\tif (this._cssClasses) {\n\t\t\t\tlet target = this._cssClassesTarget ? element.closest(this._cssClassesTarget) : element;\n\n\t\t\t\tif (target) {\n\t\t\t\t\tif (this._cssClasses.loading) {\n\t\t\t\t\t\ttarget.classList.remove(this._cssClasses.loading);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._cssClasses.loaded) {\n\t\t\t\t\t\ttarget.classList.add(this._cssClasses.loaded);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timg.onerror = () => {\n\n\t\t\tif (this._alternate && this._alternate != img.src) {\n\t\t\t\timg.src = this._alternate;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\timg.onerror = undefined;\n\t\t\timg.onload = undefined;\n\n\t\t\tthis.tmpImg = undefined;\n\t\t\tthis.loading = false;\n\t\t\tthis.loaded = false;\n\t\t\tthis.error = true;\n\n\t\t\tif (this._cssClasses) {\n\t\t\t\tlet target = this._cssClassesTarget ? element.closest(this._cssClassesTarget) : element;\n\n\t\t\t\tif (target) {\n\t\t\t\t\tif (this._cssClasses.loading) {\n\t\t\t\t\t\ttarget.classList.remove(this._cssClasses.loading);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._cssClasses.error) {\n\t\t\t\t\t\ttarget.classList.add(this._cssClasses.error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timg.src = this._src;\n\t}\n\n\tngAfterViewInit() {\n\t\tthis.initialized = true;\n\t\tthis.element.nativeElement[\"ionxImageLoader\"] = this;\n\t\tthis.load();\n\t}\n\n\tngOnDestroy() {\n\t\tif (this.element.nativeElement) {\n\t\t\tdelete this.element.nativeElement[\"ionxImageLoader\"];\n\t\t}\n\t}\n\n}\n\nexport async function ensureImagesLoaded(root: HTMLElement, options?: {retryError?: boolean, lazy?: boolean}) {\n\n\tlet images = root.querySelectorAll(\"[ionx-image-loader]\");\n\tfor (let i = 0; i < images.length; i++) {\n\t\tlet image: Element & ImageLoaderElement = images.item(i);\n\n\t\tif (!image.ionxImageLoader || !image.ionxImageLoader.src || image.ionxImageLoader.loaded || (image.ionxImageLoader.error && (!options || !options.retryError))) {\n\t\t\tcontinue;\n\t\t}\n\n\t\timage.ionxImageLoader.reload();\n\t}\n\n\tif (options && options.lazy) {\n\t\tawait ensureLazyLoad(root, {retryError: options && options.retryError});\n\t}\n}\n\ninterface ImageLoaderElement {\n\tionxImageLoader?: ImageLoader;\n}\n","import {NgModule} from \"@angular/core\";\nimport {ImageLoader} from \"./image-loader\";\n\nexport {ImageLoader, ensureImagesLoaded} from \"./image-loader\";\n\n@NgModule({\n    declarations: [ImageLoader],\n    exports: [ImageLoader]\n})\nexport class ImageLoaderModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}